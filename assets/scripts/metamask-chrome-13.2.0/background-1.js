LavaPack.loadBundle([[1798,{"../../NotificationServicesController/index.cjs":1771,"../../shared/to-raw-notification.cjs":1802,"firebase/app":3680,"firebase/messaging":3681,"firebase/messaging/sw":3682,loglevel:4096},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.createSubscribeToPushNotifications=n.deleteRegToken=n.createRegToken=n.supportedCache=void 0;const i=e("firebase/app"),a=e("firebase/messaging"),r=e("firebase/messaging/sw"),o=s(e("loglevel")),c=e("../../NotificationServicesController/index.cjs"),l=e("../../shared/to-raw-notification.cjs");n.supportedCache=null;const u=async e=>{if(!await(async()=>(n.supportedCache??(n.supportedCache=await(0,r.isSupported)()),n.supportedCache))())return null;const t=await(async e=>{try{return(0,i.getApp)()}catch{const t={apiKey:e.apiKey,authDomain:e.authDomain,storageBucket:e.storageBucket,projectId:e.projectId,messagingSenderId:e.messagingSenderId,appId:e.appId,measurementId:e.measurementId};return(0,i.initializeApp)(t)}})(e);return(0,r.getMessaging)(t)};n.createRegToken=async function(e){try{const t=await u(e);if(!t)return null;return await(0,a.getToken)(t,{serviceWorkerRegistration:self.registration,vapidKey:e.vapidKey})}catch{return null}},n.deleteRegToken=async function(e){try{const t=await u(e);return!t||(await(0,a.deleteToken)(t),!0)}catch{return!1}},n.createSubscribeToPushNotifications=function(e){return async function(t){const n=await async function(e,t){const n=await u(e);if(!n)return null;const s=(0,r.onBackgroundMessage)(n,async e=>{try{const n=e?.data?.data?JSON.parse(e?.data?.data):undefined;if(!n)return;const s=(0,l.toRawOnChainNotification)(n),i=c.Processors.processNotification(s);await t(i)}catch(t){throw o.default.error("Unable to send push notification:",{notification:e?.data?.data,error:t}),new Error("Unable to send push notification")}});return()=>s()}(t,async t=>{e.messenger.publish("NotificationServicesPushController:onNewNotifications",t),await e.onReceivedHandler(t)}),s=function(e){const t=t=>{const n=t?.notification?.data;e(t,n)};return self.addEventListener("notificationclick",t),()=>self.removeEventListener("notificationclick",t)}((t,n)=>{e.messenger.publish("NotificationServicesPushController:pushNotificationClicked",n),e.onClickHandler(t,n)});return()=>{n?.(),s()}}}}}},{package:"@metamask/notification-services-controller",file:"node_modules/@metamask/notification-services-controller/dist/NotificationServicesPushController/web/push-utils.cjs"}],[18,{"../../../../shared/lib/trace":5071,"../../../../shared/modules/selectors":5099,"../../lib/smart-transaction/smart-transactions":183,"../../lib/transaction/hooks/enforce-simulation-hook":210,"../../lib/transaction/metrics":211,"@metamask/smart-transactions-controller/dist/types":1995,"@metamask/transaction-controller":2316,_process:4252},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){Object.defineProperty(n,"__esModule",{value:!0}),n.TransactionControllerInit=void 0;var s=e("@metamask/transaction-controller"),i=e("@metamask/smart-transactions-controller/dist/types"),a=e("../../../../shared/modules/selectors"),r=e("../../lib/smart-transaction/smart-transactions"),o=e("../../../../shared/lib/trace"),c=e("../../lib/transaction/metrics"),l=e("../../lib/transaction/hooks/enforce-simulation-hook");n.TransactionControllerInit=e=>{var n;const{controllerMessenger:u,initMessenger:d,getFlatState:h,getGlobalChainId:p,getPermittedAccounts:m,getTransactionMetricsRequest:f,updateAccountBalanceForTransactionNetwork:g,persistedState:y}=e,{gasFeeController:w,keyringController:S,networkController:b,onboardingController:v,preferencesController:T,smartTransactionsController:k}=function(e){return{gasFeeController:()=>e.getController("GasFeeController"),keyringController:()=>e.getController("KeyringController"),networkController:()=>e.getController("NetworkController"),onboardingController:()=>e.getController("OnboardingController"),preferencesController:()=>e.getController("PreferencesController"),smartTransactionsController:()=>e.getController("SmartTransactionsController"),institutionalSnapController:()=>e.getController("InstitutionalSnapController")}}(e),_=new s.TransactionController({getCurrentNetworkEIP1559Compatibility:()=>d.call("NetworkController:getEIP1559Compatibility"),getCurrentAccountEIP1559Compatibility:async()=>!0,getExternalPendingTransactions:e=>function(e,t){return e.getTransactions({addressFrom:t,status:i.SmartTransactionStatuses.PENDING})}(k(),e),getGasFeeEstimates:(...e)=>w().fetchGasFeeEstimates(...e),getNetworkClientRegistry:(...e)=>b().getNetworkClientRegistry(...e),getNetworkState:()=>b().state,getPermittedAccounts:m,getSavedGasFees:()=>{const e=p();return T().state.advancedGasFee[e]},incomingTransactions:{client:`extension-${null===(n=t.env.METAMASK_VERSION)||void 0===n?void 0:n.replace(/\./gu,"-")}`,includeTokenTransfers:!1,isEnabled:()=>T().state.useExternalServices&&v().state.completedOnboarding,updateTransactions:!0},isAutomaticGasFeeUpdateEnabled:({type:e})=>{const t=[s.TransactionType.swap,s.TransactionType.swapApproval,s.TransactionType.bridge,s.TransactionType.bridgeApproval];return!e||!t.includes(e)},isEIP7702GasFeeTokensEnabled:async e=>{const{chainId:t}=e,n={metamask:h()};return!(0,a.getIsSmartTransaction)(n,t)},isFirstTimeInteractionEnabled:()=>T().state.securityAlertsEnabled,isSimulationEnabled:()=>T().state.useTransactionSimulations,messenger:u,pendingTransactions:{isResubmitEnabled:()=>!1},publicKeyEIP7702:"0x3c7a1cCCe462e96D186B8ca9a1BCB2010C3dABa3",testGasFeeFlows:Boolean(!1),trace:o.trace,hooks:{afterSimulate:new l.EnforceSimulationHook({messenger:d}).getAfterSimulateHook(),beforePublish:e=>d.call("InstitutionalSnapController:publishHook",e),beforeSign:new l.EnforceSimulationHook({messenger:d}).getBeforeSignHook(),beforeCheckPendingTransactions:e=>d.call("InstitutionalSnapController:beforeCheckPendingTransactionHook",e),publish:(e,t)=>(0,r.publishSmartTransactionHook)({flatState:h(),initMessenger:d,signedTx:t,smartTransactionsController:k(),transactionController:_,transactionMeta:e}),publishBatch:async e=>await(0,r.publishBatchSmartTransactionHook)({transactionController:_,smartTransactionsController:k(),hookControllerMessenger:d,flatState:h(),transactions:e.transactions})},sign:(...e)=>S().signTransaction(...e),state:y.TransactionController});!function(e,t,n){const s=t();e.subscribe("TransactionController:unapprovedTransactionAdded",n),e.subscribe("TransactionController:transactionConfirmed",n),e.subscribe("TransactionController:postTransactionBalanceUpdated",c.handlePostTransactionBalanceUpdate.bind(null,s)),e.subscribe("TransactionController:unapprovedTransactionAdded",e=>(0,c.handleTransactionAdded)(s,{transactionMeta:e})),e.subscribe("TransactionController:transactionApproved",c.handleTransactionApproved.bind(null,s)),e.subscribe("TransactionController:transactionDropped",c.handleTransactionDropped.bind(null,s)),e.subscribe("TransactionController:transactionConfirmed",c.handleTransactionConfirmed.bind(null,s)),e.subscribe("TransactionController:transactionFailed",c.handleTransactionFailed.bind(null,s)),e.subscribe("TransactionController:transactionNewSwap",({transactionMeta:t})=>e.call("SwapsController:setTradeTxId",t.id)),e.subscribe("TransactionController:transactionNewSwapApproval",({transactionMeta:t})=>e.call("SwapsController:setApproveTxId",t.id)),e.subscribe("TransactionController:transactionRejected",c.handleTransactionRejected.bind(null,s)),e.subscribe("TransactionController:transactionSubmitted",c.handleTransactionSubmitted.bind(null,s))}(d,f,g);const E=function(e){return{abortTransactionSigning:e.abortTransactionSigning.bind(e),getLayer1GasFee:e.getLayer1GasFee.bind(e),getTransactions:e.getTransactions.bind(e),isAtomicBatchSupported:e.isAtomicBatchSupported.bind(e),startIncomingTransactionPolling:e.startIncomingTransactionPolling.bind(e),stopIncomingTransactionPolling:e.stopIncomingTransactionPolling.bind(e),updateAtomicBatchData:e.updateAtomicBatchData.bind(e),updateBatchTransactions:e.updateBatchTransactions.bind(e),updateEditableParams:e.updateEditableParams.bind(e),updatePreviousGasParams:e.updatePreviousGasParams.bind(e),updateSelectedGasFeeToken:e.updateSelectedGasFeeToken.bind(e),updateTransactionGasFees:e.updateTransactionGasFees.bind(e),updateTransactionSendFlowHistory:e.updateTransactionSendFlowHistory.bind(e)}}(_);return{controller:_,api:E,memStateKey:"TxController"}}}).call(this)}).call(this,e("_process"))}}},{package:"$root$",file:"app/scripts/controller-init/confirmations/transaction-controller-init.ts"}],[180,{"../../../../shared/constants/time":5007,"./analytics":179},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.segment=n.createSegmentMock=void 0;var s,i=e("../../../../shared/constants/time"),a=(s=e("./analytics"))&&s.__esModule?s:{default:s};const r="XdGJ17zKf3NjBPCDQ2UDjJjkx6FYBMGP",o=undefined,c=5*i.SECOND,l=(e=o)=>{const t={queue:[],flush(){t.queue.forEach(([e,t])=>{t()}),t.queue=[]},track(n,s=()=>undefined){t.queue.push([n,s]),t.queue.length>=e&&t.flush()},page(){},identify(){}};return t};n.createSegmentMock=l;n.segment=r?new a.default(r,{host:null,flushAt:o,flushInterval:c}):l(o)}}},{package:"$root$",file:"app/scripts/lib/segment/index.js"}],[1808,{"./ObservableStore":1810},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ComposedStore=void 0;const s=e("./ObservableStore");class i extends s.ObservableStore{constructor(e){super({}),this._children=e||{},Object.keys(this._children).forEach(e=>{const t=this._children[e];this._addChild(e,t)})}_addChild(e,t){const n=t=>{const n=this.getState();n[e]=t,this.putState(n)};t.subscribe(n),n(t.getState())}}n.ComposedStore=i}}},{package:"@metamask/obs-store",file:"node_modules/@metamask/obs-store/dist/ComposedStore.js"}],[1809,{"./ObservableStore":1810},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MergedStore=void 0;const s=e("./ObservableStore");class i extends s.ObservableStore{constructor(e=[]){super({}),this._children=e,e.forEach(e=>this._addChild(e)),this._updateWholeState()}_addChild(e){e.subscribe(()=>this._updateWholeState())}_updateWholeState(){const e=this._children.map(e=>e.getState()),t=Object.assign({},...e);this.putState(t)}}n.MergedStore=i}}},{package:"@metamask/obs-store",file:"node_modules/@metamask/obs-store/dist/MergedStore.js"}],[1810,{"@metamask/safe-event-emitter":1960},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.ObservableStore=void 0;const i=s(e("@metamask/safe-event-emitter"));class a extends i.default{constructor(e){super(),e===undefined?this._state={}:this._state=e}getState(){return this._getState()}putState(e){this._putState(e),this.emit("update",e)}updateState(e){if(e&&"object"==typeof e){const t=this.getState();this.putState(Object.assign(Object.assign({},t),e))}else this.putState(e)}subscribe(e){this.on("update",e)}unsubscribe(e){this.removeListener("update",e)}_getState(){return this._state}_putState(e){this._state=e}}n.ObservableStore=a}}},{package:"@metamask/obs-store",file:"node_modules/@metamask/obs-store/dist/ObservableStore.js"}],[1811,{"readable-stream":4454},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.storeAsStream=void 0;const s=e("readable-stream");class i extends s.Duplex{constructor(e){super({objectMode:!0}),this.resume(),this.handler=e=>this.push(e),this.obsStore=e,this.obsStore.subscribe(this.handler)}pipe(e,t){const n=super.pipe(e,t);return e.write(this.obsStore.getState()),n}_write(e,t,n){this.obsStore.putState(e),n()}_read(e){return undefined}_destroy(e,t){this.obsStore.unsubscribe(this.handler),super._destroy(e,t)}}n.storeAsStream=function(e){return new i(e)}}}},{package:"@metamask/obs-store",file:"node_modules/@metamask/obs-store/dist/asStream.js"}],[1812,{"./ComposedStore":1808,"./MergedStore":1809,"./ObservableStore":1810,"./asStream":1811,"./transform":1813},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n),Object.defineProperty(e,s,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),i(e("./asStream"),n),i(e("./ComposedStore"),n),i(e("./MergedStore"),n),i(e("./ObservableStore"),n),i(e("./transform"),n)}}},{package:"@metamask/obs-store",file:"node_modules/@metamask/obs-store/dist/index.js"}],[1813,{"readable-stream":4454},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.storeTransformStream=void 0;const s=e("readable-stream");n.storeTransformStream=function(e){return new s.Transform({objectMode:!0,transform:(t,n,s)=>{try{const n=e(t);return s(undefined,n),undefined}catch(e){return s(e),undefined}}})}}}},{package:"@metamask/obs-store",file:"node_modules/@metamask/obs-store/dist/transform.js"}],[182,{"../../../../shared/lib/trace":5071},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.addPersonalMessage=async function({signatureParams:e,signatureController:t}){return i(e,t,"newUnsignedPersonalMessage")},n.addTypedMessage=async function({signatureParams:e,signatureController:t}){return i(e,t,"newUnsignedTypedMessage")};var s=e("../../../../shared/lib/trace");async function i(e,t,n){const[,i]=e,{id:a}=i,r=null==a?void 0:a.toString();(0,s.endTrace)({name:s.TraceName.Middleware,id:r});const o=await t[n](...e);return(0,s.endTrace)({name:s.TraceName.Signature,id:r}),o}}}},{package:"$root$",file:"app/scripts/lib/signature/util.ts"}],[1826,{"./enums.cjs":1827,"@metamask/base-controller":1238,"@metamask/utils":2361},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,i,a,r,o,c,l,u,d,h=this&&this.__classPrivateFieldSet||function(e,t,n,s,i){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?i.call(e,n):i?i.value=n:t.set(e,n),n},p=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.PermissionLogController=void 0;const m=e("@metamask/base-controller"),f=e("@metamask/utils"),g=e("./enums.cjs"),y={permissionHistory:{},permissionActivityLog:[]};class w extends m.BaseController{constructor({messenger:e,restrictedMethods:t,state:n}){super({messenger:e,name:"PermissionLogController",metadata:{permissionHistory:{persist:!0,anonymous:!1},permissionActivityLog:{persist:!1,anonymous:!1}},state:{...y,...n}}),s.add(this),i.set(this,void 0),h(this,i,t,"f")}updateAccountsHistory(e,t){if(0===t.length)return;const n={eth_accounts:{accounts:p(this,s,"m",a).call(this,t,Date.now())}};p(this,s,"m",l).call(this,e,n)}createMiddleware(){return(e,t,n)=>{const{origin:a,method:l}=e,d=l.startsWith(g.WALLET_PREFIX),h="eth_requestAccounts"===l;if(!g.LOG_IGNORE_METHODS.includes(l)&&(d||p(this,i,"f").has(l))||h){const i=p(this,s,"m",r).call(this,e,d),l=p(this,s,"m",u).call(this,e);return void n(e=>{const n=Date.now();p(this,s,"m",o).call(this,i,t,n),l&&!t.error&&t.result&&a&&p(this,s,"m",c).call(this,l,a,t.result,n,h),e()})}n()}}}n.PermissionLogController=w,i=new WeakMap,s=new WeakSet,a=function(e,t){return e.reduce((e,n)=>({...e,[n]:t}),{})},r=function(e,t){const n={id:e.id,method:e.method,methodType:t?g.LOG_METHOD_TYPES.internal:g.LOG_METHOD_TYPES.restricted,origin:e.origin,requestTime:Date.now(),responseTime:null,success:null};return this.update(e=>{const t=[...e.permissionActivityLog,n];e.permissionActivityLog=t.length>g.LOG_LIMIT?t.slice(1):t}),n},o=function(e,t,n){e&&t&&this.update(s=>{s.permissionActivityLog=s.permissionActivityLog.map(s=>s.id===e.id?{...s,success:(0,f.hasProperty)(t,"result"),responseTime:n}:s)})},c=function(e,t,n,i,r){let o;if(r){const e=n;o={eth_accounts:{accounts:p(this,s,"m",a).call(this,e,i),lastApproved:i}}}else{o=n.reduce((t,n)=>{const r=n.parentCapability;if(!e.includes(r))return t;if("eth_accounts"===r){const e=p(this,s,"m",d).call(this,n);return{...t,[r]:{lastApproved:i,accounts:p(this,s,"m",a).call(this,e,i)}}}return{...t,[r]:{lastApproved:i}}},{})}Object.keys(o).length>0&&p(this,s,"m",l).call(this,t,o)},l=function(e,t){const{permissionHistory:n}=this.state,s=n[e]??{},i={...s,...t},a=s.eth_accounts,r=t.eth_accounts;if(a&&r){const e=r.lastApproved??a.lastApproved;i.eth_accounts={lastApproved:e,accounts:{...a.accounts,...r.accounts}}}this.update(t=>{t.permissionHistory={...n,[e]:i}})},u=function(e){const{method:t,params:n}=e;return"eth_requestAccounts"===t?["eth_accounts"]:t===`${g.WALLET_PREFIX}requestPermissions`&&n&&Array.isArray(n)&&n[0]&&"object"==typeof n[0]&&!Array.isArray(n[0])?Object.keys(n[0]):null},d=function(e){if("eth_accounts"!==e.parentCapability||!e.caveats)return[];const t=new Set;for(const n of e.caveats)if(n.type===g.CAVEAT_TYPES.restrictReturnedAccounts&&Array.isArray(n.value))for(const e of n.value)t.add(e);return[...t]}}}},{package:"@metamask/permission-log-controller",file:"node_modules/@metamask/permission-log-controller/dist/PermissionLogController.cjs"}],[1827,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;Object.defineProperty(n,"__esModule",{value:!0}),n.LOG_LIMIT=n.LOG_METHOD_TYPES=n.LOG_IGNORE_METHODS=n.CAVEAT_TYPES=n.WALLET_PREFIX=void 0,n.WALLET_PREFIX="wallet_",n.CAVEAT_TYPES=Object.freeze({restrictReturnedAccounts:"restrictReturnedAccounts"}),n.LOG_IGNORE_METHODS=["wallet_registerOnboarding","wallet_watchAsset"],function(e){e.restricted="restricted",e.internal="internal"}(s||(n.LOG_METHOD_TYPES=s={})),n.LOG_LIMIT=100}}},{package:"@metamask/permission-log-controller",file:"node_modules/@metamask/permission-log-controller/dist/enums.cjs"}],[1828,{"./PermissionLogController.cjs":1826},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),i(e("./PermissionLogController.cjs"),n)}}},{package:"@metamask/permission-log-controller",file:"node_modules/@metamask/permission-log-controller/dist/index.cjs"}],[183,{"../../../../shared/constants/app":4975,"../../../../shared/constants/smartTransactions":5001,"../../../../shared/modules/conversion.utils":5083,"../../../../shared/modules/selectors":5099,"../../../../shared/modules/transaction.utils":5105,"../transaction/hooks/delegation-7702-publish":209,"../transaction/util":214,"@metamask/smart-transactions-controller/dist/types":1995,"@metamask/transaction-controller":2316,loglevel:4096},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.publishBatchSmartTransactionHook=function({transactionController:e,smartTransactionsController:t,hookControllerMessenger:n,flatState:s,transactions:i}){const a=i[i.length-1],r=(0,p.getTransactionById)(a.id??"",e);if(!r)throw new Error(`publishBatchSmartTransactionHook: Could not find transaction with id ${a.id}`);const{isSmartTransaction:o,featureFlags:c,isHardwareWalletAccount:l}=J(s,r.chainId);if(!o)throw new Error("publishBatchSmartTransactionHook: Smart Transaction is required for batch submissions");return Y({transactions:i,transactionController:e,smartTransactionsController:t,controllerMessenger:n,isSmartTransaction:o,isHardwareWallet:l,featureFlags:c,transactionMeta:r})},n.publishSmartTransactionHook=async function({flatState:e,initMessenger:t,signedTx:n,smartTransactionsController:s,transactionController:i,transactionMeta:a}){const{isSmartTransaction:r,featureFlags:o,isHardwareWalletAccount:c}=J(e,a.chainId);if(r){const e=await z({transactionMeta:a,signedTransactionInHex:n,transactionController:i,smartTransactionsController:s,controllerMessenger:t,isSmartTransaction:r,isHardwareWallet:c,featureFlags:o});if(null!=e&&e.transactionHash)return e}const l=new h.Delegation7702PublishHook({isAtomicBatchSupported:i.isAtomicBatchSupported.bind(i),messenger:t}).getHook();return await l(a,n)},n.submitSmartTransactionHook=n.submitBatchSmartTransactionHook=void 0;var s,i=e("@metamask/smart-transactions-controller/dist/types"),a=e("@metamask/transaction-controller"),r=(s=e("loglevel"))&&s.__esModule?s:{default:s},o=e("../../../../shared/modules/conversion.utils"),c=e("../../../../shared/constants/smartTransactions"),l=e("../../../../shared/modules/transaction.utils"),u=e("../../../../shared/constants/app"),d=e("../../../../shared/modules/selectors"),h=e("../transaction/hooks/delegation-7702-publish"),p=e("../transaction/util");function m(e,t,n){f(e,t),t.set(e,n)}function f(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function g(e,t){return e.get(w(e,t))}function y(e,t,n){return e.set(w(e,t),n),n}function w(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var S=new WeakMap,b=new WeakMap,v=new WeakMap,T=new WeakMap,k=new WeakMap,_=new WeakMap,E=new WeakMap,C=new WeakMap,P=new WeakMap,A=new WeakMap,I=new WeakMap,O=new WeakMap,M=new WeakMap,j=new WeakMap,N=new WeakSet;class R{constructor(e){!function(e,t){f(e,t),t.add(e)}(this,N),m(this,S,void 0),m(this,b,void 0),m(this,v,void 0),m(this,T,void 0),m(this,k,void 0),m(this,_,void 0),m(this,E,void 0),m(this,C,void 0),m(this,P,void 0),m(this,A,void 0),m(this,I,void 0),m(this,O,void 0),m(this,M,void 0),m(this,j,void 0);const{transactionMeta:t,signedTransactionInHex:n,smartTransactionsController:s,transactionController:i,isSmartTransaction:r,controllerMessenger:o,featureFlags:c,transactions:l}=e;y(b,this,""),y(S,this,!1),y(A,this,t),y(I,this,n),y(C,this,s),y(P,this,i),y(E,this,r),y(T,this,o),y(k,this,c),y(_,this,t.origin!==u.ORIGIN_METAMASK),y(v,this,t.chainId),y(M,this,t.txParams),y(O,this,l),y(j,this,Boolean(t.type!==a.TransactionType.bridge||g(O,this)&&g(O,this).length>0))}async submit(){const e=!!g(A,this).type&&[a.TransactionType.swapAndSend,a.TransactionType.swapApproval,a.TransactionType.bridgeApproval].includes(g(A,this).type),t={transactionHash:undefined};if(!g(E,this)||e||(0,l.isLegacyTransaction)(g(A,this)))return t;let n;g(j,this)&&await w(N,this,L).call(this);try{n=await g(C,this).getFees({...g(M,this),chainId:g(v,this)},undefined,{networkClientId:g(A,this).networkClientId})}catch(e){return r.default.error("Error in smart transaction publish hook, falling back to regular transaction submission",e),w(N,this,H).call(this),t}try{var s;const e=await w(N,this,q).call(this,{getFeesResponse:n}),t=null==e?void 0:e.uuid;if(!t)throw new Error("No smart transaction UUID");await w(N,this,F).call(this,t);let i;if(i=(null===(s=g(k,this))||void 0===s||null===(s=s.smartTransactions)||void 0===s?void 0:s.extensionReturnTxHashAsap)&&null!=e&&e.txHash?e.txHash:await w(N,this,W).call(this,{uuid:t}),null===i)throw new Error("Transaction does not have a transaction hash, there was a problem");return{transactionHash:i}}catch(e){throw r.default.error("Error in smart transaction publish hook",e),w(N,this,H).call(this),e}}async submitBatch(){if(!g(E,this))throw new Error("submitBatch: Smart Transaction is required for batch submissions");g(j,this)&&await w(N,this,L).call(this);try{const e=await w(N,this,q).call(this),t=null==e?void 0:e.uuid;if(!t)throw new Error("submitBatch: No smart transaction UUID");await w(N,this,F).call(this,t);if(null===await w(N,this,W).call(this,{uuid:t}))throw new Error("submitBatch: Transaction does not have a transaction hash, there was a problem");let n;return n=null!=e&&e.txHashes?{results:e.txHashes.map(e=>({transactionHash:e}))}:{results:[]},n}catch(e){throw r.default.error("submitBatch: Error in smart transaction publish batch hook",e),w(N,this,H).call(this),e}}}async function x(e){try{await g(T,this).call("ApprovalController:endFlow",{id:e})}catch(e){}}async function D(e){try{await w(N,this,x).call(this,e),await g(T,this).call("ApprovalController:acceptRequest",e),V._=""}catch(e){r.default.error("Error ending existing approval flow",e)}}async function L(){V._&&await w(N,this,D).call(this,V._);const{id:e}=await g(T,this).call("ApprovalController:startFlow");y(b,this,e),V._=e}async function F(e){g(j,this)&&(w(N,this,B).call(this,{uuid:e}),w(N,this,$).call(this,{uuid:e}))}function H(){g(j,this)&&!g(S,this)&&(y(S,this,!0),w(N,this,x).call(this,g(b,this)),V._===g(b,this)&&(V._=""))}function B({uuid:e}){const t=()=>{w(N,this,H).call(this)};g(T,this).call("ApprovalController:addRequest",{id:g(b,this),origin:origin,type:u.SMART_TRANSACTION_CONFIRMATION_TYPES.showSmartTransactionStatusPage,requestState:{smartTransaction:{status:i.SmartTransactionStatuses.PENDING,creationTime:Date.now(),uuid:e},isDapp:g(_,this),txId:g(A,this).id}},!0).then(t,t)}async function U({smartTransaction:e}){return await g(T,this).call("ApprovalController:updateRequestState",{id:g(b,this),requestState:{smartTransaction:e,isDapp:g(_,this),txId:g(A,this).id}})}async function $({uuid:e}){g(T,this).subscribe("SmartTransactionsController:smartTransaction",async t=>{if(t.uuid===e){const{status:e}=t;if(!e||e===i.SmartTransactionStatuses.PENDING)return;g(S,this)||await w(N,this,U).call(this,{smartTransaction:t})}})}function W({uuid:e}){return new Promise(t=>{g(T,this).subscribe("SmartTransactionsController:smartTransaction",async n=>{if(n.uuid===e){const{status:e,statusMetadata:s}=n;if(!e||e===i.SmartTransactionStatuses.PENDING)return;r.default.debug("Smart Transaction: ",n),null!=s&&s.minedHash?(r.default.debug("Smart Transaction - Received tx hash: ",null==s?void 0:s.minedHash),t(s.minedHash)):t(null)}})})}async function q({getFeesResponse:e}={}){let t=[];if(g(O,this)&&Array.isArray(g(O,this))&&g(O,this).length>0)t=g(O,this).filter(e=>null==e?void 0:e.signedTx).map(e=>e.signedTx);else if(g(I,this))t=[g(I,this)];else if(e){var n;t=await w(N,this,G).call(this,(null===(n=e.tradeTxFees)||void 0===n?void 0:n.fees)??[],!1)}return await g(C,this).submitSignedTransactions({signedTransactions:t,signedCanceledTransactions:[],txParams:g(M,this),transactionMeta:g(A,this),networkClientId:g(A,this).networkClientId})}function K(e,t){if(!g(M,this))throw new Error("Transaction params are required");const n={...g(M,this),maxFeePerGas:`0x${(0,o.decimalToHex)(e.maxFeePerGas)}`,maxPriorityFeePerGas:`0x${(0,o.decimalToHex)(e.maxPriorityFeePerGas)}`,gas:t?`0x${(0,o.decimalToHex)(c.CANCEL_GAS_LIMIT_DEC)}`:g(M,this).gas};return t&&(n.to=n.from,n.data="0x"),n}async function G(e,t){if(!g(M,this)||!g(v,this))throw new Error("Transaction params and chainId are required");const n=e.map(e=>w(N,this,K).call(this,e,t)).map(e=>({...e,chainId:e.chainId||g(v,this)}));return await g(P,this).approveTransactionsWithSameNonce(n,{hasNonce:!0})}var V={_:""};const z=e=>new R(e).submit();n.submitSmartTransactionHook=z;const Y=e=>new R(e).submitBatch();function J(e,t){const n=function(e){return{metamask:e}}(e);return{isSmartTransaction:(0,d.getIsSmartTransaction)(n,t),featureFlags:(0,d.getFeatureFlagsByChainId)(n,t),isHardwareWalletAccount:(0,d.isHardwareWallet)(n)}}n.submitBatchSmartTransactionHook=Y}}},{package:"$root$",file:"app/scripts/lib/smart-transaction/smart-transactions.ts"}],[184,{"./snap-keyring":187,"./utils":188},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"getAccountsBySnapId",{enumerable:!0,get:function(){return i.getAccountsBySnapId}}),Object.defineProperty(n,"snapKeyringBuilder",{enumerable:!0,get:function(){return s.snapKeyringBuilder}});var s=e("./snap-keyring"),i=e("./utils")}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/index.ts"}],[1846,{"./ppom-controller":1847},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PPOMController=n.NETWORK_CACHE_DURATION=void 0;var s=e("./ppom-controller");Object.defineProperty(n,"NETWORK_CACHE_DURATION",{enumerable:!0,get:function(){return s.NETWORK_CACHE_DURATION}}),Object.defineProperty(n,"PPOMController",{enumerable:!0,get:function(){return s.PPOMController}})}}},{package:"@metamask/ppom-validator",file:"node_modules/@metamask/ppom-validator/dist/index.js"}],[1847,{"./ppom-storage":1848,"./util":1849,"@metamask/base-controller":1854,"@metamask/controller-utils":1315,"await-semaphore":3148},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,i,a,r,o,c,l,u,d,h,p,m,f,g,y,w,S,b,v,T,k,_,E,C,P,A,I,O,M,j,N,R,x=this&&this.__classPrivateFieldSet||function(e,t,n,s,i){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?i.call(e,n):i?i.value=n:t.set(e,n),n},D=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.PPOMController=n.NETWORK_CACHE_DURATION=void 0;const L=e("@metamask/base-controller"),F=e("@metamask/controller-utils"),H=e("await-semaphore"),B=e("./ppom-storage"),U=e("./util");n.NETWORK_CACHE_DURATION=6048e5;const $=["eth_call","eth_blockNumber","eth_createAccessList","eth_getLogs","eth_getFilterLogs","eth_getTransactionByHash","eth_chainId","eth_getBlockByHash","eth_getBlockByNumber","eth_getCode","eth_getStorageAt","eth_getBalance","eth_getTransactionCount","trace_call","trace_callMany","debug_traceCall","trace_filter"],W={versionInfo:{persist:!0,anonymous:!1},storageMetadata:{persist:!0,anonymous:!1}},q="PPOMController",K={headers:{"Content-Type":"application/json"}};class G extends L.BaseController{constructor({chainId:e,messenger:t,provider:n,storageBackend:w,securityAlertsEnabled:S,onPreferencesChange:b,ppomProvider:_,cdnBaseUrl:E,providerRequestLimit:C,state:P,blockaidPublicKey:A,nativeCrypto:I}){super({name:q,metadata:W,messenger:t,state:{versionInfo:P?.versionInfo??[],storageMetadata:P?.storageMetadata??[]}}),s.add(this),i.set(this,void 0),a.set(this,void 0),r.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,0),h.set(this,void 0),p.set(this,void 0),m.set(this,{}),f.set(this,void 0),g.set(this,!1),y.set(this,undefined),x(this,h,(0,U.addHexPrefix)(e),"f"),x(this,a,n,"f"),x(this,c,_,"f"),x(this,r,new B.PPOMStorage({storageBackend:w,readMetadata:()=>[...this.state.storageMetadata],writeMetadata:e=>{this.update(t=>{t.storageMetadata=e})}}),"f"),x(this,o,new H.Mutex,"f"),x(this,l,E,"f"),x(this,u,C??300,"f"),x(this,p,S,"f"),x(this,f,A,"f"),x(this,y,I,"f"),b(D(this,s,"m",v).bind(this)),D(this,s,"m",T).call(this),D(this,s,"m",k).call(this)}async usePPOM(e,t){const n=t??D(this,h,"f");if(!D(this,p,"f"))throw Error("User has securityAlertsEnabled set to false");if(!(0,U.blockaidValidationSupportedForNetwork)(n))throw Error(`Blockaid validation not available on network with chainId: ${n}`);return await D(this,o,"f").use(async()=>{const t=await D(this,s,"m",E).call(this,n);x(this,d,0,"f"),x(this,m,{},"f");return{...await e(t),providerRequestsCount:{...D(this,m,"f")}}})}}n.PPOMController=G,i=new WeakMap,a=new WeakMap,r=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,p=new WeakMap,m=new WeakMap,f=new WeakMap,g=new WeakMap,y=new WeakMap,s=new WeakSet,w=async function(){if(D(this,p,"f")&&!D(this,g,"f")){const{ppomInit:e}=D(this,c,"f");await e("./ppom_bg.wasm"),x(this,g,!0,"f")}},S=function(){D(this,s,"m",_).call(this).catch(e=>{console.error(`Error in resetting ppom: ${e.message}`)});const{storageMetadata:e}=this.state;this.update(e=>{e.versionInfo=[],e.storageMetadata=[]}),D(this,r,"f").deleteAllFiles(e).catch(e=>{console.error(`Error in deleting files: ${e.message}`)})},b=function(e){const t=this.messagingSystem.call("NetworkController:getNetworkClientById",e.selectedNetworkClientId),{chainId:n}=t.configuration,i=(0,U.addHexPrefix)(n);i!==D(this,h,"f")&&(x(this,h,i,"f"),D(this,s,"m",_).call(this).catch(e=>{console.error(`Error in resetting ppom: ${e.message}`)}))},v=function(e){const t=e.securityAlertsEnabled;t!==D(this,p,"f")&&(x(this,p,t,"f"),t||D(this,s,"m",S).call(this))},T=function(){this.messagingSystem.registerActionHandler(`${q}:usePPOM`,this.usePPOM.bind(this))},k=function(){const e=D(this,s,"m",b).bind(this);this.messagingSystem.subscribe("NetworkController:networkDidChange",e)},_=async function(){await D(this,o,"f").use(async()=>{D(this,i,"f")&&(D(this,i,"f").free(),x(this,i,undefined,"f"))})},E=async function(e){const t=await D(this,s,"m",C).call(this);let n;return(D(this,i,"f")===undefined||t)&&(n=await D(this,s,"m",R).call(this,e),D(this,h,"f")===e&&(D(this,i,"f")&&D(this,i,"f").free(),x(this,i,n,"f")),D(this,r,"f").syncMetadata(this.state.versionInfo).catch(e=>{console.error(`Error while trying to sync metadata: ${e.message}`)})),n},C=async function(){const e=await D(this,s,"m",M).call(this);return!!e&&(this.update(t=>{t.versionInfo=e}),!0)},P=function(e,t){return e.find(e=>e.name===t.name&&e.chainId===t.chainId&&e.version===t.version&&e.checksum===t.checksum)},A=async function(e){const t=await Promise.all(e.map(async e=>{let t;try{t=await D(this,s,"m",I).call(this,e)}catch(t){console.error(`Error in getting file ${e.filePath}: ${t.message}`)}return t?[e.name,new Uint8Array(t)]:undefined}));return t?.filter(e=>e?.[1]!==undefined)},I=async function(e){const{storageMetadata:t}=this.state;if(D(this,s,"m",P).call(this,t,e))try{return await D(this,r,"f").readFile(e.name,e.chainId)}catch(e){console.error(`Error in reading file: ${e.message}`)}(0,U.checkFilePath)(e.filePath);const n=(0,U.constructURLHref)(D(this,l,"f"),e.filePath),i=await D(this,s,"m",j).call(this,n);return await(0,U.validateSignature)(i,e.hashSignature,D(this,f,"f"),e.filePath,D(this,y,"f")),await D(this,r,"f").writeFile({data:i,...e}).catch(e=>{console.error(`Error in writing file: ${e.message}`)}),i},O=async function(e,t={},n="GET"){const s=await(0,F.safelyExecute)(async()=>(0,F.timeoutFetch)(e,{method:n,cache:"no-cache",redirect:"error",...t},1e4),!0),i=304===s?.status;if(!s?.status||s?.status<200||s?.status>399)throw new Error(`Failed to fetch file with url: ${e}`);return{cached:i,response:s}},M=async function(){const e=(0,U.constructURLHref)(D(this,l,"f"),"ppom_version.json"),{cached:t,response:n}=await D(this,s,"m",O).call(this,e,{headers:K});return t&&this.state.versionInfo?.length?undefined:n.json()},j=async function(e){const{response:t}=await D(this,s,"m",O).call(this,e);return await t.arrayBuffer()},N=async function(e,t){if(D(this,d,"f")>D(this,u,"f"))return U.PROVIDER_ERRORS.limitExceeded();if(x(this,d,D(this,d,"f")+1,"f"),!$.includes(e))return U.PROVIDER_ERRORS.methodNotSupported();D(this,m,"f")[e]=D(this,m,"f")[e]?Number(D(this,m,"f")[e])+1:1;const n=(0,U.createPayload)(e,t);try{const e=await D(this,a,"f").request(n);return{jsonrpc:"2.0",id:n.id,result:e}}catch(e){return{jsonrpc:"2.0",id:n.id,error:e}}},R=async function(e){await D(this,s,"m",w).call(this);const t=this.state.versionInfo.filter(({chainId:t})=>t===e);if(t?.length===undefined||0===t?.length)throw new Error(`Aborting initialising PPOM as no files are found for the network with chainId: ${e}`);const n=await D(this,s,"m",A).call(this,t);if(n?.length!==t?.length)throw new Error(`Aborting initialising PPOM as not all files could not be downloaded for the network with chainId: ${e}`);const{PPOM:i}=D(this,c,"f");return i.new(D(this,s,"m",N).bind(this),n)}}}},{package:"@metamask/ppom-validator",file:"node_modules/@metamask/ppom-validator/dist/ppom-controller.js"}],[1848,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,i,a,r=this&&this.__classPrivateFieldSet||function(e,t,n,s,i){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?i.call(e,n):i?i.value=n:t.set(e,n),n},o=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.PPOMStorage=void 0;n.PPOMStorage=class{constructor({storageBackend:e,readMetadata:t,writeMetadata:n}){s.set(this,void 0),i.set(this,void 0),a.set(this,void 0),r(this,s,e,"f"),r(this,i,t,"f"),r(this,a,n,"f")}async syncMetadata(e){const t=o(this,i,"f").call(this),n=[];for(const s of t){try{await this.readFile(s.name,s.chainId)}catch(e){console.error("Error: ",e);continue}e.find(e=>e.name===s.name&&e.chainId===s.chainId&&e.version===s.version&&e.checksum===s.checksum)&&n.push(s)}const r=await o(this,s,"f").dir();for(const{name:e,chainId:t}of r)n.find(n=>n.name===e&&n.chainId===t)||await o(this,s,"f").delete({name:e,chainId:t});return o(this,a,"f").call(this,n),n}async deleteAllFiles(e){for(const t of e){const{name:e,chainId:n}=t;try{await o(this,s,"f").delete({name:e,chainId:n})}catch(t){console.error(`Error in deleting file: ${e}, ${n}`,t)}}}async readFile(e,t){const n=o(this,i,"f").call(this).find(n=>n.name===e&&n.chainId===t);if(!n)throw new Error(`File metadata (${e}, ${t}) not found`);const a=await o(this,s,"f").read({name:e,chainId:t},n.checksum);if(!a)throw new Error(`Storage File (${e}, ${t}) not found`);return a}async writeFile({data:e,name:t,chainId:n,version:r,checksum:c}){await o(this,s,"f").write({name:t,chainId:n},e,c);const l=o(this,i,"f").call(this),u=l.find(e=>e.name===t&&e.chainId===n);u?(u.version=r,u.checksum=c):l.push({name:t,chainId:n,version:r,checksum:c}),o(this,a,"f").call(this,l)}},s=new WeakMap,i=new WeakMap,a=new WeakMap}}},{package:"@metamask/ppom-validator",file:"node_modules/@metamask/ppom-validator/dist/ppom-storage.js"}],[1849,{buffer:3318,"crypto-js":3436,elliptic:3492,"json-rpc-random-id":3919},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(t){(function(){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return i(t,e),t},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.checkFilePath=n.addHexPrefix=n.constructURLHref=n.validateSignature=n.PROVIDER_ERRORS=n.createPayload=n.IdGenerator=n.blockaidValidationSupportedForNetwork=n.SUPPORTED_NETWORK_CHAINIDS=void 0;const o=a(e("crypto-js")),c=r(e("elliptic")),l=r(e("json-rpc-random-id")),u=c.default.eddsa;n.SUPPORTED_NETWORK_CHAINIDS={MAINNET:"0x1",BSC:"0x38",OPTIMISM:"0xa",POLYGON:"0x89",AVALANCHE:"0xa86a",ARBITRUM:"0xa4b1",LINEA_MAINNET:"0xe708",BASE:"0x2105",SEPOLIA:"0xaa36a7",OPBNB:"0xcc",ZKSYNC:"0x144",SCROLL:"0x82750",BERACHAIN:"0x138d4",METACHAIN_ONE:"0x1b6e6"};n.blockaidValidationSupportedForNetwork=e=>Object.values(n.SUPPORTED_NETWORK_CHAINIDS).some(t=>t===e),n.IdGenerator=(0,l.default)();n.createPayload=(e,t)=>({id:(0,n.IdGenerator)(),jsonrpc:"2.0",method:e,params:t??[]}),n.PROVIDER_ERRORS={limitExceeded:()=>({jsonrpc:"2.0",id:(0,n.IdGenerator)(),error:{code:-32005,message:"Limit exceeded"}}),methodNotSupported:()=>({jsonrpc:"2.0",id:(0,n.IdGenerator)(),error:{code:-32601,message:"Method not supported"}})};n.validateSignature=async(e,n,s,i,a,r)=>{const c=await(async(e,t,n=!0)=>{if(t)return t.createHash("sha256").update(e).digest("hex");if("crypto"in globalThis&&"object"==typeof globalThis.crypto&&globalThis.crypto.subtle?.digest&&n){const t=await globalThis.crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(e=>e.toString(16).padStart(2,"0")).join("")}return(0,o.SHA256)(o.default.lib.WordArray.create(e)).toString()})(e,a,r);if(!new u("ed25519").keyFromPublic(s).verify(t.from(c),n))throw Error(`Signature verification failed for file path: ${i}`)};n.constructURLHref=(e,t)=>new URL(`https://${e}/${t}`.replace(/https:\/\/https:\/\//gu,"https://").replace(/\/\//gu,"/")).href;n.addHexPrefix=e=>"string"!=typeof e||e.match(/^-?0x/u)?e:e.match(/^-?0X/u)?e.replace("0X","0x"):`0x${parseInt(e,10).toString(16)}`;n.checkFilePath=e=>{if(!e.match(/^[\w./]+$/u))throw new Error(`Invalid file path for data file: ${e}`)}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/ppom-validator",file:"node_modules/@metamask/ppom-validator/dist/util.js"}],[185,{"@metamask/keyring-api":1559,"@metamask/permission-controller":1819},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isProtocolAllowed=u,n.keyringSnapPermissionsBuilder=function(e,t){return()=>{if("metamask"===t)return r;if(a.includes(t))return c;const n=e.getSubjectMetadata(t);return(null==n?void 0:n.subjectType)===i.SubjectType.Website&&u(t)?o:[]}};var s=e("@metamask/keyring-api"),i=e("@metamask/permission-controller");const a=["https://portfolio.metamask.io"],r=[s.KeyringRpcMethod.ListAccounts,s.KeyringRpcMethod.GetAccount,s.KeyringRpcMethod.FilterAccountChains,s.KeyringRpcMethod.DeleteAccount,s.KeyringRpcMethod.ListRequests,s.KeyringRpcMethod.GetRequest,s.KeyringRpcMethod.SubmitRequest,s.KeyringRpcMethod.RejectRequest],o=[s.KeyringRpcMethod.ListAccounts,s.KeyringRpcMethod.GetAccount,s.KeyringRpcMethod.CreateAccount,s.KeyringRpcMethod.FilterAccountChains,s.KeyringRpcMethod.UpdateAccount,s.KeyringRpcMethod.DeleteAccount,s.KeyringRpcMethod.ExportAccount,s.KeyringRpcMethod.ListRequests,s.KeyringRpcMethod.GetRequest,s.KeyringRpcMethod.ApproveRequest,s.KeyringRpcMethod.RejectRequest],c=[s.KeyringRpcMethod.ListAccounts,s.KeyringRpcMethod.GetAccount,s.KeyringRpcMethod.GetAccountBalances,s.KeyringRpcMethod.SubmitRequest],l=["https:"];function u(e){try{const t=new URL(e);return l.includes(t.protocol)}catch(e){return!1}}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/keyring-snaps-permissions.ts"}],[1850,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.BaseControllerV1=n.isBaseControllerV1=void 0,n.isBaseControllerV1=function(e){return"name"in e&&"string"==typeof e.name&&"config"in e&&"object"==typeof e.config&&"defaultConfig"in e&&"object"==typeof e.defaultConfig&&"state"in e&&"object"==typeof e.state&&"defaultState"in e&&"object"==typeof e.defaultState&&"disabled"in e&&"boolean"==typeof e.disabled&&"subscribe"in e&&"function"==typeof e.subscribe};class s{constructor(e={},t={}){this.defaultConfig={},this.defaultState={},this.disabled=!1,this.name="BaseController",this.internalConfig=this.defaultConfig,this.internalState=this.defaultState,this.internalListeners=[],this.initialState=t,this.initialConfig=e}initialize(){return this.internalState=this.defaultState,this.internalConfig=this.defaultConfig,this.configure(this.initialConfig),this.update(this.initialState),this}get config(){return this.internalConfig}get state(){return this.internalState}configure(e,t=!1,n=!0){if(n){this.internalConfig=t?e:Object.assign(this.internalConfig,e);for(const e of Object.keys(this.internalConfig)){const t=this.internalConfig[e];t!==undefined&&(this[e]=t)}}else for(const t of Object.keys(e))if(this.internalConfig[t]!==undefined){const n=e[t];this.internalConfig[t]=n,this[t]=n}}notify(){this.disabled||this.internalListeners.forEach(e=>{e(this.internalState)})}subscribe(e){this.internalListeners.push(e)}unsubscribe(e){const t=this.internalListeners.findIndex(t=>e===t);return t>-1&&this.internalListeners.splice(t,1),t>-1}update(e,t=!1){this.internalState=t?Object.assign({},e):Object.assign({},this.internalState,e),this.notify()}}n.BaseControllerV1=s,n.default=s}}},{package:"@metamask/ppom-validator>@metamask/base-controller",file:"node_modules/@metamask/ppom-validator/node_modules/@metamask/base-controller/dist/BaseControllerV1.cjs"}],[1851,{immer:3883},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,i=this&&this.__classPrivateFieldSet||function(e,t,n,s,i){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?i.call(e,n):i?i.value=n:t.set(e,n),n},a=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.getPersistentState=n.getAnonymizedState=n.BaseController=n.isBaseController=void 0;const r=e("immer");(0,r.enablePatches)(),n.isBaseController=function(e){return"name"in e&&"string"==typeof e.name&&"state"in e&&"object"==typeof e.state&&"metadata"in e&&"object"==typeof e.metadata};function o(e,t,n){return Object.keys(e).reduce((s,i)=>{try{const a=t[i];if(!a)throw new Error(`No metadata found for '${String(i)}'`);const r=a[n],o=e[i];return"function"==typeof r?s[i]=r(o):r&&(s[i]=o),s}catch(e){return setTimeout(()=>{throw e}),s}},{})}n.BaseController=class{constructor({messenger:e,metadata:t,name:n,state:a}){s.set(this,void 0),this.messagingSystem=e,this.name=n,i(this,s,(0,r.freeze)(a,!0),"f"),this.metadata=t,this.messagingSystem.registerActionHandler(`${n}:getState`,()=>this.state),this.messagingSystem.registerInitialEventPayload({eventType:`${n}:stateChange`,getPayload:()=>[this.state,[]]})}get state(){return a(this,s,"f")}set state(e){throw new Error("Controller state cannot be directly mutated; use 'update' method instead.")}update(e){const[t,n,o]=r.produceWithPatches(a(this,s,"f"),e);return i(this,s,t,"f"),this.messagingSystem.publish(`${this.name}:stateChange`,t,n),{nextState:t,patches:n,inversePatches:o}}applyPatches(e){const t=(0,r.applyPatches)(a(this,s,"f"),e);i(this,s,t,"f"),this.messagingSystem.publish(`${this.name}:stateChange`,t,e)}destroy(){this.messagingSystem.clearEventSubscriptions(`${this.name}:stateChange`)}},s=new WeakMap,n.getAnonymizedState=function(e,t){return o(e,t,"anonymous")},n.getPersistentState=function(e,t){return o(e,t,"persist")}}}},{package:"@metamask/ppom-validator>@metamask/base-controller",file:"node_modules/@metamask/ppom-validator/node_modules/@metamask/base-controller/dist/BaseControllerV2.cjs"}],[1852,{"./RestrictedMessenger.cjs":1853},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,i,a,r,o=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.ControllerMessenger=n.Messenger=void 0;const c=e("./RestrictedMessenger.cjs");class l{constructor(){s.set(this,new Map),i.set(this,new Map),a.set(this,new Map),r.set(this,new Map)}registerActionHandler(e,t){if(o(this,s,"f").has(e))throw new Error(`A handler for ${e} has already been registered`);o(this,s,"f").set(e,t)}unregisterActionHandler(e){o(this,s,"f").delete(e)}clearActions(){o(this,s,"f").clear()}call(e,...t){const n=o(this,s,"f").get(e);if(!n)throw new Error(`A handler for ${e} has not been registered`);return n(...t)}registerInitialEventPayload({eventType:e,getPayload:t}){o(this,a,"f").set(e,t)}publish(e,...t){const n=o(this,i,"f").get(e);if(n)for(const[e,s]of n.entries())try{if(s){const n=o(this,r,"f").get(e),i=s(...t);i!==n&&(o(this,r,"f").set(e,i),e(i,n))}else e(...t)}catch(e){setTimeout(()=>{throw e})}}subscribe(e,t,n){let s=o(this,i,"f").get(e);if(s||(s=new Map,o(this,i,"f").set(e,s)),s.set(t,n),n){const s=o(this,a,"f").get(e);if(s){const e=n(...s());o(this,r,"f").set(t,e)}}}unsubscribe(e,t){const n=o(this,i,"f").get(e);if(!n||!n.has(t))throw new Error(`Subscription not found for event: ${e}`);n.get(t)&&o(this,r,"f").delete(t),n.delete(t)}clearEventSubscriptions(e){o(this,i,"f").delete(e)}clearSubscriptions(){o(this,i,"f").clear()}getRestricted({name:e,allowedActions:t,allowedEvents:n}){return new c.RestrictedMessenger({messenger:this,name:e,allowedActions:t,allowedEvents:n})}}n.Messenger=l,n.ControllerMessenger=l,s=new WeakMap,i=new WeakMap,a=new WeakMap,r=new WeakMap}}},{package:"@metamask/ppom-validator>@metamask/base-controller",file:"node_modules/@metamask/ppom-validator/node_modules/@metamask/base-controller/dist/Messenger.cjs"}],[1853,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,i,a,r,o,c,l,u,d=this&&this.__classPrivateFieldSet||function(e,t,n,s,i){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?i.call(e,n):i?i.value=n:t.set(e,n),n},h=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.RestrictedControllerMessenger=n.RestrictedMessenger=void 0;class p{constructor({controllerMessenger:e,messenger:t,name:n,allowedActions:c,allowedEvents:l}){if(s.add(this),i.set(this,void 0),a.set(this,void 0),r.set(this,void 0),o.set(this,void 0),t&&e)throw new Error("Both messenger properties provided. Provide message using only 'messenger' option, 'controllerMessenger' is deprecated");if(!t&&!e)throw new Error("Messenger not provided");d(this,i,t??e,"f"),d(this,a,n,"f"),d(this,r,c,"f"),d(this,o,l,"f")}registerActionHandler(e,t){if(!h(this,s,"m",u).call(this,e))throw new Error(`Only allowed registering action handlers prefixed by '${h(this,a,"f")}:'`);h(this,i,"f").registerActionHandler(e,t)}unregisterActionHandler(e){if(!h(this,s,"m",u).call(this,e))throw new Error(`Only allowed unregistering action handlers prefixed by '${h(this,a,"f")}:'`);h(this,i,"f").unregisterActionHandler(e)}call(e,...t){if(!h(this,s,"m",l).call(this,e))throw new Error(`Action missing from allow list: ${e}`);return h(this,i,"f").call(e,...t)}registerInitialEventPayload({eventType:e,getPayload:t}){if(!h(this,s,"m",u).call(this,e))throw new Error(`Only allowed publishing events prefixed by '${h(this,a,"f")}:'`);h(this,i,"f").registerInitialEventPayload({eventType:e,getPayload:t})}publish(e,...t){if(!h(this,s,"m",u).call(this,e))throw new Error(`Only allowed publishing events prefixed by '${h(this,a,"f")}:'`);h(this,i,"f").publish(e,...t)}subscribe(e,t,n){if(!h(this,s,"m",c).call(this,e))throw new Error(`Event missing from allow list: ${e}`);return n?h(this,i,"f").subscribe(e,t,n):h(this,i,"f").subscribe(e,t)}unsubscribe(e,t){if(!h(this,s,"m",c).call(this,e))throw new Error(`Event missing from allow list: ${e}`);h(this,i,"f").unsubscribe(e,t)}clearEventSubscriptions(e){if(!h(this,s,"m",u).call(this,e))throw new Error(`Only allowed clearing events prefixed by '${h(this,a,"f")}:'`);h(this,i,"f").clearEventSubscriptions(e)}}n.RestrictedMessenger=p,n.RestrictedControllerMessenger=p,i=new WeakMap,a=new WeakMap,r=new WeakMap,o=new WeakMap,s=new WeakSet,c=function(e){const t=h(this,o,"f");return h(this,s,"m",u).call(this,e)||null!==t&&t.includes(e)},l=function(e){const t=h(this,r,"f");return h(this,s,"m",u).call(this,e)||null!==t&&t.includes(e)},u=function(e){return e.startsWith(`${h(this,a,"f")}:`)}}}},{package:"@metamask/ppom-validator>@metamask/base-controller",file:"node_modules/@metamask/ppom-validator/node_modules/@metamask/base-controller/dist/RestrictedMessenger.cjs"}],[1854,{"./BaseControllerV1.cjs":1850,"./BaseControllerV2.cjs":1851,"./Messenger.cjs":1852,"./RestrictedMessenger.cjs":1853},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RestrictedMessenger=n.RestrictedControllerMessenger=n.Messenger=n.ControllerMessenger=n.isBaseController=n.getPersistentState=n.getAnonymizedState=n.BaseController=n.isBaseControllerV1=n.BaseControllerV1=void 0;var s=e("./BaseControllerV1.cjs");Object.defineProperty(n,"BaseControllerV1",{enumerable:!0,get:function(){return s.BaseControllerV1}}),Object.defineProperty(n,"isBaseControllerV1",{enumerable:!0,get:function(){return s.isBaseControllerV1}});var i=e("./BaseControllerV2.cjs");Object.defineProperty(n,"BaseController",{enumerable:!0,get:function(){return i.BaseController}}),Object.defineProperty(n,"getAnonymizedState",{enumerable:!0,get:function(){return i.getAnonymizedState}}),Object.defineProperty(n,"getPersistentState",{enumerable:!0,get:function(){return i.getPersistentState}}),Object.defineProperty(n,"isBaseController",{enumerable:!0,get:function(){return i.isBaseController}});var a=e("./Messenger.cjs");Object.defineProperty(n,"ControllerMessenger",{enumerable:!0,get:function(){return a.ControllerMessenger}}),Object.defineProperty(n,"Messenger",{enumerable:!0,get:function(){return a.Messenger}});var r=e("./RestrictedMessenger.cjs");Object.defineProperty(n,"RestrictedControllerMessenger",{enumerable:!0,get:function(){return r.RestrictedControllerMessenger}}),Object.defineProperty(n,"RestrictedMessenger",{enumerable:!0,get:function(){return r.RestrictedMessenger}})}}},{package:"@metamask/ppom-validator>@metamask/base-controller",file:"node_modules/@metamask/ppom-validator/node_modules/@metamask/base-controller/dist/index.cjs"}],[1855,{"./constants.cjs":1856,"@metamask/base-controller":1238,"@metamask/controller-utils":1315},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,i,a=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.PreferencesController=n.getDefaultPreferencesState=void 0;const r=e("@metamask/base-controller"),o=e("@metamask/controller-utils"),c=e("./constants.cjs"),l={featureFlags:{persist:!0,anonymous:!0},identities:{persist:!0,anonymous:!1},ipfsGateway:{persist:!0,anonymous:!1},isIpfsGatewayEnabled:{persist:!0,anonymous:!0},isMultiAccountBalancesEnabled:{persist:!0,anonymous:!0},lostIdentities:{persist:!0,anonymous:!1},openSeaEnabled:{persist:!0,anonymous:!0},securityAlertsEnabled:{persist:!0,anonymous:!0},selectedAddress:{persist:!0,anonymous:!1},showTestNetworks:{persist:!0,anonymous:!0},showIncomingTransactions:{persist:!0,anonymous:!0},useNftDetection:{persist:!0,anonymous:!0},useTokenDetection:{persist:!0,anonymous:!0},smartTransactionsOptInStatus:{persist:!0,anonymous:!1},useTransactionSimulations:{persist:!0,anonymous:!0},useMultiRpcMigration:{persist:!0,anonymous:!0},useSafeChainsListValidation:{persist:!0,anonymous:!0},tokenSortConfig:{persist:!0,anonymous:!0},privacyMode:{persist:!0,anonymous:!0}};function u(){return{featureFlags:{},identities:{},ipfsGateway:"https://ipfs.io/ipfs/",isIpfsGatewayEnabled:!0,isMultiAccountBalancesEnabled:!0,lostIdentities:{},openSeaEnabled:!1,securityAlertsEnabled:!1,selectedAddress:"",showIncomingTransactions:{[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.MAINNET]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.GOERLI]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.BSC]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.BSC_TESTNET]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.OPTIMISM]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.OPTIMISM_SEPOLIA]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.POLYGON]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.POLYGON_TESTNET]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.AVALANCHE]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.AVALANCHE_TESTNET]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.FANTOM]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.FANTOM_TESTNET]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.SEPOLIA]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.LINEA_GOERLI]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.LINEA_SEPOLIA]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.LINEA_MAINNET]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.MOONBEAM]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.MOONBEAM_TESTNET]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.MOONRIVER]:!0,[c.ETHERSCAN_SUPPORTED_CHAIN_IDS.GNOSIS]:!0},showTestNetworks:!1,useNftDetection:!1,useTokenDetection:!0,useMultiRpcMigration:!0,smartTransactionsOptInStatus:!0,useTransactionSimulations:!0,useSafeChainsListValidation:!0,tokenSortConfig:{key:"tokenFiatAmount",order:"dsc",sortCallback:"stringNumeric"},privacyMode:!1}}n.getDefaultPreferencesState=u;class d extends r.BaseController{constructor({messenger:e,state:t}){super({name:"PreferencesController",metadata:l,messenger:e,state:{...u(),...t}}),s.add(this),e.subscribe("KeyringController:stateChange",e=>{const t=new Set;for(const n of e.keyrings)for(const e of n.accounts)t.add(e);t.size>0&&a(this,s,"m",i).call(this,Array.from(t))})}addIdentities(e){const t=e.map(e=>(0,o.toChecksumHexAddress)(e));this.update(e=>{const{identities:n}=e;for(const e of t){if(n[e])continue;const t=Object.keys(n).length;n[e]={name:`Account ${t+1}`,address:e,importTime:Date.now()}}})}removeIdentity(e){e=(0,o.toChecksumHexAddress)(e);const{identities:t}=this.state;t[e]&&this.update(t=>{delete t.identities[e],e===t.selectedAddress&&(t.selectedAddress=Object.keys(t.identities)[0])})}setAccountLabel(e,t){e=(0,o.toChecksumHexAddress)(e),this.update(n=>{const s=n.identities[e]||{};s.name=t,n.identities[e]=s})}setFeatureFlag(e,t){this.update(n=>{n.featureFlags[e]=t})}setSelectedAddress(e){this.update(t=>{t.selectedAddress=(0,o.toChecksumHexAddress)(e)})}setIpfsGateway(e){this.update(t=>{t.ipfsGateway=e})}setUseTokenDetection(e){this.update(t=>{t.useTokenDetection=e})}setUseNftDetection(e){if(e&&!this.state.openSeaEnabled)throw new Error("useNftDetection cannot be enabled if openSeaEnabled is false");this.update(t=>{t.useNftDetection=e})}setOpenSeaEnabled(e){this.update(t=>{t.openSeaEnabled=e,e||(t.useNftDetection=!1)})}setSecurityAlertsEnabled(e){this.update(t=>{t.securityAlertsEnabled=e})}setIsMultiAccountBalancesEnabled(e){this.update(t=>{t.isMultiAccountBalancesEnabled=e})}setShowTestNetworks(e){this.update(t=>{t.showTestNetworks=e})}setIsIpfsGatewayEnabled(e){this.update(t=>{t.isIpfsGatewayEnabled=e})}setEnableNetworkIncomingTransactions(e,t){Object.values(c.ETHERSCAN_SUPPORTED_CHAIN_IDS).includes(e)&&this.update(n=>{n.showIncomingTransactions={...this.state.showIncomingTransactions,[e]:t}})}setUseMultiRpcMigration(e){this.update(t=>{t.useMultiRpcMigration=e,e||(t.useMultiRpcMigration=!1)})}setSmartTransactionsOptInStatus(e){this.update(t=>{t.smartTransactionsOptInStatus=e})}setUseTransactionSimulations(e){this.update(t=>{t.useTransactionSimulations=e})}setTokenSortConfig(e){this.update(t=>{t.tokenSortConfig=e})}setUseSafeChainsListValidation(e){this.update(t=>{t.useSafeChainsListValidation=e})}setPrivacyMode(e){this.update(t=>{t.privacyMode=e})}}n.PreferencesController=d,s=new WeakSet,i=function(e){e=e.map(e=>(0,o.toChecksumHexAddress)(e)),this.update(t=>{const{identities:n}=t,s={};for(const[t,i]of Object.entries(n))e.includes(t)||(s[t]=i,delete n[t]);for(const[e,n]of Object.entries(s))t.lostIdentities[e]=n}),this.addIdentities(e),e.includes(this.state.selectedAddress)||this.update(t=>{t.selectedAddress=e[0]})},n.default=d}}},{package:"@metamask/preferences-controller",file:"node_modules/@metamask/preferences-controller/dist/PreferencesController.cjs"}],[1856,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ETHERSCAN_SUPPORTED_CHAIN_IDS=void 0,n.ETHERSCAN_SUPPORTED_CHAIN_IDS={MAINNET:"0x1",GOERLI:"0x5",BSC:"0x38",BSC_TESTNET:"0x61",OPTIMISM:"0xa",OPTIMISM_SEPOLIA:"0xaa37dc",POLYGON:"0x89",POLYGON_TESTNET:"0x13881",AVALANCHE:"0xa86a",AVALANCHE_TESTNET:"0xa869",FANTOM:"0xfa",FANTOM_TESTNET:"0xfa2",SEPOLIA:"0xaa36a7",LINEA_GOERLI:"0xe704",LINEA_SEPOLIA:"0xe705",LINEA_MAINNET:"0xe708",MOONBEAM:"0x504",MOONBEAM_TESTNET:"0x507",MOONRIVER:"0x505",GNOSIS:"0x64"}}}},{package:"@metamask/preferences-controller",file:"node_modules/@metamask/preferences-controller/dist/constants.cjs"}],[1857,{"./PreferencesController.cjs":1855,"./constants.cjs":1856},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.ETHERSCAN_SUPPORTED_CHAIN_IDS=void 0,i(e("./PreferencesController.cjs"),n);var a=e("./constants.cjs");Object.defineProperty(n,"ETHERSCAN_SUPPORTED_CHAIN_IDS",{enumerable:!0,get:function(){return a.ETHERSCAN_SUPPORTED_CHAIN_IDS}})}}},{package:"@metamask/preferences-controller",file:"node_modules/@metamask/preferences-controller/dist/index.cjs"}],[1858,{"../../sdk/index.cjs":1885,"./auth-snap-requests.cjs":1859,"@metamask/base-controller":1238},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,i,a,r,o,c,l,u,d,h,p,m,f,g,y=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)},w=this&&this.__classPrivateFieldSet||function(e,t,n,s,i){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?i.call(e,n):i?i.value=n:t.set(e,n),n};Object.defineProperty(n,"__esModule",{value:!0}),n.defaultState=void 0;const S=e("@metamask/base-controller"),b=e("./auth-snap-requests.cjs"),v=e("../../sdk/index.cjs");n.defaultState={isSignedIn:!1};const T={isSignedIn:{persist:!0,anonymous:!0},srpSessionData:{persist:!0,anonymous:!1}};class k extends S.BaseController{constructor({messenger:e,state:t,config:h,metametrics:m}){if(super({messenger:e,metadata:T,name:"AuthenticationController",state:{...n.defaultState,...t}}),s.add(this),i.set(this,void 0),a.set(this,void 0),r.set(this,{env:v.Env.PRD}),o.set(this,!1),c.set(this,{setupLockedStateSubscriptions:()=>{const{isUnlocked:e}=this.messagingSystem.call("KeyringController:getState");w(this,o,e,"f"),this.messagingSystem.subscribe("KeyringController:unlock",()=>{w(this,o,!0,"f")}),this.messagingSystem.subscribe("KeyringController:lock",()=>{w(this,o,!1,"f")})}}),f.set(this,{}),!m)throw new Error("`metametrics` field is required");w(this,r,{...y(this,r,"f"),...h},"f"),w(this,i,m,"f"),w(this,a,new v.JwtBearerAuth({env:y(this,r,"f").env,platform:m.agent,type:v.AuthType.SRP},{storage:{getLoginResponse:y(this,s,"m",u).bind(this),setLoginResponse:y(this,s,"m",d).bind(this)},signing:{getIdentifier:y(this,s,"m",p).bind(this),signMessage:y(this,s,"m",g).bind(this)},metametrics:y(this,i,"f")}),"f"),y(this,c,"f").setupLockedStateSubscriptions(),y(this,s,"m",l).call(this)}async performSignIn(){y(this,s,"m",h).call(this,"performSignIn");const e=await y(this,s,"m",m).call(this),t=[];for(const[n]of e){const e=await y(this,a,"f").getAccessToken(n);t.push(e)}return t}performSignOut(){this.update(e=>{e.isSignedIn=!1,e.srpSessionData=undefined})}async getBearerToken(e){return y(this,s,"m",h).call(this,"getBearerToken"),await y(this,a,"f").getAccessToken(e)}async getSessionProfile(e){return y(this,s,"m",h).call(this,"getSessionProfile"),await y(this,a,"f").getUserProfile(e)}async getUserProfileLineage(){return y(this,s,"m",h).call(this,"getUserProfileLineage"),await y(this,a,"f").getUserProfileLineage()}isSignedIn(){return this.state.isSignedIn}}i=new WeakMap,a=new WeakMap,r=new WeakMap,o=new WeakMap,c=new WeakMap,f=new WeakMap,s=new WeakSet,l=function(){this.messagingSystem.registerActionHandler("AuthenticationController:getBearerToken",this.getBearerToken.bind(this)),this.messagingSystem.registerActionHandler("AuthenticationController:getSessionProfile",this.getSessionProfile.bind(this)),this.messagingSystem.registerActionHandler("AuthenticationController:isSignedIn",this.isSignedIn.bind(this)),this.messagingSystem.registerActionHandler("AuthenticationController:performSignIn",this.performSignIn.bind(this)),this.messagingSystem.registerActionHandler("AuthenticationController:performSignOut",this.performSignOut.bind(this)),this.messagingSystem.registerActionHandler("AuthenticationController:getUserProfileLineage",this.getUserProfileLineage.bind(this))},u=async function(e){if(e)return this.state.srpSessionData?.[e]?this.state.srpSessionData[e]:null;const t=Object.values(this.state.srpSessionData||{})?.[0];return t||null},d=async function(e,t){const n=await y(this,i,"f").getMetaMetricsId();this.update(s=>{t&&(s.isSignedIn=!0,s.srpSessionData||(s.srpSessionData={}),s.srpSessionData[t]={...e,profile:{...e.profile,metaMetricsId:n}})})},h=function(e){if(!y(this,o,"f"))throw new Error(`${e} - unable to proceed, wallet is locked`)},p=async function(e){y(this,s,"m",h).call(this,"#snapGetPublicKey");return await this.messagingSystem.call("SnapController:handleRequest",(0,b.createSnapPublicKeyRequest)(e))},m=async function(){y(this,s,"m",h).call(this,"#snapGetAllPublicKeys");return await this.messagingSystem.call("SnapController:handleRequest",(0,b.createSnapAllPublicKeysRequest)())},g=async function(e,t){if((0,v.assertMessageStartsWithMetamask)(e),y(this,f,"f")[e])return y(this,f,"f")[e];y(this,s,"m",h).call(this,"#snapSignMessage");const n=await this.messagingSystem.call("SnapController:handleRequest",(0,b.createSnapSignMessageRequest)(e,t));return y(this,f,"f")[e]=n,n},n.default=k}}},{package:"@metamask/profile-sync-controller",file:"node_modules/@metamask/profile-sync-controller/dist/controllers/authentication/AuthenticationController.cjs"}],[186,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getSnapAndHardwareInfoForMetrics=async function(e,t,n,s){var i,a,r;if(!s)return{};const o=s.call("AccountsController:getSelectedAccount"),c=o.address;let l;var u;null!==(i=o.metadata.snap)&&void 0!==i&&i.id&&(l=s.call("SnapController:get",null===(u=o.metadata.snap)||void 0===u?void 0:u.id));return{account_type:await e(c),device_model:await t(c),account_hardware_type:await n(c),account_snap_type:null===(a=l)||void 0===a?void 0:a.id,account_snap_version:null===(r=l)||void 0===r?void 0:r.version}}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/metrics.ts"}],[1860,{"./AuthenticationController.cjs":1858,"./mocks/index.cjs":1861},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),i=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)},r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&s(t,e,n);return i(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.Mocks=n.Controller=void 0;const c=o(e("./AuthenticationController.cjs"));n.Controller=c.default;const l=c.default;n.default=l,a(e("./AuthenticationController.cjs"),n),n.Mocks=r(e("./mocks/index.cjs"))}}},{package:"@metamask/profile-sync-controller",file:"node_modules/@metamask/profile-sync-controller/dist/controllers/authentication/index.cjs"}],[1861,{"./mockResponses.cjs":1862},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),i(e("./mockResponses.cjs"),n)}}},{package:"@metamask/profile-sync-controller",file:"node_modules/@metamask/profile-sync-controller/dist/controllers/authentication/mocks/index.cjs"}],[1862,{"../../../sdk/mocks/auth.cjs":1886},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getMockAuthAccessTokenResponse=n.MOCK_OATH_TOKEN_RESPONSE=n.getMockAuthLoginResponse=n.MOCK_LOGIN_RESPONSE=n.getMockAuthNonceResponse=n.MOCK_JWT=n.MOCK_NONCE=n.MOCK_NONCE_RESPONSE=void 0;const s=e("../../../sdk/mocks/auth.cjs");n.MOCK_NONCE_RESPONSE=s.MOCK_NONCE_RESPONSE,n.MOCK_NONCE=n.MOCK_NONCE_RESPONSE.nonce,n.MOCK_JWT=s.MOCK_JWT;n.getMockAuthNonceResponse=()=>({url:s.MOCK_NONCE_URL,requestMethod:"GET",response:(e,t,s)=>{const i=t?.split("?identifier=")[1],a=s?.(i??"");return{...n.MOCK_NONCE_RESPONSE,nonce:a??n.MOCK_NONCE_RESPONSE.nonce,identifier:n.MOCK_NONCE_RESPONSE.identifier}}}),n.MOCK_LOGIN_RESPONSE=s.MOCK_SRP_LOGIN_RESPONSE;n.getMockAuthLoginResponse=()=>({url:s.MOCK_SRP_LOGIN_URL,requestMethod:"POST",response:e=>{const t=e?.raw_message.split(":"),s=t?.[t.length-2];return{...n.MOCK_LOGIN_RESPONSE,token:s??n.MOCK_LOGIN_RESPONSE.token,profile:{...n.MOCK_LOGIN_RESPONSE.profile,profile_id:s??n.MOCK_LOGIN_RESPONSE.profile.profile_id,identifier_id:s??n.MOCK_LOGIN_RESPONSE.profile.identifier_id}}}}),n.MOCK_OATH_TOKEN_RESPONSE=s.MOCK_OIDC_TOKEN_RESPONSE;n.getMockAuthAccessTokenResponse=()=>({url:s.MOCK_OIDC_TOKEN_URL,requestMethod:"POST",response:e=>{const t=new URLSearchParams(e).get("assertion");return{...n.MOCK_OATH_TOKEN_RESPONSE,access_token:t??n.MOCK_OATH_TOKEN_RESPONSE.access_token}}})}}},{package:"@metamask/profile-sync-controller",file:"node_modules/@metamask/profile-sync-controller/dist/controllers/authentication/mocks/mockResponses.cjs"}],[187,{"../../../../shared/constants/app":4975,"../../../../shared/constants/metametrics":4989,"../../../../shared/lib/accounts":5014,"../../../../shared/lib/accounts/snaps":5016,"../../../../shared/lib/snaps/snaps":5066,"../../../../shared/lib/translate":5076,"../../../../ui/components/component-library/icon":5636,"./utils/isBlockedUrl":189,"./utils/showResult":190,"@metamask/eth-snap-keyring":1435,"@metamask/snaps-utils":2245,"webextension-polyfill":4951},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.showAccountCreationDialog=v,n.showAccountNameSuggestionDialog=T,n.snapKeyringBuilder=function(e,t){const n=()=>new i.SnapKeyring({messenger:e,callbacks:new A(e,t)});return n.type=i.SnapKeyring.type,n};var s,i=e("@metamask/eth-snap-keyring"),a=(s=e("webextension-polyfill"))&&s.__esModule?s:{default:s},r=e("@metamask/snaps-utils"),o=e("../../../../shared/constants/metametrics"),c=e("../../../../shared/constants/app"),l=e("../../../../shared/lib/translate"),u=e("../../../../ui/components/component-library/icon"),d=e("../../../../shared/lib/accounts"),h=e("../../../../shared/lib/snaps/snaps"),p=e("../../../../shared/lib/accounts/snaps"),m=e("./utils/isBlockedUrl"),f=e("./utils/showResult");function g(e,t,n){y(e,t),t.set(e,n)}function y(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function w(e,t){return e.get(b(e,t))}function S(e,t,n){return e.set(b(e,t),n),n}function b(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}async function v(e,t){try{return Boolean(await t.call("ApprovalController:addRequest",{origin:e,type:c.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountCreation},!0))}catch(e){throw new Error(`Error occurred while showing account creation dialog.\n${e}`)}}async function T(e,t,n){try{return await t.call("ApprovalController:addRequest",{origin:e,type:c.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.showNameSnapAccount,requestData:{snapSuggestedAccountName:n}},!0)}catch(e){throw new Error(`Error occurred while showing name account dialog.\n${e}`)}}var k=new WeakMap,_=new WeakMap,E=new WeakMap,C=new WeakMap,P=new WeakSet;class A{constructor(e,{trackEvent:t,persistKeyringHelper:n,removeAccountHelper:s}){!function(e,t){y(e,t),t.add(e)}(this,P),g(this,k,void 0),g(this,_,void 0),g(this,E,void 0),g(this,C,void 0),S(k,this,e),S(_,this,t),S(E,this,n),S(C,this,s)}async addressExists(e){return(await w(k,this).call("KeyringController:getAccounts")).includes(e.toLowerCase())}async redirectUser(e,t,n){if(t.length>0||n.length>0){const s=await(0,m.isBlockedUrl)(t,async()=>await w(k,this).call("PhishingController:maybeUpdateState"),e=>w(k,this).call("PhishingController:testOrigin",e)),i=await w(k,this).call("ApprovalController:addRequest",{origin:e,requestData:{url:t,message:n,isBlockedUrl:s},type:c.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.showSnapAccountRedirect},!0);Boolean(i)&&t.length>0?a.default.tabs.create({url:t}):console.log("User refused snap account redirection to:",t)}else console.log("Error occurred when redirecting snap account. url or message must be defined")}async saveState(){await w(E,this).call(this)}async addAccount(e,t,n,s,a="",{displayConfirmation:o,displayAccountNameSuggestion:c,setSelectedAccount:l}=(0,i.getDefaultInternalOptions)()){(0,r.assertIsValidSnapId)(t);const u=(0,h.isSnapPreinstalled)(t)&&!o,d=(0,h.isSnapPreinstalled)(t)&&!c,p=(0,h.isSnapPreinstalled)(t)&&!l,{accountName:m}=await b(P,this,j).call(this,{snapId:t,skipConfirmationDialog:u,skipAccountNameSuggestionDialog:d,accountNameSuggestion:a,handleUserInput:n});b(P,this,N).call(this,{address:e,snapId:t,skipConfirmationDialog:u,skipSetSelectedAccountStep:p,accountName:m,onceSaved:s,defaultAccountNameChosen:Boolean(a)&&m===a})}async removeAccount(e,t,n){(0,r.assertIsValidSnapId)(t);const s=(0,p.getSnapName)(t,w(k,this)),{id:i}=w(k,this).call("ApprovalController:startFlow"),a="https://support.metamask.io/managing-my-wallet/accounts-and-addresses/how-to-remove-an-account-from-your-metamask-wallet/",d=e=>{w(_,this).call(this,{event:e,category:o.MetaMetricsEventCategory.Accounts,properties:{account_type:o.MetaMetricsEventAccountType.Snap,snap_id:t,snap_name:s}})};let h=!1;try{if(h=Boolean(await w(k,this).call("ApprovalController:addRequest",{origin:t,type:c.SNAP_MANAGE_ACCOUNTS_CONFIRMATION_TYPES.confirmAccountRemoval,requestData:{publicAddress:e}},!0)),!h)throw await n(h),new Error("User denied account removal");try{await w(C,this).call(this,e),await n(h),await w(E,this).call(this),d(o.MetaMetricsEventName.RemoveSnapAccountSuccessViewed),await(0,f.showError)(w(k,this),t,{icon:u.IconName.UserCircleRemove,title:(0,l.t)("snapAccountRemoved")},{message:(0,l.t)("snapAccountRemovedDescription"),learnMoreLink:a}),d(o.MetaMetricsEventName.RemoveSnapAccountSuccessClicked)}catch(e){const n=e.message;throw await(0,f.showError)(w(k,this),t,{icon:u.IconName.UserCircleRemove,title:(0,l.t)("snapAccountRemovalFailed")},{message:(0,l.t)("snapAccountRemovalFailedDescription",s),learnMoreLink:a,error:n}),d(o.MetaMetricsEventName.AccountRemoveFailed),new Error(`Error occurred while removing snap account: ${n}`)}}finally{h&&d(o.MetaMetricsEventName.AccountRemoved),w(k,this).call("ApprovalController:endFlow",{id:i})}}}async function I(e){const{id:t}=w(k,this).call("ApprovalController:startFlow");try{return await e(t)}finally{w(k,this).call("ApprovalController:endFlow",{id:t})}}async function O(e,t){const{success:n,name:s}=await T(e,w(k,this),t);return{success:n,accountName:s}}async function M(e){const t=await w(k,this).call("AccountsController:listMultichainAccounts");return{success:!0,accountName:(0,d.getUniqueAccountName)(t,e)}}async function j({snapId:e,skipConfirmationDialog:t,skipAccountNameSuggestionDialog:n,handleUserInput:s,accountNameSuggestion:i}){return await b(P,this,I).call(this,async a=>{{const n=t||await v(e,w(k,this));if(!n)throw await s(n),new Error("User denied account creation")}{const{success:t,accountName:a}=n?await b(P,this,M).call(this,i):await b(P,this,O).call(this,e,i);if(await s(t),!t)throw new Error("User denied account creation");return{accountName:a}}})}async function N({address:e,snapId:t,skipConfirmationDialog:n,skipSetSelectedAccountStep:s,accountName:i,onceSaved:a,defaultAccountNameChosen:r}){const c="https://support.metamask.io/managing-my-wallet/accounts-and-addresses/how-to-add-accounts-in-your-wallet/",d=(0,p.getSnapName)(t,w(k,this)),h=e=>{w(_,this).call(this,{event:e,category:o.MetaMetricsEventCategory.Accounts,properties:{account_type:o.MetaMetricsEventAccountType.Snap,snap_id:t,snap_name:d,...e===o.MetaMetricsEventName.AccountAdded&&{is_suggested_name:r}}})};await b(P,this,I).call(this,async r=>{try{const r=await a;s||w(k,this).call("AccountsController:setSelectedAccount",r),i&&w(k,this).call("AccountsController:setAccountName",r,i),n||(h(o.MetaMetricsEventName.AddSnapAccountSuccessViewed),await(0,f.showSuccess)(w(k,this),t,{icon:u.IconName.UserCircleAdd,title:(0,l.t)("snapAccountCreated")},{message:(0,l.t)("snapAccountCreatedDescription"),address:e,learnMoreLink:c}),h(o.MetaMetricsEventName.AddSnapAccountSuccessClicked)),h(o.MetaMetricsEventName.AccountAdded)}catch(e){const n=e.message;await(0,f.showError)(w(k,this),t,{icon:u.IconName.UserCircleAdd,title:(0,l.t)("snapAccountCreationFailed")},{message:(0,l.t)("snapAccountCreationFailedDescription",d),learnMoreLink:c,error:n}),console.error("Error occurred while creating snap account:",n)}})}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/snap-keyring.ts"}],[188,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getAccountsBySnapId=void 0;n.getAccountsBySnapId=async(e,t)=>{const n=await e();return await n.getAccountsBySnapId(t)}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/utils.ts"}],[1886,{"../../shared/env.cjs":1896,"../authentication-jwt-bearer/services.cjs":1881},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.MOCK_USER_PROFILE_LINEAGE_RESPONSE=n.MOCK_OIDC_TOKEN_RESPONSE=n.MOCK_SRP_LOGIN_RESPONSE=n.MOCK_SIWE_LOGIN_RESPONSE=n.MOCK_NONCE_RESPONSE=n.MOCK_ACCESS_JWT=n.MOCK_JWT=n.MOCK_PROFILE_LINEAGE_URL=n.MOCK_PAIR_IDENTIFIERS_URL=n.MOCK_SIWE_LOGIN_URL=n.MOCK_OIDC_TOKEN_URL=n.MOCK_SRP_LOGIN_URL=n.MOCK_NONCE_URL=void 0;const s=e("../../shared/env.cjs"),i=e("../authentication-jwt-bearer/services.cjs");n.MOCK_NONCE_URL=(0,i.NONCE_URL)(s.Env.PRD),n.MOCK_SRP_LOGIN_URL=(0,i.SRP_LOGIN_URL)(s.Env.PRD),n.MOCK_OIDC_TOKEN_URL=(0,i.OIDC_TOKEN_URL)(s.Env.PRD),n.MOCK_SIWE_LOGIN_URL=(0,i.SIWE_LOGIN_URL)(s.Env.PRD),n.MOCK_PAIR_IDENTIFIERS_URL=(0,i.PAIR_IDENTIFIERS)(s.Env.PRD),n.MOCK_PROFILE_LINEAGE_URL=(0,i.PROFILE_LINEAGE_URL)(s.Env.PRD),n.MOCK_JWT="eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImIwNzE2N2U2LWJjNWUtNDgyZC1hNjRhLWU1MjQ0MjY2MGU3NyJ9.eyJzdWIiOiI1MzE0ODc5YWM2NDU1OGI3OTQ5ZmI4NWIzMjg2ZjZjNjUwODAzYmFiMTY0Y2QyOWNmMmM3YzdmMjMzMWMwZTRlIiwiaWF0IjoxNzA2MTEzMDYyLCJleHAiOjE3NjkxODUwNjMsImlzcyI6ImF1dGgubWV0YW1hc2suaW8iLCJhdWQiOiJwb3J0Zm9saW8ubWV0YW1hc2suaW8ifQ.E5UL6oABNweS8t5a6IBTqTf7NLOJbrhJSmEcsr7kwLp4bGvcENJzACwnsHDkA6PlzfDV09ZhAGU_F3hlS0j-erbY0k0AFR-GAtyS7E9N02D8RgUDz5oDR65CKmzM8JilgFA8UvruJ6OJGogroaOSOqzRES_s8MjHpP47RJ9lXrUesajsbOudXbuksXWg5QmWip6LLvjwr8UUzcJzNQilyIhiEpo4WdzWM4R3VtTwr4rHnWEvtYnYCov1jmI2w3YQ48y0M-3Y9IOO0ov_vlITRrOnR7Y7fRUGLUFmU5msD8mNWRywjQFLHfJJ1yNP5aJ8TkuCK3sC6kcUH335IVvukQ",n.MOCK_ACCESS_JWT="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c",n.MOCK_NONCE_RESPONSE={nonce:"xGMm9SoihEKeAEfV",identifier:"0xd8641601Cb79a94FD872fE42d5b4a067A44a7e88",expires_in:300},n.MOCK_SIWE_LOGIN_RESPONSE={token:n.MOCK_JWT,expires_in:3600,profile:{profile_id:"fa2bbf82-bd9a-4e6b-aabc-9ca0d0319b6e",metametrics_id:"de742679-4960-4977-a415-4718b5f8e86c",identifier_id:"ec9a4e9906836497efad2fd4d4290b34d2c6a2c0d93eb174aa3cd88a133adbaf",identifier_type:"SIWE",encrypted_storage_key:"2c6a2c0d93eb174aa3cd88a133adbaf"}},n.MOCK_SRP_LOGIN_RESPONSE={token:n.MOCK_JWT,expires_in:3600,profile:{profile_id:"f88227bd-b615-41a3-b0be-467dd781a4ad",metametrics_id:"561ec651-a844-4b36-a451-04d6eac35740",identifier_id:"da9a9fc7b09edde9cc23cec9b7e11a71fb0ab4d2ddd8af8af905306f3e1456fb",identifier_type:"SRP",encrypted_storage_key:"d2ddd8af8af905306f3e1456fb"}},n.MOCK_OIDC_TOKEN_RESPONSE={access_token:n.MOCK_ACCESS_JWT,expires_in:3600},n.MOCK_USER_PROFILE_LINEAGE_RESPONSE={profile_id:"f88227bd-b615-41a3-b0be-467dd781a4ad",created_at:"2025-10-01T12:00:00Z",lineage:[{metametrics_id:"561ec651-a844-4b36-a451-04d6eac35740",agent:s.Platform.MOBILE,created_at:"2025-10-01T12:00:00Z",updated_at:"2025-10-01T12:00:00Z",counter:1},{metametrics_id:"de742679-4960-4977-a415-4718b5f8e86c",agent:s.Platform.EXTENSION,created_at:"2025-10-01T12:00:00Z",updated_at:"2025-10-01T12:00:00Z",counter:2}]}}}},{package:"@metamask/profile-sync-controller",file:"node_modules/@metamask/profile-sync-controller/dist/sdk/mocks/auth.cjs"}],[189,{"../keyring-snaps-permissions":185},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isBlockedUrl=void 0;var s=e("../keyring-snaps-permissions");n.isBlockedUrl=async(e,t,n)=>{try{return!(0,s.isProtocolAllowed)(e)||(await t(),n(e).result)}catch(e){return console.error("Invalid URL passed into snap-keyring:",e),!1}}}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/utils/isBlockedUrl.ts"}],[19,{"@metamask/assets-controllers":1148},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.DeFiPositionsControllerInit=void 0;var s=e("@metamask/assets-controllers");n.DeFiPositionsControllerInit=({initMessenger:e,controllerMessenger:t,getController:n,trackEvent:i})=>({controller:new s.DeFiPositionsController({messenger:t,isEnabled:()=>{var t;const s=n("PreferencesController"),{useExternalServices:i}=s.state,a=e.call("RemoteFeatureFlagController:getState"),r=Boolean(null==a||null===(t=a.remoteFeatureFlags)||void 0===t?void 0:t.assetsDefiPositionsEnabled);return i&&r},trackEvent:i})})}}},{package:"$root$",file:"app/scripts/controller-init/defi-positions/defi-positions-controller-init.ts"}],[190,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.showSuccess=n.showError=void 0;const s=e=>({name:"SnapAuthorshipHeader",key:"snapHeader",properties:{snapId:e}});n.showError=(e,t,n,i)=>e.call("ApprovalController:showError",{header:[s(t)],title:n.title,icon:n.icon,error:{key:"snapAccountErrorMessage",name:"SnapAccountErrorMessage",properties:i}});n.showSuccess=(e,t,n,i)=>e.call("ApprovalController:showSuccess",{header:[s(t)],title:n.title,icon:n.icon,message:{key:"snapAccountSuccessMessage",name:"SnapAccountSuccessMessage",properties:i}})}}},{package:"$root$",file:"app/scripts/lib/snap-keyring/utils/showResult.ts"}],[191,{loglevel:4096},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.tryPostMessage=function(e,t,n){const s={data:{method:t,params:n}};try{return e.postMessage(s),!0}catch(e){return i.default.error("MetaMask - Failed to message to port",e,s),!1}};var s,i=(s=e("loglevel"))&&s.__esModule?s:{default:s}}}},{package:"$root$",file:"app/scripts/lib/start-up-errors/start-up-errors.ts"}],[192,{"../../../../shared/constants/start-up-errors":5003,"../../../../shared/constants/state-corruption":5004,"../start-up-errors/start-up-errors":191,"@metamask/utils":2361},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.CorruptionHandler=void 0,n.hasVault=c;var s=e("@metamask/utils"),i=e("../../../../shared/constants/state-corruption"),a=e("../start-up-errors/start-up-errors"),r=e("../../../../shared/constants/start-up-errors");function o(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function c(e){if((0,s.isObject)(e)&&(0,s.hasProperty)(e,"KeyringController")){const t=e.KeyringController;if((0,s.isObject)(t)&&(0,s.hasProperty)(t,"vault"))return Boolean(t.vault)}return!1}n.CorruptionHandler=class{constructor(){o(this,"connectedPorts",new Set)}async handleStateCorruptionError({port:e,error:t,database:n,repairCallback:o}){const{connectedPorts:l}=this,u=await async function(e,t){let n=(0,s.isObject)(e)&&(0,s.hasProperty)(e,"backup")&&null!==e.backup?e.backup:null;if(!n)try{n=await t.getBackup()??null}catch{n=null}return n}(t,n),d=function(e){if((0,s.isObject)(e)&&(0,s.hasProperty)(e,"PreferencesController")){const t=e.PreferencesController;if((0,s.isObject)(t)&&(0,s.hasProperty)(t,"currentLocale")&&"string"==typeof t.currentLocale)return t.currentLocale}return null}(u),h=Boolean(c(u));return(0,a.tryPostMessage)(e,i.METHOD_DISPLAY_STATE_CORRUPTION_ERROR,{error:{message:t.message,name:t.name,stack:t.stack},currentLocale:d,hasBackup:h})?new Promise((t,n)=>{l.add(e),e.onDisconnect.addListener(function(){l.delete(e),t()}),e.onMessage.addListener(async function e(s){var c;if((null==s||null===(c=s.data)||void 0===c?void 0:c.method)===i.METHOD_REPAIR_DATABASE){l.forEach(t=>t.onMessage.removeListener(e));try{await async function(e){return await navigator.locks.request("repairDatabase",{ifAvailable:!0},async function(t){return null!==t&&(await e(),!0)})}(async function(){try{await o(u)}finally{l.forEach(e=>{(0,a.tryPostMessage)(e,r.RELOAD_WINDOW)})}}),t()}catch(e){n(e)}}})}):Promise.resolve()}}}}},{package:"$root$",file:"app/scripts/lib/state-corruption/state-corruption-recovery.ts"}],[193,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.sanitizeUIState=function(e){const t={...e};for(const e of s)delete t[e];return function(e){const t=e.snaps;if(!t)return;e.snaps=Object.values(t).reduce((e,t)=>(e[t.id]=function(e){const t={...e};return delete t.sourceCode,delete t.auxiliaryFiles,t}(t),e),{})}(t),function(e){const t=e.srpSessionData;if(!t)return;e.srpSessionData=Object.entries(t).reduce((e,[t,n])=>{const s={...n.token};return delete s.accessToken,e[t]={...n,token:s},e},{})}(t),function(e){const t=["vault","vaultEncryptionKey","vaultEncryptionSalt","encryptedSeedlessEncryptionKey","encryptedKeyringEncryptionKey","accessToken","metadataAccessToken","refreshToken","revokeToken"];for(const n of t)delete e[n];const n=e.nodeAuthTokens;n&&(e.nodeAuthTokens=n.map(e=>{const t={...e};return delete t.authToken,t}));const s=e.socialBackupsMetadata;s&&(e.socialBackupsMetadata=s.map(e=>{const t={...e};return delete t.hash,t}))}(t),t};const s=["snapStates","unencryptedSnapStates","phishingLists","whitelist","hotlistLastFetched","stalelistLastFetched","c2DomainBlocklistLastFetched","vault","encryptionKey","encryptionSalt"]}}},{package:"$root$",file:"app/scripts/lib/state-utils.ts"}],[1947,{"@metamask/base-controller":1238,"@metamask/rpc-errors":1958,"@metamask/utils":2361},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RateLimitController=void 0;const s=e("@metamask/base-controller"),i=e("@metamask/rpc-errors"),a=e("@metamask/utils"),r="RateLimitController",o={requests:{persist:!1,anonymous:!1}};class c extends s.BaseController{constructor({rateLimitTimeout:e=5e3,rateLimitCount:t=1,messenger:n,state:s,implementations:i}){const c={requests:(0,a.getKnownPropertyNames)(i).reduce((e,t)=>({...e,[t]:{}}),{})};super({name:r,metadata:o,messenger:n,state:{...c,...s}}),this.implementations=i,this.rateLimitTimeout=e,this.rateLimitCount=t,this.messagingSystem.registerActionHandler(`${r}:call`,(e,t,...n)=>this.call(e,t,...n))}async call(e,t,...n){if(this.isRateLimited(t,e))throw i.rpcErrors.limitExceeded({message:`"${t.toString()}" is currently rate-limited. Please try again later.`});this.recordRequest(t,e);const s=this.implementations[t].method;if(!s)throw new Error("Invalid api type");return s(...n)}isRateLimited(e,t){const n=this.implementations[e].rateLimitCount??this.rateLimitCount;return this.state.requests[e][t]>=n}recordRequest(e,t){const n=this.implementations[e].rateLimitTimeout??this.rateLimitTimeout,s=this.state.requests[e][t]??0;this.update(i=>{0===s&&setTimeout(()=>this.resetRequestCount(e,t),n),Object.assign(i,{requests:{...i.requests,[e]:{[t]:s+1}}})})}resetRequestCount(e,t){this.update(n=>{Object.assign(n,{requests:{...n.requests,[e]:{[t]:0}}})})}}n.RateLimitController=c}}},{package:"@metamask/rate-limit-controller",file:"node_modules/@metamask/rate-limit-controller/dist/RateLimitController.cjs"}],[1948,{"./RateLimitController.cjs":1947},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RateLimitController=void 0;var s=e("./RateLimitController.cjs");Object.defineProperty(n,"RateLimitController",{enumerable:!0,get:function(){return s.RateLimitController}})}}},{package:"@metamask/rate-limit-controller",file:"node_modules/@metamask/rate-limit-controller/dist/index.cjs"}],[1949,{"../constants.cjs":1950,"@metamask/controller-utils":1315},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,i,a,r,o,c=this&&this.__classPrivateFieldSet||function(e,t,n,s,i){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?i.call(e,n):i?i.value=n:t.set(e,n),n},l=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.ClientConfigApiService=void 0;const u=e("@metamask/controller-utils"),d=e("../constants.cjs");n.ClientConfigApiService=class{constructor({fetch:e,retries:t=u.DEFAULT_MAX_RETRIES,maximumConsecutiveFailures:n=u.DEFAULT_MAX_CONSECUTIVE_FAILURES,circuitBreakDuration:d=u.DEFAULT_CIRCUIT_BREAK_DURATION,onBreak:h,onDegraded:p,config:m}){s.set(this,void 0),i.set(this,void 0),a.set(this,void 0),r.set(this,void 0),o.set(this,void 0),c(this,s,e,"f"),c(this,a,m.client,"f"),c(this,r,m.distribution,"f"),c(this,o,m.environment,"f"),c(this,i,(0,u.createServicePolicy)({maxRetries:t,maxConsecutiveFailures:n,circuitBreakDuration:d}),"f"),h&&l(this,i,"f").onBreak(h),p&&l(this,i,"f").onDegraded(p)}onBreak(...e){return l(this,i,"f").onBreak(...e)}onDegraded(...e){return l(this,i,"f").onDegraded(...e)}async fetchRemoteFeatureFlags(){const e=`${d.BASE_URL}/flags?client=${l(this,a,"f")}&distribution=${l(this,r,"f")}&environment=${l(this,o,"f")}`,t=await l(this,i,"f").execute(()=>l(this,s,"f").call(this,e,{cache:"no-cache"}));if(!t.ok)throw new Error("Failed to fetch remote feature flags");const n=await t.json();if(!Array.isArray(n))throw new Error("Feature flags api did not return an array");return{remoteFeatureFlags:this.flattenFeatureFlags(n),cacheTimestamp:Date.now()}}flattenFeatureFlags(e){return e.reduce((e,t)=>({...e,...t}),{})}},s=new WeakMap,i=new WeakMap,a=new WeakMap,r=new WeakMap,o=new WeakMap}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/client-config-api-service/client-config-api-service.cjs"}],[1950,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.BASE_URL=void 0,n.BASE_URL="https://client-config.api.cx.metamask.io/v1"}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/constants.cjs"}],[1951,{"./client-config-api-service/client-config-api-service.cjs":1949,"./remote-feature-flag-controller-types.cjs":1952,"./remote-feature-flag-controller.cjs":1953,"./utils/user-segmentation-utils.cjs":1954},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.generateDeterministicRandomNumber=n.ClientConfigApiService=n.EnvironmentType=n.DistributionType=n.ClientType=n.RemoteFeatureFlagController=void 0;var s=e("./remote-feature-flag-controller.cjs");Object.defineProperty(n,"RemoteFeatureFlagController",{enumerable:!0,get:function(){return s.RemoteFeatureFlagController}});var i=e("./remote-feature-flag-controller-types.cjs");Object.defineProperty(n,"ClientType",{enumerable:!0,get:function(){return i.ClientType}}),Object.defineProperty(n,"DistributionType",{enumerable:!0,get:function(){return i.DistributionType}}),Object.defineProperty(n,"EnvironmentType",{enumerable:!0,get:function(){return i.EnvironmentType}});var a=e("./client-config-api-service/client-config-api-service.cjs");Object.defineProperty(n,"ClientConfigApiService",{enumerable:!0,get:function(){return a.ClientConfigApiService}});var r=e("./utils/user-segmentation-utils.cjs");Object.defineProperty(n,"generateDeterministicRandomNumber",{enumerable:!0,get:function(){return r.generateDeterministicRandomNumber}})}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/index.cjs"}],[1952,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,i,a;Object.defineProperty(n,"__esModule",{value:!0}),n.EnvironmentType=n.DistributionType=n.ClientType=void 0,function(e){e.Extension="extension",e.Mobile="mobile"}(s||(n.ClientType=s={})),function(e){e.Main="main",e.Flask="flask",e.Beta="beta"}(i||(n.DistributionType=i={})),function(e){e.Production="prod",e.ReleaseCandidate="rc",e.Development="dev"}(a||(n.EnvironmentType=a={}))}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/remote-feature-flag-controller-types.cjs"}],[1953,{"./utils/user-segmentation-utils.cjs":1954,"@metamask/base-controller":1238},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,i,a,r,o,c,l,u,d,h=this&&this.__classPrivateFieldSet||function(e,t,n,s,i){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?i.call(e,n):i?i.value=n:t.set(e,n),n},p=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.RemoteFeatureFlagController=n.getDefaultRemoteFeatureFlagControllerState=n.DEFAULT_CACHE_DURATION=n.controllerName=void 0;const m=e("@metamask/base-controller"),f=e("./utils/user-segmentation-utils.cjs");n.controllerName="RemoteFeatureFlagController",n.DEFAULT_CACHE_DURATION=864e5;const g={remoteFeatureFlags:{persist:!0,anonymous:!0},cacheTimestamp:{persist:!0,anonymous:!0}};function y(){return{remoteFeatureFlags:{},cacheTimestamp:0}}n.getDefaultRemoteFeatureFlagControllerState=y;class w extends m.BaseController{constructor({messenger:e,state:t,clientConfigApiService:l,fetchInterval:u=n.DEFAULT_CACHE_DURATION,disabled:d=!1,getMetaMetricsId:p}){super({name:n.controllerName,metadata:g,messenger:e,state:{remoteFeatureFlags:{},cacheTimestamp:0,...t}}),s.add(this),i.set(this,void 0),a.set(this,void 0),r.set(this,void 0),o.set(this,void 0),c.set(this,void 0),h(this,i,u,"f"),h(this,a,d,"f"),h(this,r,l,"f"),h(this,c,p,"f")}async updateRemoteFeatureFlags(){if(p(this,a,"f")||!p(this,s,"m",l).call(this))return;let e;if(p(this,o,"f"))await p(this,o,"f");else{try{h(this,o,p(this,r,"f").fetchRemoteFeatureFlags(),"f"),e=await p(this,o,"f")}finally{h(this,o,undefined,"f")}await p(this,s,"m",u).call(this,e.remoteFeatureFlags)}}enable(){h(this,a,!1,"f")}disable(){h(this,a,!0,"f")}}n.RemoteFeatureFlagController=w,i=new WeakMap,a=new WeakMap,r=new WeakMap,o=new WeakMap,c=new WeakMap,s=new WeakSet,l=function(){return Date.now()-this.state.cacheTimestamp>p(this,i,"f")},u=async function(e){const t=await p(this,s,"m",d).call(this,e);this.update(()=>({remoteFeatureFlags:t,cacheTimestamp:Date.now()}))},d=async function(e){const t={},n=p(this,c,"f").call(this),s=(0,f.generateDeterministicRandomNumber)(n);for(const[n,i]of Object.entries(e)){let e=i;if(Array.isArray(i)&&s){const t=i.find(e=>!!(0,f.isFeatureFlagWithScopeValue)(e)&&s<=e.scope.value);t&&(e={name:t.name,value:t.value})}t[n]=e}return t}}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/remote-feature-flag-controller.cjs"}],[1954,{uuid:4918},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isFeatureFlagWithScopeValue=n.generateDeterministicRandomNumber=void 0;const s=e("uuid");function i(e){return BigInt(`0x${e.replace(/-/gu,"")}`)}const a=i("00000000-0000-4000-8000-000000000000"),r=i("ffffffff-ffff-4fff-bfff-ffffffffffff")-a;n.generateDeterministicRandomNumber=function(e){if(!e)throw new Error("MetaMetrics ID cannot be empty");let t,n;if((0,s.validate)(e)){if(4!==(0,s.version)(e))throw new Error(`Invalid UUID version. Expected v4, got v${(0,s.version)(e)}`);t=i(e)-a,n=r}else{if(!e.startsWith("0x"))throw new Error("Hex ID must start with 0x prefix");const s=e.slice(2),i=64;if(s.length!==i)throw new Error(`Invalid hex ID length. Expected ${i} characters, got ${s.length}`);if(!/^[0-9a-f]+$/iu.test(s))throw new Error("Hex ID contains invalid characters");t=BigInt(`0x${s}`),n=BigInt(`0x${"f".repeat(s.length)}`)}return Number(t*BigInt(1e6)/n)/1e6};n.isFeatureFlagWithScopeValue=e=>"object"==typeof e&&null!==e&&"scope"in e}}},{package:"@metamask/remote-feature-flag-controller",file:"node_modules/@metamask/remote-feature-flag-controller/dist/utils/user-segmentation-utils.cjs"}],[1981,{"@metamask/base-controller":1238,"@metamask/swappable-obj-proxy":2276},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,i,a,r,o,c,l,u,d=this&&this.__classPrivateFieldSet||function(e,t,n,s,i){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?i.call(e,n):i?i.value=n:t.set(e,n),n},h=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.SelectedNetworkController=n.SelectedNetworkControllerEventTypes=n.SelectedNetworkControllerActionTypes=n.METAMASK_DOMAIN=n.controllerName=void 0;const p=e("@metamask/base-controller"),m=e("@metamask/swappable-obj-proxy");n.controllerName="SelectedNetworkController";const f={domains:{persist:!0,anonymous:!1}};n.METAMASK_DOMAIN="metamask",n.SelectedNetworkControllerActionTypes={getState:`${n.controllerName}:getState`,getNetworkClientIdForDomain:`${n.controllerName}:getNetworkClientIdForDomain`,setNetworkClientIdForDomain:`${n.controllerName}:setNetworkClientIdForDomain`},n.SelectedNetworkControllerEventTypes={stateChange:`${n.controllerName}:stateChange`};class g extends p.BaseController{constructor({messenger:e,state:t={domains:{}},useRequestQueuePreference:o,onPreferencesStateChange:l,domainProxyMap:p}){super({name:n.controllerName,metadata:f,messenger:e,state:t}),s.add(this),i.set(this,void 0),a.set(this,void 0),d(this,a,o,"f"),d(this,i,p,"f"),h(this,s,"m",r).call(this),this.messagingSystem.call("PermissionController:getSubjectNames").filter(e=>this.state.domains[e]===undefined).forEach(e=>this.setNetworkClientIdForDomain(e,this.messagingSystem.call("NetworkController:getState").selectedNetworkClientId)),this.messagingSystem.subscribe("PermissionController:stateChange",(e,t)=>{t.forEach(({op:e,path:t})=>{if("subjects"===t[0]&&t[1]!==undefined&&"string"==typeof t[1]){const n=t[1];"add"===e&&this.state.domains[n]===undefined?this.setNetworkClientIdForDomain(n,this.messagingSystem.call("NetworkController:getState").selectedNetworkClientId):"remove"===e&&this.state.domains[n]!==undefined&&h(this,s,"m",c).call(this,n)}})}),this.messagingSystem.subscribe("NetworkController:stateChange",({selectedNetworkClientId:e,networkConfigurationsByChainId:t},n)=>{const s=n.find(({op:e,path:t})=>("replace"===e||"remove"===e)&&"networkConfigurationsByChainId"===t[0]);if(s){const n=Object.values(t).reduce((e,t)=>(t.rpcEndpoints.forEach(({networkClientId:n})=>e[n]=t.chainId),e),{});Object.entries(this.state.domains).forEach(([i,a])=>{const r=n[a];if("remove"!==s.op||r){if("replace"===s.op){const e=s.path[1];if(!r||r===e){const n=t[e],{networkClientId:s}=n.rpcEndpoints[n.defaultRpcEndpointIndex];a!==s&&this.setNetworkClientIdForDomain(i,s)}}}else this.setNetworkClientIdForDomain(i,e)})}}),l(({useRequestQueue:e})=>{h(this,a,"f")!==e&&(e?h(this,s,"m",u).call(this):Object.keys(this.state.domains).forEach(e=>{h(this,s,"m",c).call(this,e)}),d(this,a,e,"f"))})}setNetworkClientIdForDomain(e,t){if(h(this,a,"f")){if(e===n.METAMASK_DOMAIN)throw new Error(`NetworkClientId for domain "${n.METAMASK_DOMAIN}" cannot be set on the SelectedNetworkController`);if(!h(this,s,"m",l).call(this,e))throw new Error("NetworkClientId for domain cannot be called with a domain that has not yet been granted permissions");h(this,s,"m",o).call(this,e,t)}}getNetworkClientIdForDomain(e){const{selectedNetworkClientId:t}=this.messagingSystem.call("NetworkController:getState");return h(this,a,"f")?this.state.domains[e]??t:t}getProviderAndBlockTracker(e){if(e===n.METAMASK_DOMAIN){const e=this.messagingSystem.call("NetworkController:getSelectedNetworkClient");if(e===undefined)throw new Error("Selected network not initialized");return e}let t=h(this,i,"f").get(e);if(t===undefined){let n;if(h(this,a,"f")&&h(this,s,"m",l).call(this,e)){const t=this.getNetworkClientIdForDomain(e);n=this.messagingSystem.call("NetworkController:getNetworkClientById",t)}else if(n=this.messagingSystem.call("NetworkController:getSelectedNetworkClient"),n===undefined)throw new Error("Selected network not initialized");t={provider:(0,m.createEventEmitterProxy)(n.provider),blockTracker:(0,m.createEventEmitterProxy)(n.blockTracker,{eventFilter:"skipInternal"})},h(this,i,"f").set(e,t)}return t}}n.SelectedNetworkController=g,i=new WeakMap,a=new WeakMap,s=new WeakSet,r=function(){this.messagingSystem.registerActionHandler(n.SelectedNetworkControllerActionTypes.getNetworkClientIdForDomain,this.getNetworkClientIdForDomain.bind(this)),this.messagingSystem.registerActionHandler(n.SelectedNetworkControllerActionTypes.setNetworkClientIdForDomain,this.setNetworkClientIdForDomain.bind(this))},o=function(e,t){const n=this.messagingSystem.call("NetworkController:getNetworkClientById",t);this.update(n=>{n.domains[e]=t});const s=this.getProviderAndBlockTracker(e);s.provider.setTarget(n.provider),s.blockTracker.setTarget(n.blockTracker)},c=function(e){const t=this.messagingSystem.call("NetworkController:getSelectedNetworkClient"),n=h(this,i,"f").get(e);n&&t?(n.provider.setTarget(t.provider),n.blockTracker.setTarget(t.blockTracker)):n&&h(this,i,"f").delete(e),this.update(t=>{delete t.domains[e]})},l=function(e){return this.messagingSystem.call("PermissionController:hasPermissions",e)},u=function(){h(this,i,"f").forEach((e,t)=>{const{selectedNetworkClientId:n}=this.messagingSystem.call("NetworkController:getState");h(this,s,"m",l).call(this,t)&&h(this,s,"m",o).call(this,t,n)})}}}},{package:"@metamask/selected-network-controller",file:"node_modules/@metamask/selected-network-controller/dist/SelectedNetworkController.cjs"}],[1982,{"./SelectedNetworkController.cjs":1981},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createSelectedNetworkMiddleware=void 0;const s=e("./SelectedNetworkController.cjs");n.createSelectedNetworkMiddleware=e=>(t,n,i)=>{if(!t.origin)throw new Error("Request object is lacking an 'origin'");return t.networkClientId=(t=>e.call(s.SelectedNetworkControllerActionTypes.getNetworkClientIdForDomain,t))(t.origin),i()}}}},{package:"@metamask/selected-network-controller",file:"node_modules/@metamask/selected-network-controller/dist/SelectedNetworkMiddleware.cjs"}],[1983,{"./SelectedNetworkController.cjs":1981,"./SelectedNetworkMiddleware.cjs":1982},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.createSelectedNetworkMiddleware=n.METAMASK_DOMAIN=n.SelectedNetworkController=n.SelectedNetworkControllerEventTypes=n.SelectedNetworkControllerActionTypes=void 0;var s=e("./SelectedNetworkController.cjs");Object.defineProperty(n,"SelectedNetworkControllerActionTypes",{enumerable:!0,get:function(){return s.SelectedNetworkControllerActionTypes}}),Object.defineProperty(n,"SelectedNetworkControllerEventTypes",{enumerable:!0,get:function(){return s.SelectedNetworkControllerEventTypes}}),Object.defineProperty(n,"SelectedNetworkController",{enumerable:!0,get:function(){return s.SelectedNetworkController}}),Object.defineProperty(n,"METAMASK_DOMAIN",{enumerable:!0,get:function(){return s.METAMASK_DOMAIN}});var i=e("./SelectedNetworkMiddleware.cjs");Object.defineProperty(n,"createSelectedNetworkMiddleware",{enumerable:!0,get:function(){return i.createSelectedNetworkMiddleware}})}}},{package:"@metamask/selected-network-controller",file:"node_modules/@metamask/selected-network-controller/dist/index.cjs"}],[199,{"../../../../../shared/lib/delegation":5051,"../../../../../shared/lib/delegation/delegation":5048,"@metamask/transaction-controller":2316,"@metamask/utils":2361,"bignumber.js":3209},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.enforceSimulations=async function({messenger:e,transactionMeta:t,useRealSignature:n=!1}){c("Enforcing simulations",{transactionMeta:t,useRealSignature:n});const{chainId:a,simulationData:d={tokenBalanceChanges:[]},txParams:h}=t,p=h.from,m=(0,i.hexToNumber)(a),f=(0,r.getDeleGatorEnvironment)(m),g=f.DelegationManager,y=function(e,t){const n=e.call("AppStateController:getState"),s=n.enforcedSimulationsSlippage;return n.enforcedSimulationsSlippageForTransactions[t]??s}(e,t.id),w=function({accountAddress:e,environment:t,simulationData:n,slippage:i}){const a=function(e,t,n,i){const a=(0,r.createCaveatBuilder)(t),{nativeBalanceChange:o,tokenBalanceChanges:l=[]}=n;if(o){const{difference:t,isDecrease:n}=o,s=u(t,i,n);c("Caveat - Native Balance Change",{enforceDecrease:n,recipient:e,delta:BigInt(t),slippage:i,deltaWithSlippage:s}),a.addCaveat("nativeBalanceChange",n,e,s)}for(const t of l){const{difference:n,isDecrease:r,address:o,standard:l,id:d}=t,h=BigInt(n),p=u(n,i,r),m=d?BigInt(d):0n;switch(c("Caveat - Token Balance Change",{enforceDecrease:r,token:o,recipient:e,delta:h,slippage:i,deltaWithSlippage:p}),l){case s.SimulationTokenStandard.erc20:a.addCaveat("erc20BalanceChange",r,o,e,p);break;case s.SimulationTokenStandard.erc721:a.addCaveat("erc721BalanceChange",r,o,e,h);break;case s.SimulationTokenStandard.erc1155:a.addCaveat("erc1155BalanceChange",r,o,e,m,h);break;default:c("Unsupported token standard",l)}}return a.build()}(e,t,n,i);c("Caveats",a);const o=(0,r.createDelegation)({from:e,to:e,caveats:a});return o}({accountAddress:p,environment:f,simulationData:d,slippage:y});c("Delegation",w);let S=l;n&&(c("Signing delegation"),S=await e.call("DelegationController:signDelegation",{chainId:a,delegation:w}));c("Delegation signature",S);const b=function({transaction:e,delegation:t}){const n=[[t]],s=[r.SINGLE_DEFAULT_MODE],i=[[{target:e.to,callData:e.data??"0x",value:e.value?BigInt(e.value):0n}]];return(0,o.encodeRedeemDelegations)({delegations:n,modes:s,executions:i})}({transaction:h,delegation:{...w,signature:S}});return c("Data",b),{updateTransaction:e=>{e.txParams.data=b,e.txParams.to=g,e.txParams.value="0x0"}}};var s=e("@metamask/transaction-controller"),i=e("@metamask/utils"),a=e("bignumber.js"),r=e("../../../../../shared/lib/delegation"),o=e("../../../../../shared/lib/delegation/delegation");const c=(0,i.createProjectLogger)("enforced-simulations"),l="0x2261a7810ed3e9cde160895909e138e2f68adb2da86fcf98ea0840701df107721fb369ab9b52550ea98832c09f8185284aca4c94bd345e867a4f4461868dd7751b";function u(e,t,n){const s=new a.BigNumber(e),i=(100+(n?t:-t))/100;return BigInt(s.mul(i).toFixed(0))}}}},{package:"$root$",file:"app/scripts/lib/transaction/containers/enforced-simulations.ts"}],[1992,{"./constants":1993,"./types":1995,"./utils":1996,"@ethersproject/bytes":568,"@metamask/controller-utils":1315,"@metamask/eth-query":1404,"@metamask/polling-controller":2e3,"@metamask/transaction-controller":2316,"bignumber.js":2005,"lodash/cloneDeep":4064},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,i,a,r,o,c,l,u,d,h,p,m,f,g,y,w,S,b,v,T,k,_,E,C,P,A,I,O=this&&this.__classPrivateFieldSet||function(e,t,n,s,i){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?i.call(e,n):i?i.value=n:t.set(e,n),n},M=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)},j=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getDefaultSmartTransactionsControllerState=n.DEFAULT_INTERVAL=void 0;const N=e("@ethersproject/bytes"),R=e("@metamask/controller-utils"),x=j(e("@metamask/eth-query")),D=e("@metamask/polling-controller"),L=e("@metamask/transaction-controller"),F=e("bignumber.js"),H=j(e("lodash/cloneDeep")),B=e("./constants"),U=e("./types"),$=e("./utils");n.DEFAULT_INTERVAL=5e3;const W="`ethQuery` is not defined on SmartTransactionsController",q="SmartTransactionsController",K={smartTransactionsState:{persist:!1,anonymous:!0}};function G(){return{smartTransactionsState:{smartTransactions:{},userOptIn:null,userOptInV2:null,fees:{approvalTxFees:null,tradeTxFees:null},liveness:!0,livenessByChainId:{[R.ChainId.mainnet]:!0,[R.ChainId.sepolia]:!0},feesByChainId:{[R.ChainId.mainnet]:{approvalTxFees:null,tradeTxFees:null},[R.ChainId.sepolia]:{approvalTxFees:null,tradeTxFees:null}}}}}n.getDefaultSmartTransactionsControllerState=G;class V extends((0,D.StaticIntervalPollingController)()){constructor({interval:e=n.DEFAULT_INTERVAL,clientId:t,chainId:y=R.ChainId.mainnet,supportedChainIds:w=[R.ChainId.mainnet,R.ChainId.sepolia],getNonceLock:S,confirmExternalTransaction:b,trackMetaMetricsEvent:v,state:T={},messenger:k,getTransactions:_,getMetaMetricsProps:E,getFeatureFlags:C,updateTransaction:P,trace:A}){super({name:q,metadata:K,messenger:k,state:Object.assign(Object.assign({},G()),T)}),s.add(this),i.set(this,void 0),a.set(this,void 0),r.set(this,void 0),o.set(this,void 0),c.set(this,void 0),l.set(this,void 0),u.set(this,void 0),d.set(this,void 0),h.set(this,void 0),p.set(this,void 0),m.set(this,void 0),f.set(this,void 0),g.set(this,void 0),O(this,i,e,"f"),O(this,a,t,"f"),O(this,r,y,"f"),O(this,o,w,"f"),this.setIntervalLength(e),O(this,c,S,"f"),O(this,l,undefined,"f"),O(this,u,b,"f"),O(this,d,_,"f"),O(this,h,v,"f"),O(this,p,E,"f"),O(this,m,C,"f"),O(this,f,P,"f"),O(this,g,null!=A?A:(e,t)=>null==t?void 0:t(),"f"),this.initializeSmartTransactionsForChainId(),this.messagingSystem.subscribe("NetworkController:stateChange",({selectedNetworkClientId:e})=>{const{configuration:{chainId:t},provider:n}=this.messagingSystem.call("NetworkController:getNetworkClientById",e);O(this,r,t,"f"),O(this,l,new x.default(n),"f"),this.initializeSmartTransactionsForChainId(),this.checkPoll(this.state)}),this.messagingSystem.subscribe(`${q}:stateChange`,e=>this.checkPoll(e))}async _executePoll({chainIds:e}){const t=(null!=e?e:[]).filter(e=>M(this,o,"f").includes(e));return 0===t.length?Promise.resolve():this.updateSmartTransactions({chainIds:t})}checkPoll({smartTransactionsState:{smartTransactions:e}}){const t=Object.values(e).flat(),n=null==t?void 0:t.filter($.isSmartTransactionPending);!this.timeoutHandle&&(null==n?void 0:n.length)>0?this.poll():this.timeoutHandle&&0===(null==n?void 0:n.length)&&this.stop()}initializeSmartTransactionsForChainId(){M(this,o,"f").includes(M(this,r,"f"))&&this.update(e=>{var t;e.smartTransactionsState.smartTransactions[M(this,r,"f")]=null!==(t=e.smartTransactionsState.smartTransactions[M(this,r,"f")])&&void 0!==t?t:[]})}async poll(e){e&&O(this,i,e,"f"),this.timeoutHandle&&clearInterval(this.timeoutHandle),M(this,o,"f").includes(M(this,r,"f"))&&(this.timeoutHandle=setInterval(()=>{(0,R.safelyExecute)(async()=>this.updateSmartTransactions())},M(this,i,"f")),await(0,R.safelyExecute)(async()=>this.updateSmartTransactions()))}async stop(){this.timeoutHandle&&clearInterval(this.timeoutHandle),this.timeoutHandle=undefined}setOptInState(e){this.update(t=>{t.smartTransactionsState.userOptInV2=e})}trackStxStatusChange(e,t){let n=(0,H.default)(e);n=Object.assign(Object.assign({},(0,H.default)(t)),n),n.status!==(null==t?void 0:t.status)&&M(this,h,"f").call(this,{event:B.MetaMetricsEventName.StxStatusUpdated,category:B.MetaMetricsEventCategory.Transactions,properties:(0,$.getSmartTransactionMetricsProperties)(n),sensitiveProperties:(0,$.getSmartTransactionMetricsSensitiveProperties)(n)})}isNewSmartTransaction(e,t){const{smartTransactionsState:{smartTransactions:n}}=this.state,s=n[null!=t?t:M(this,r,"f")],i=null==s?void 0:s.findIndex(t=>t.uuid===e);return-1===i||i===undefined}updateSmartTransaction(e,{networkClientId:t}={}){let n=M(this,l,"f"),i=M(this,r,"f");if(t){const{configuration:e,provider:s}=this.messagingSystem.call("NetworkController:getNetworkClientById",t);i=e.chainId,n=new x.default(s)}M(this,s,"m",b).call(this,e,{chainId:i,ethQuery:n})}async updateSmartTransactions({chainIds:e}={chainIds:M(this,s,"m",E).call(this)}){const{smartTransactionsState:{smartTransactions:t}}=this.state;for(const[n,i]of Object.entries(t)){if(e&&!e.includes(n))continue;const t=i.filter($.isSmartTransactionPending).map(e=>{const t=M(this,s,"m",C).call(this,{chainId:n});return{uuid:e.uuid,networkClientId:t,chainId:e.chainId}});t.length>0&&await this.fetchSmartTransactionsStatus(t)}}async fetchSmartTransactionsStatus(e){const{chainId:t}=e[0],n=e.map(e=>e.uuid),i=new URLSearchParams({uuids:n.join(",")}),a=M(this,s,"m",P).call(this,{networkClientId:e[0].networkClientId}),r=`${(0,$.getAPIRequestURL)(U.APIType.BATCH_STATUS,t)}?${i.toString()}`,o=await M(this,s,"m",y).call(this,r);for(const[n,i]of Object.entries(o)){const r=e.find(e=>e.uuid===n);if(!r){console.error(`No matching transaction found for uuid: ${n}`);continue}const o={statusMetadata:i,status:(0,$.calculateStatus)(i),cancellable:(0,$.isSmartTransactionCancellable)(i),uuid:n,networkClientId:r.networkClientId};await M(this,s,"m",b).call(this,o,{chainId:t,ethQuery:a})}return o}clearFees(){const e={approvalTxFees:null,tradeTxFees:null};return this.update(t=>{t.smartTransactionsState.fees=e}),e}async getFees(e,t,{networkClientId:n}={}){const i=null!=n?n:this.messagingSystem.call("NetworkController:getState").selectedNetworkClientId,a=M(this,s,"m",_).call(this,{networkClientId:i}),o=[];let c;if(t){const n=await M(this,s,"m",k).call(this,t,i);o.push(n),c=Object.assign(Object.assign({},e),{nonce:(0,$.incrementNonceInHex)(n.nonce)})}else c=e.nonce?e:await M(this,s,"m",k).call(this,e,i);o.push(c);const l=await M(this,g,"f").call(this,{name:B.SmartTransactionsTraceName.GetFees},async()=>await M(this,s,"m",y).call(this,(0,$.getAPIRequestURL)(U.APIType.GET_FEES,a),{method:"POST",body:JSON.stringify({txs:o})}));let u,d;return t?(u=null==l?void 0:l.txs[0],d=null==l?void 0:l.txs[1]):(u=null,d=null==l?void 0:l.txs[0]),this.update(e=>{a===M(this,r,"f")&&(e.smartTransactionsState.fees={approvalTxFees:u,tradeTxFees:d}),e.smartTransactionsState.feesByChainId[a]={approvalTxFees:u,tradeTxFees:d}}),{approvalTxFees:u,tradeTxFees:d}}async submitSignedTransactions({transactionMeta:e,txParams:t,signedTransactions:n,signedCanceledTransactions:i=[],networkClientId:a}){var r,o;const l=null!=a?a:this.messagingSystem.call("NetworkController:getState").selectedNetworkClientId,u=M(this,s,"m",_).call(this,{networkClientId:l}),d=M(this,s,"m",P).call(this,{networkClientId:l}),h=await M(this,g,"f").call(this,{name:B.SmartTransactionsTraceName.SubmitTransactions},async()=>await M(this,s,"m",y).call(this,(0,$.getAPIRequestURL)(U.APIType.SUBMIT_TRANSACTIONS,u),{method:"POST",body:JSON.stringify({rawTxs:n,rawCancelTxs:i})})),p=Date.now();let m;try{if(null==t?void 0:t.from){const e=await(0,R.query)(d,"getBalance",[t.from]);m=new F.BigNumber(e).toString(16)}}catch(e){console.error("ethQuery.getBalance error:",e)}let f,w,S={};if(t&&!t.nonce)try{w=await M(this,c,"f").call(this,t.from,l),f=(0,N.hexlify)(w.nextNonce),S=w.nonceDetails,null!==(r=t.nonce)&&void 0!==r||(t.nonce=f)}catch(e){throw console.error("Failed to acquire nonce lock:",e),e}const v=n.map(e=>(0,$.getTxHash)(e)),T=Object.assign(Object.assign({},h),{txHash:v[v.length-1],txHashes:v});try{await M(this,s,"m",b).call(this,{chainId:u,nonceDetails:S,preTxBalance:m,status:U.SmartTransactionStatuses.PENDING,time:p,txParams:t,uuid:T.uuid,txHash:T.txHash,cancellable:!0,type:null!==(o=null==e?void 0:e.type)&&void 0!==o?o:"swap",transactionId:null==e?void 0:e.id,networkClientId:l,txHashes:v},{chainId:u,ethQuery:d})}catch(e){throw console.error("Failed to create a smart transaction:",e),e}finally{w&&w.releaseLock()}return T}async cancelSmartTransaction(e,{networkClientId:t}={}){const n=M(this,s,"m",_).call(this,{networkClientId:t});await M(this,g,"f").call(this,{name:B.SmartTransactionsTraceName.CancelTransaction},async()=>await M(this,s,"m",y).call(this,(0,$.getAPIRequestURL)(U.APIType.CANCEL,n),{method:"POST",body:JSON.stringify({uuid:e})}))}async fetchLiveness({networkClientId:e}={}){const t=M(this,s,"m",_).call(this,{networkClientId:e});let n=!1;try{const e=await M(this,g,"f").call(this,{name:B.SmartTransactionsTraceName.FetchLiveness},async()=>await M(this,s,"m",y).call(this,(0,$.getAPIRequestURL)(U.APIType.LIVENESS,t)));n=Boolean(e.smartTransactions)}catch(e){console.log('"fetchLiveness" API call failed')}return this.update(e=>{t===M(this,r,"f")&&(e.smartTransactionsState.liveness=n),e.smartTransactionsState.livenessByChainId[t]=n}),n}async setStatusRefreshInterval(e){e!==M(this,i,"f")&&O(this,i,e,"f")}getTransactions({addressFrom:e,status:t}){return M(this,s,"m",A).call(this).filter(n=>{var s;return n.status===t&&(null===(s=n.txParams)||void 0===s?void 0:s.from)===e})}getSmartTransactionByMinedTxHash(e){if(!e)return undefined;return M(this,s,"m",A).call(this).find(t=>{var n,s;return(null===(s=null===(n=t.statusMetadata)||void 0===n?void 0:n.minedHash)||void 0===s?void 0:s.toLowerCase())===e.toLowerCase()})}wipeSmartTransactions({address:e,ignoreNetwork:t}){if(!e)return;const n=e.toLowerCase();if(t){const{smartTransactionsState:{smartTransactions:e}}=this.state;Object.keys(e).forEach(e=>{M(this,s,"m",I).call(this,{chainId:e,addressLowerCase:n})})}else M(this,s,"m",I).call(this,{chainId:M(this,r,"f"),addressLowerCase:n})}}n.default=V,i=new WeakMap,a=new WeakMap,r=new WeakMap,o=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,p=new WeakMap,m=new WeakMap,f=new WeakMap,g=new WeakMap,s=new WeakSet,y=async function(e,t){const n=Object.assign(Object.assign({},t),{headers:Object.assign({"Content-Type":"application/json"},M(this,a,"f")&&{"X-Client-Id":M(this,a,"f")})});return(0,$.handleFetch)(e,n)},w=function(e,{chainId:t=M(this,r,"f")}){var n;const{smartTransactionsState:{smartTransactions:s}}=this.state,i=null!==(n=s[t])&&void 0!==n?n:[],a=null==i?void 0:i.findIndex(t=>t.uuid===e.uuid);-1!==a&&(0,R.isSafeDynamicKey)(t)&&this.update(n=>{n.smartTransactionsState.smartTransactions[t][a]=Object.assign(Object.assign({},n.smartTransactionsState.smartTransactions[t][a]),e)})},S=async function(e){const t=await M(this,p,"f").call(this);e.accountHardwareType=null==t?void 0:t.accountHardwareType,e.accountType=null==t?void 0:t.accountType,e.deviceModel=null==t?void 0:t.deviceModel},b=async function(e,{chainId:t=M(this,r,"f"),ethQuery:n=M(this,l,"f")}){var i;const{smartTransactionsState:{smartTransactions:o}}=this.state,c=null!==(i=o[t])&&void 0!==i?i:[],u=null==c?void 0:c.findIndex(t=>t.uuid===e.uuid),h=this.isNewSmartTransaction(e.uuid,t);if(n===undefined)throw new Error(W);if(h)try{await M(this,s,"m",S).call(this,e)}catch(e){console.error("Failed to add metrics props to smart transaction:",e)}if(this.trackStxStatusChange(e,h?undefined:c[u]),h){const n=null==c?void 0:c.findIndex(t=>{var n,s,i;return(null===(n=t.txParams)||void 0===n?void 0:n.nonce)===(null===(s=e.txParams)||void 0===s?void 0:s.nonce)&&(null===(i=t.status)||void 0===i?void 0:i.startsWith("cancelled"))}),s=[(0,H.default)(e)],i=Object.assign(Object.assign({},e),{history:s}),a=n>-1?c.slice(0,n).concat(c.slice(n+1)).concat(i):c.concat(i);return void this.update(e=>{e.smartTransactionsState.smartTransactions[t]=a})}const p=c[u],g=Object.assign(Object.assign({},p),e);this.messagingSystem.publish("SmartTransactionsController:smartTransaction",g),(0,$.shouldMarkRegularTransactionAsFailed)({smartTransaction:g,clientId:M(this,a,"f"),getFeatureFlags:M(this,m,"f")})&&(0,$.markRegularTransactionAsFailed)({smartTransaction:g,getRegularTransactions:M(this,d,"f"),updateTransaction:M(this,f,"f")}),e.status!==U.SmartTransactionStatuses.SUCCESS&&e.status!==U.SmartTransactionStatuses.REVERTED||e.confirmed?M(this,s,"m",w).call(this,e,{chainId:t}):await M(this,s,"m",T).call(this,g,{chainId:t,ethQuery:n})},v=function(e){if(!e)return!0;const t=M(this,d,"f").call(this),n=null==t?void 0:t.find(t=>{var n;return(null===(n=t.hash)||void 0===n?void 0:n.toLowerCase())===e.toLowerCase()});return!n||![L.TransactionStatus.confirmed,L.TransactionStatus.submitted].includes(n.status)},T=async function(e,{chainId:t=M(this,r,"f"),ethQuery:n=M(this,l,"f")}){var i;if(n===undefined)throw new Error(W);const a=null===(i=e.statusMetadata)||void 0===i?void 0:i.minedHash;try{const i=await(0,R.query)(n,"getTransactionReceipt",[a]),r=await(0,R.query)(n,"getTransactionByHash",[a]),o=null==r?void 0:r.maxFeePerGas,c=null==r?void 0:r.maxPriorityFeePerGas;if(null==i?void 0:i.blockNumber){const r=await(0,R.query)(n,"getBlockByNumber",[null==i?void 0:i.blockNumber,!1]),l=null==r?void 0:r.baseFeePerGas,d=Object.assign(Object.assign({},e.txParams),{maxFeePerGas:o,maxPriorityFeePerGas:c}),p=Object.assign(Object.assign({},e),{id:e.uuid,status:L.TransactionStatus.confirmed,hash:a,txParams:d}),m=(0,$.snapshotFromTxMeta)(p),f=(0,$.replayHistory)(p.history),g=(0,$.generateHistoryEntry)(f,m,"txStateManager: setting status to confirmed"),y=g.length>0?Object.assign(Object.assign({},p),{history:p.history.concat(g)}):p;M(this,s,"m",v).call(this,a)&&M(this,u,"f").call(this,y,i,l),M(this,h,"f").call(this,{event:B.MetaMetricsEventName.StxConfirmed,category:B.MetaMetricsEventCategory.Transactions,properties:(0,$.getSmartTransactionMetricsProperties)(e),sensitiveProperties:(0,$.getSmartTransactionMetricsSensitiveProperties)(e)}),M(this,s,"m",w).call(this,Object.assign(Object.assign({},e),{confirmed:!0}),{chainId:t})}}catch(e){M(this,h,"f").call(this,{event:B.MetaMetricsEventName.StxConfirmationFailed,category:B.MetaMetricsEventCategory.Transactions}),console.error("confirm error",e)}finally{this.messagingSystem.publish("SmartTransactionsController:smartTransactionConfirmationDone",e)}},k=async function(e,t){const n=await M(this,c,"f").call(this,e.from,t),s=n.nextNonce;return n.releaseLock(),Object.assign(Object.assign({},e),{nonce:`0x${s.toString(16)}`})},_=function({networkClientId:e}={}){return e?this.messagingSystem.call("NetworkController:getNetworkClientById",e).configuration.chainId:M(this,r,"f")},E=function(){const{networkConfigurationsByChainId:e}=this.messagingSystem.call("NetworkController:getState");return Object.keys(e).filter(e=>M(this,o,"f").includes(e))},C=function({chainId:e}){const{networkConfigurationsByChainId:t}=this.messagingSystem.call("NetworkController:getState");return t[e].rpcEndpoints[t[e].defaultRpcEndpointIndex].networkClientId},P=function({networkClientId:e}={}){if(e){const{provider:t}=this.messagingSystem.call("NetworkController:getNetworkClientById",e);return new x.default(t)}if(M(this,l,"f")===undefined)throw new Error(W);return M(this,l,"f")},A=function(){const{smartTransactionsState:{smartTransactions:e}}=this.state,t=Object.values(e).flat();return t&&0!==t.length?t:[]},I=function({chainId:e,addressLowerCase:t}){const{smartTransactionsState:{smartTransactions:n}}=this.state,s=null==n?void 0:n[e];if(!s||0===s.length)return;const i=s.filter(e=>{var n;return(null===(n=e.txParams)||void 0===n?void 0:n.from)!==t});this.update(t=>{t.smartTransactionsState.smartTransactions[e]=i})}}}},{package:"@metamask/smart-transactions-controller",file:"node_modules/@metamask/smart-transactions-controller/dist/SmartTransactionsController.js"}],[1993,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SmartTransactionsTraceName=n.MetaMetricsEventCategory=n.MetaMetricsEventName=n.SENTINEL_API_BASE_URL_MAP=n.API_BASE_URL=void 0,n.API_BASE_URL="https://transaction.api.cx.metamask.io",n.SENTINEL_API_BASE_URL_MAP={1:"https://tx-sentinel-ethereum-mainnet.api.cx.metamask.io",56:"https://tx-sentinel-bsc-mainnet.api.cx.metamask.io",8453:"https://tx-sentinel-base-mainnet.api.cx.metamask.io",42161:"https://tx-sentinel-arbitrum-mainnet.api.cx.metamask.io",59144:"https://tx-sentinel-linea-mainnet.api.cx.metamask.io",11155111:"https://tx-sentinel-ethereum-sepolia.api.cx.metamask.io"},function(e){e.StxStatusUpdated="STX Status Updated",e.StxConfirmed="STX Confirmed",e.StxConfirmationFailed="STX Confirmation Failed",e.ReceiveRequest="Receive Request"}(n.MetaMetricsEventName||(n.MetaMetricsEventName={})),function(e){e.Transactions="Transactions",e.Navigation="Navigation"}(n.MetaMetricsEventCategory||(n.MetaMetricsEventCategory={})),function(e){e.GetFees="Smart Transactions: Get Fees",e.SubmitTransactions="Smart Transactions: Submit Transactions",e.CancelTransaction="Smart Transactions: Cancel Transaction",e.FetchLiveness="Smart Transactions: Fetch Liveness"}(n.SmartTransactionsTraceName||(n.SmartTransactionsTraceName={}))}}},{package:"@metamask/smart-transactions-controller",file:"node_modules/@metamask/smart-transactions-controller/dist/constants.js"}],[1994,{"./SmartTransactionsController":1992},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=e("./SmartTransactionsController");Object.defineProperty(n,"default",{enumerable:!0,get:function(){return s(i).default}})}}},{package:"@metamask/smart-transactions-controller",file:"node_modules/@metamask/smart-transactions-controller/dist/index.js"}],[1996,{"../package.json":2006,"./constants":1993,"./types":1995,"@ethersproject/bytes":568,"@ethersproject/keccak256":594,"@ethersproject/transactions":644,"@metamask/transaction-controller":2316,"bignumber.js":2005,"fast-json-patch":3665,lodash:4088},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.markRegularTransactionAsFailed=n.shouldMarkRegularTransactionAsFailed=n.getReturnTxHashAsap=n.getSmartTransactionMetricsSensitiveProperties=n.getSmartTransactionMetricsProperties=n.getTxHash=n.incrementNonceInHex=n.isSmartTransactionCancellable=n.handleFetch=n.mapKeysToCamel=n.getStxProcessingTime=n.snapshotFromTxMeta=n.replayHistory=n.generateHistoryEntry=n.calculateStatus=n.getAPIRequestURL=n.isSmartTransactionStatusResolved=n.isSmartTransactionPending=void 0;const i=e("@ethersproject/bytes"),a=e("@ethersproject/keccak256"),r=e("@ethersproject/transactions"),o=e("@metamask/transaction-controller"),c=e("bignumber.js"),l=s(e("fast-json-patch")),u=s(e("lodash")),d=s(e("../package.json")),h=e("./constants"),p=e("./types");n.isSmartTransactionPending=function(e){return e.status===p.SmartTransactionStatuses.PENDING};n.isSmartTransactionStatusResolved=e=>"uuid_not_found"===e,n.getAPIRequestURL=function(e,t){const n=parseInt(t,16);switch(e){case p.APIType.GET_FEES:return`${h.API_BASE_URL}/networks/${n}/getFees`;case p.APIType.ESTIMATE_GAS:return`${h.API_BASE_URL}/networks/${n}/estimateGas`;case p.APIType.SUBMIT_TRANSACTIONS:return`${h.API_BASE_URL}/networks/${n}/submitTransactions?stxControllerVersion=${d.default.version}`;case p.APIType.CANCEL:return`${h.API_BASE_URL}/networks/${n}/cancel`;case p.APIType.BATCH_STATUS:return`${h.API_BASE_URL}/networks/${n}/batchStatus`;case p.APIType.LIVENESS:return`${h.SENTINEL_API_BASE_URL_MAP[n]}/network`;default:throw new Error("Invalid APIType")}};n.calculateStatus=e=>{if((0,n.isSmartTransactionStatusResolved)(e))return p.SmartTransactionStatuses.RESOLVED;const t=[p.SmartTransactionCancellationReason.WOULD_REVERT,p.SmartTransactionCancellationReason.TOO_CHEAP,p.SmartTransactionCancellationReason.DEADLINE_MISSED,p.SmartTransactionCancellationReason.INVALID_NONCE,p.SmartTransactionCancellationReason.USER_CANCELLED];if((null==e?void 0:e.minedTx)===p.SmartTransactionMinedTx.NOT_MINED){if(e.cancellationReason===p.SmartTransactionCancellationReason.NOT_CANCELLED)return p.SmartTransactionStatuses.PENDING;const n=t.findIndex(t=>t===e.cancellationReason)>-1;if(e.cancellationReason&&n)return e.isSettled?p.cancellationReasonToStatusMap[e.cancellationReason]:p.SmartTransactionStatuses.PENDING}else{if((null==e?void 0:e.minedTx)===p.SmartTransactionMinedTx.SUCCESS)return p.SmartTransactionStatuses.SUCCESS;if((null==e?void 0:e.minedTx)===p.SmartTransactionMinedTx.CANCELLED)return p.SmartTransactionStatuses.CANCELLED;if((null==e?void 0:e.minedTx)===p.SmartTransactionMinedTx.REVERTED)return p.SmartTransactionStatuses.REVERTED;if((null==e?void 0:e.minedTx)===p.SmartTransactionMinedTx.UNKNOWN)return p.SmartTransactionStatuses.UNKNOWN}return p.SmartTransactionStatuses.UNKNOWN},n.generateHistoryEntry=function(e,t,n){const s=l.default.compare(e,t);return s[0]&&(n&&(s[0].note=n),s[0].timestamp=Date.now()),s},n.replayHistory=function(e){return u.default.cloneDeep(e).reduce((e,t)=>l.default.applyPatch(e,t).newDocument)},n.snapshotFromTxMeta=function(e){const t=Object.assign({},e);return delete t.history,u.default.cloneDeep(t)};n.getStxProcessingTime=e=>e?Math.round((Date.now()-e)/1e3):undefined;n.mapKeysToCamel=e=>{if(!u.default.isObject(e))return e;const t=u.default.mapValues(e,e=>u.default.isArray(e)?e.map(n.mapKeysToCamel):u.default.isObject(e)?(0,n.mapKeysToCamel)(e):e);return u.default.mapKeys(t,(e,t)=>u.default.camelCase(t))},n.handleFetch=async function(e,t){const s=await fetch(e,t),i=await s.json();if(!s.ok)throw console.log("response",s),new Error(`Fetch error:${JSON.stringify(Object.assign({status:s.status},(0,n.mapKeysToCamel)(i)))}`);return i};n.isSmartTransactionCancellable=e=>e.minedTx===p.SmartTransactionMinedTx.NOT_MINED&&(!e.cancellationReason||e.cancellationReason===p.SmartTransactionCancellationReason.NOT_CANCELLED);n.incrementNonceInHex=e=>{const t=new c.BigNumber(e,16).toString(10);return(0,i.hexlify)(Number(t)+1)};n.getTxHash=e=>{var t;if(!e)return"";try{const n=(0,r.parse)(e);return null!==(t=null==n?void 0:n.hash)&&void 0!==t?t:""}catch(t){if((e=>"string"==typeof e&&e.startsWith("0x04"))(e))return(0,i.hexlify)((0,a.keccak256)((0,i.arrayify)(e)));throw t}};n.getSmartTransactionMetricsProperties=e=>{if(!e)return{};const t=e.statusMetadata;return{stx_status:e.status,type:e.type,processing_time:(0,n.getStxProcessingTime)(e.time),is_smart_transaction:!0,stx_enabled:!0,current_stx_enabled:!0,stx_user_opt_in:!0,stx_duplicated:null==t?void 0:t.duplicated,stx_timed_out:null==t?void 0:t.timedOut,stx_proxied:null==t?void 0:t.proxied}};n.getSmartTransactionMetricsSensitiveProperties=e=>e?{token_from_symbol:e.sourceTokenSymbol,token_to_symbol:e.destinationTokenSymbol,account_hardware_type:e.accountHardwareType,account_type:e.accountType,device_model:e.deviceModel}:{};n.getReturnTxHashAsap=(e,t)=>e===p.ClientId.Extension?null==t?void 0:t.extensionReturnTxHashAsap:null==t?void 0:t.mobileReturnTxHashAsap;n.shouldMarkRegularTransactionAsFailed=({smartTransaction:e,clientId:t,getFeatureFlags:s})=>{var i;const{status:a,transactionId:r}=e,o=[p.SmartTransactionStatuses.CANCELLED,p.SmartTransactionStatuses.CANCELLED_USER_CANCELLED,p.SmartTransactionStatuses.UNKNOWN,p.SmartTransactionStatuses.RESOLVED];if(!a||!o.includes(a))return!1;const{smartTransactions:c}=null!==(i=s())&&void 0!==i?i:{},l=(0,n.getReturnTxHashAsap)(t,c);return Boolean(l&&r)};n.markRegularTransactionAsFailed=({smartTransaction:e,getRegularTransactions:t,updateTransaction:n})=>{const{transactionId:s,status:i}=e,a=t().find(e=>e.id===s);if(!a)throw new Error("Cannot find regular transaction to mark it as failed");if(a.status===o.TransactionStatus.failed)return;n(Object.assign(Object.assign({},a),{status:o.TransactionStatus.failed,error:{name:"SmartTransactionFailed",message:`Smart transaction failed with status: ${i}`}}),`Smart transaction status: ${i}`)}}}},{package:"@metamask/smart-transactions-controller",file:"node_modules/@metamask/smart-transactions-controller/dist/utils.js"}],[1997,{"fast-json-stable-stringify":3666,uuid:4918},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.AbstractPollingControllerBaseMixin=n.getKey=void 0;const a=i(e("fast-json-stable-stringify")),r=e("uuid");n.getKey=e=>(0,a.default)(e),n.AbstractPollingControllerBaseMixin=function(e){var t,i;return t=new WeakMap,i=new WeakMap,class extends e{constructor(){super(...arguments),t.set(this,new Map),i.set(this,new Map)}startPolling(e){const i=(0,r.v4)(),a=(0,n.getKey)(e),o=s(this,t,"f").get(a)??new Set;return o.add(i),s(this,t,"f").set(a,o),1===o.size&&this._startPolling(e),i}stopAllPolling(){s(this,t,"f").forEach((e,t)=>{e.forEach(e=>{this.stopPollingByPollingToken(e)})})}stopPollingByPollingToken(e){if(!e)throw new Error("pollingToken required");let n=null;for(const[i,a]of s(this,t,"f"))if(a.delete(e)){0===a.size&&(n=i);break}if(n){this._stopPollingByPollingTokenSetId(n),s(this,t,"f").delete(n);const e=s(this,i,"f").get(n);if(e){for(const t of e)t(JSON.parse(n));e.clear()}}}onPollingComplete(e,t){const a=(0,n.getKey)(e),r=s(this,i,"f").get(a)??new Set;r.add(t),s(this,i,"f").set(a,r)}}}}}},{package:"@metamask/smart-transactions-controller>@metamask/polling-controller",file:"node_modules/@metamask/smart-transactions-controller/node_modules/@metamask/polling-controller/dist/AbstractPollingController.cjs"}],[1998,{"./AbstractPollingController.cjs":1997,"@metamask/base-controller":2004},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.BlockTrackerPollingController=n.BlockTrackerPollingControllerOnly=void 0;const i=e("@metamask/base-controller"),a=e("./AbstractPollingController.cjs");function r(e){var t;class n extends((0,a.AbstractPollingControllerBaseMixin)(e)){constructor(){super(...arguments),t.set(this,{})}_startPolling(e){const n=(0,a.getKey)(e);if(s(this,t,"f")[n])return;const i=this._getNetworkClientById(e.networkClientId);if(!i)throw new Error(`Unable to retrieve blockTracker for networkClientId ${e.networkClientId}`);{const a=this._executePoll.bind(this,e);i.blockTracker.addListener("latest",a),s(this,t,"f")[n]=a}}_stopPollingByPollingTokenSetId(e){const{networkClientId:n}=JSON.parse(e),i=this._getNetworkClientById(n);if(i&&s(this,t,"f")[e]){const n=s(this,t,"f")[e];n&&(i.blockTracker.removeListener("latest",n),delete s(this,t,"f")[e])}}}return t=new WeakMap,n}class o{}n.BlockTrackerPollingControllerOnly=()=>r(o);n.BlockTrackerPollingController=()=>r(i.BaseController)}}},{package:"@metamask/smart-transactions-controller>@metamask/polling-controller",file:"node_modules/@metamask/smart-transactions-controller/node_modules/@metamask/polling-controller/dist/BlockTrackerPollingController.cjs"}],[1999,{"./AbstractPollingController.cjs":1997,"@metamask/base-controller":2004},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__classPrivateFieldSet||function(e,t,n,s,i){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?i.call(e,n):i?i.value=n:t.set(e,n),n},i=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.StaticIntervalPollingController=n.StaticIntervalPollingControllerOnly=void 0;const a=e("@metamask/base-controller"),r=e("./AbstractPollingController.cjs");function o(e){var t,n;class a extends((0,r.AbstractPollingControllerBaseMixin)(e)){constructor(){super(...arguments),t.set(this,{}),n.set(this,1e3)}setIntervalLength(e){s(this,n,e,"f")}getIntervalLength(){return i(this,n,"f")}_startPolling(e){if(!i(this,n,"f"))throw new Error("intervalLength must be defined and greater than 0");const s=(0,r.getKey)(e),a=i(this,t,"f")[s];this._stopPollingByPollingTokenSetId(s);const o=i(this,t,"f")[s]=setTimeout(async()=>{try{await this._executePoll(e)}catch(e){console.error(e)}o===i(this,t,"f")[s]&&this._startPolling(e)},a?i(this,n,"f"):0)}_stopPollingByPollingTokenSetId(e){const n=i(this,t,"f")[e];n&&(clearTimeout(n),delete i(this,t,"f")[e])}}return t=new WeakMap,n=new WeakMap,a}class c{}n.StaticIntervalPollingControllerOnly=()=>o(c);n.StaticIntervalPollingController=()=>o(a.BaseController)}}},{package:"@metamask/smart-transactions-controller>@metamask/polling-controller",file:"node_modules/@metamask/smart-transactions-controller/node_modules/@metamask/polling-controller/dist/StaticIntervalPollingController.cjs"}],[20,{"../../../../shared/lib/delegation":5051,"@metamask/delegation-controller":1322,"@metamask/transaction-controller":2316},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.DelegationControllerInit=void 0,n.awaitDeleteDelegationEntry=o;var s=e("@metamask/delegation-controller"),i=e("@metamask/transaction-controller"),a=e("../../../../shared/lib/delegation");const r=e=>(0,a.getDeleGatorEnvironment)(Number(e));async function o(e,t,{hash:n,txMeta:s,entryToStore:a}){let{id:r}=s,o="continue";const c=({transactionMeta:s})=>{if(s.id===r)if(s.status===i.TransactionStatus.dropped&&s.replacedById)r=s.replacedById;else{switch(s.type){case i.TransactionType.contractInteraction:case i.TransactionType.retry:switch(s.status){case i.TransactionStatus.confirmed:o="delete";break;case i.TransactionStatus.dropped:case i.TransactionStatus.failed:case i.TransactionStatus.rejected:o="unsubscribe";break;default:return}break;case i.TransactionType.cancel:o="unsubscribe";break;default:return void console.warn("awaitDeleteDelegationEntry: Unexpected tx type",s.type)}"delete"===o&&(e.delete(n),a&&e.store({entry:a})),"unsubscribe"!==o&&"delete"!==o||t.unsubscribe("TransactionController:transactionStatusUpdated",c)}};t.subscribe("TransactionController:transactionStatusUpdated",c)}n.DelegationControllerInit=({controllerMessenger:e,persistedState:t,initMessenger:n})=>{const i=new s.DelegationController({messenger:e,state:t.DelegationController,hashDelegation:a.getDelegationHashOffchain,getDelegationEnvironment:r});return e.registerActionHandler("DelegationController:signDelegation",i.signDelegation.bind(i)),{controller:i,api:{signDelegation:i.signDelegation.bind(i),storeDelegationEntry:i.store.bind(i),listDelegationEntries:i.list.bind(i),getDelegationEntry:i.retrieve.bind(i),getDelegationEntryChain:i.chain.bind(i),deleteDelegationEntry:i.delete.bind(i),awaitDeleteDelegationEntry:o.bind(null,i,n)}}}}}},{package:"$root$",file:"app/scripts/controller-init/delegation/delegation-controller-init.ts"}],[200,{"./enforced-simulations":199,"@metamask/transaction-controller":2316,"@metamask/utils":2361,lodash:4088},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.applyTransactionContainers=c,n.applyTransactionContainersExisting=async function({containerTypes:e,transactionId:t,messenger:n,updateEditableParams:s}){const a=(await n.call("TransactionController:getState")).transactions.find(e=>e.id===t);if(!a)throw new Error(`Transaction with ID ${t} not found.`);const{updateTransaction:r}=await c({isApproved:!1,messenger:n,transactionMeta:a,types:e}),o=(0,i.cloneDeep)(a);r(o),s(t,{containerTypes:e,data:o.txParams.data,gas:o.txParams.gas,to:o.txParams.to,value:o.txParams.value})};var s=e("@metamask/transaction-controller"),i=e("lodash"),a=e("@metamask/utils"),r=e("./enforced-simulations");const o=(0,a.createProjectLogger)("transaction-containers");async function c({isApproved:e,messenger:t,transactionMeta:n,types:a}){const{txParamsOriginal:c}=n,l=(0,i.cloneDeep)(n);if(c&&(l.txParams=(0,i.cloneDeep)(c)),a.includes(s.TransactionContainerType.EnforcedSimulations)){const{updateTransaction:n}=await(0,r.enforceSimulations)({messenger:t,transactionMeta:l,useRealSignature:e});n(l)}let u;if(!e){const{gas:e}=await t.call("TransactionController:estimateGas",l.txParams,l.networkClientId,{ignoreDelegationSignatures:!0});o("Estimated gas",e),u=e}return{updateTransaction:e=>{e.containerTypes=a,e.txParams=(0,i.cloneDeep)(l.txParams),u&&(e.txParams.gas=u)}}}}}},{package:"$root$",file:"app/scripts/lib/transaction/containers/util.ts"}],[2e3,{"./BlockTrackerPollingController.cjs":1998,"./StaticIntervalPollingController.cjs":1999},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.StaticIntervalPollingController=n.StaticIntervalPollingControllerOnly=n.BlockTrackerPollingController=n.BlockTrackerPollingControllerOnly=void 0;var s=e("./BlockTrackerPollingController.cjs");Object.defineProperty(n,"BlockTrackerPollingControllerOnly",{enumerable:!0,get:function(){return s.BlockTrackerPollingControllerOnly}}),Object.defineProperty(n,"BlockTrackerPollingController",{enumerable:!0,get:function(){return s.BlockTrackerPollingController}});var i=e("./StaticIntervalPollingController.cjs");Object.defineProperty(n,"StaticIntervalPollingControllerOnly",{enumerable:!0,get:function(){return i.StaticIntervalPollingControllerOnly}}),Object.defineProperty(n,"StaticIntervalPollingController",{enumerable:!0,get:function(){return i.StaticIntervalPollingController}})}}},{package:"@metamask/smart-transactions-controller>@metamask/polling-controller",file:"node_modules/@metamask/smart-transactions-controller/node_modules/@metamask/polling-controller/dist/index.cjs"}],[2001,{immer:3883},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,i=this&&this.__classPrivateFieldSet||function(e,t,n,s,i){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?i.call(e,n):i?i.value=n:t.set(e,n),n},a=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.getPersistentState=n.getAnonymizedState=n.BaseController=n.isBaseController=void 0;const r=e("immer");(0,r.enablePatches)(),n.isBaseController=function(e){return"object"==typeof e&&null!==e&&"name"in e&&"string"==typeof e.name&&"state"in e&&"object"==typeof e.state&&"metadata"in e&&"object"==typeof e.metadata};function o(e,t,n){return Object.keys(e).reduce((s,i)=>{try{const a=t[i];if(!a)throw new Error(`No metadata found for '${String(i)}'`);const r=a[n],o=e[i];return"function"==typeof r?s[i]=r(o):r&&(s[i]=o),s}catch(e){return setTimeout(()=>{throw e}),s}},{})}n.BaseController=class{constructor({messenger:e,metadata:t,name:n,state:a}){s.set(this,void 0),this.messagingSystem=e,this.name=n,i(this,s,(0,r.freeze)(a,!0),"f"),this.metadata=t,this.messagingSystem.registerActionHandler(`${n}:getState`,()=>this.state),this.messagingSystem.registerInitialEventPayload({eventType:`${n}:stateChange`,getPayload:()=>[this.state,[]]})}get state(){return a(this,s,"f")}set state(e){throw new Error("Controller state cannot be directly mutated; use 'update' method instead.")}update(e){const[t,n,o]=r.produceWithPatches(a(this,s,"f"),e);return n.length>0&&(i(this,s,t,"f"),this.messagingSystem.publish(`${this.name}:stateChange`,t,n)),{nextState:t,patches:n,inversePatches:o}}applyPatches(e){const t=(0,r.applyPatches)(a(this,s,"f"),e);i(this,s,t,"f"),this.messagingSystem.publish(`${this.name}:stateChange`,t,e)}destroy(){this.messagingSystem.clearEventSubscriptions(`${this.name}:stateChange`)}},s=new WeakMap,n.getAnonymizedState=function(e,t){return o(e,t,"anonymous")},n.getPersistentState=function(e,t){return o(e,t,"persist")}}}},{package:"@metamask/smart-transactions-controller>@metamask/polling-controller>@metamask/base-controller",file:"node_modules/@metamask/smart-transactions-controller/node_modules/@metamask/polling-controller/node_modules/@metamask/base-controller/dist/BaseController.cjs"}],[2002,{"./RestrictedMessenger.cjs":2003},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,i,a,r,o=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.Messenger=void 0;const c=e("./RestrictedMessenger.cjs");n.Messenger=class{constructor(){s.set(this,new Map),i.set(this,new Map),a.set(this,new Map),r.set(this,new Map)}registerActionHandler(e,t){if(o(this,s,"f").has(e))throw new Error(`A handler for ${e} has already been registered`);o(this,s,"f").set(e,t)}registerMethodActionHandlers(e,t){for(const n of t){const t=e[n];if("function"==typeof t){const s=`${e.name}:${n}`;this.registerActionHandler(s,t.bind(e))}}}unregisterActionHandler(e){o(this,s,"f").delete(e)}clearActions(){o(this,s,"f").clear()}call(e,...t){const n=o(this,s,"f").get(e);if(!n)throw new Error(`A handler for ${e} has not been registered`);return n(...t)}registerInitialEventPayload({eventType:e,getPayload:t}){o(this,a,"f").set(e,t)}publish(e,...t){const n=o(this,i,"f").get(e);if(n)for(const[e,s]of n.entries())try{if(s){const n=o(this,r,"f").get(e),i=s(...t);i!==n&&(o(this,r,"f").set(e,i),e(i,n))}else e(...t)}catch(e){setTimeout(()=>{throw e})}}subscribe(e,t,n){let s=o(this,i,"f").get(e);s||(s=new Map,o(this,i,"f").set(e,s));const c=t;if(s.set(c,n),n){const t=o(this,a,"f").get(e);if(t){const e=n(...t());o(this,r,"f").set(c,e)}}}unsubscribe(e,t){const n=o(this,i,"f").get(e),s=t;if(!n||!n.has(s))throw new Error(`Subscription not found for event: ${e}`);n.get(s)&&o(this,r,"f").delete(s),n.delete(s)}clearEventSubscriptions(e){o(this,i,"f").delete(e)}clearSubscriptions(){o(this,i,"f").clear()}getRestricted({name:e,allowedActions:t,allowedEvents:n}){return new c.RestrictedMessenger({messenger:this,name:e,allowedActions:t,allowedEvents:n})}},s=new WeakMap,i=new WeakMap,a=new WeakMap,r=new WeakMap}}},{package:"@metamask/smart-transactions-controller>@metamask/polling-controller>@metamask/base-controller",file:"node_modules/@metamask/smart-transactions-controller/node_modules/@metamask/polling-controller/node_modules/@metamask/base-controller/dist/Messenger.cjs"}],[2003,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s,i,a,r,o,c,l,u,d=this&&this.__classPrivateFieldSet||function(e,t,n,s,i){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?i.call(e,n):i?i.value=n:t.set(e,n),n},h=this&&this.__classPrivateFieldGet||function(e,t,n,s){if("a"===n&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?s:"a"===n?s.call(e):s?s.value:t.get(e)};Object.defineProperty(n,"__esModule",{value:!0}),n.RestrictedMessenger=void 0;n.RestrictedMessenger=class{constructor({messenger:e,name:t,allowedActions:n,allowedEvents:c}){if(s.add(this),i.set(this,void 0),a.set(this,void 0),r.set(this,void 0),o.set(this,void 0),!e)throw new Error("Messenger not provided");d(this,i,e,"f"),d(this,a,t,"f"),d(this,r,n,"f"),d(this,o,c,"f")}registerActionHandler(e,t){if(!h(this,s,"m",u).call(this,e))throw new Error(`Only allowed registering action handlers prefixed by '${h(this,a,"f")}:'`);h(this,i,"f").registerActionHandler(e,t)}registerMethodActionHandlers(e,t){h(this,i,"f").registerMethodActionHandlers(e,t)}unregisterActionHandler(e){if(!h(this,s,"m",u).call(this,e))throw new Error(`Only allowed unregistering action handlers prefixed by '${h(this,a,"f")}:'`);h(this,i,"f").unregisterActionHandler(e)}call(e,...t){if(!h(this,s,"m",l).call(this,e))throw new Error(`Action missing from allow list: ${e}`);return h(this,i,"f").call(e,...t)}registerInitialEventPayload({eventType:e,getPayload:t}){if(!h(this,s,"m",u).call(this,e))throw new Error(`Only allowed publishing events prefixed by '${h(this,a,"f")}:'`);h(this,i,"f").registerInitialEventPayload({eventType:e,getPayload:t})}publish(e,...t){if(!h(this,s,"m",u).call(this,e))throw new Error(`Only allowed publishing events prefixed by '${h(this,a,"f")}:'`);h(this,i,"f").publish(e,...t)}subscribe(e,t,n){if(!h(this,s,"m",c).call(this,e))throw new Error(`Event missing from allow list: ${e}`);return n?h(this,i,"f").subscribe(e,t,n):h(this,i,"f").subscribe(e,t)}unsubscribe(e,t){if(!h(this,s,"m",c).call(this,e))throw new Error(`Event missing from allow list: ${e}`);h(this,i,"f").unsubscribe(e,t)}clearEventSubscriptions(e){if(!h(this,s,"m",u).call(this,e))throw new Error(`Only allowed clearing events prefixed by '${h(this,a,"f")}:'`);h(this,i,"f").clearEventSubscriptions(e)}},i=new WeakMap,a=new WeakMap,r=new WeakMap,o=new WeakMap,s=new WeakSet,c=function(e){const t=h(this,o,"f");return h(this,s,"m",u).call(this,e)||null!==t&&t.includes(e)},l=function(e){const t=h(this,r,"f");return h(this,s,"m",u).call(this,e)||null!==t&&t.includes(e)},u=function(e){return e.startsWith(`${h(this,a,"f")}:`)}}}},{package:"@metamask/smart-transactions-controller>@metamask/polling-controller>@metamask/base-controller",file:"node_modules/@metamask/smart-transactions-controller/node_modules/@metamask/polling-controller/node_modules/@metamask/base-controller/dist/RestrictedMessenger.cjs"}],[2004,{"./BaseController.cjs":2001,"./Messenger.cjs":2002,"./RestrictedMessenger.cjs":2003},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RestrictedMessenger=n.Messenger=n.isBaseController=n.getPersistentState=n.getAnonymizedState=n.BaseController=void 0;var s=e("./BaseController.cjs");Object.defineProperty(n,"BaseController",{enumerable:!0,get:function(){return s.BaseController}}),Object.defineProperty(n,"getAnonymizedState",{enumerable:!0,get:function(){return s.getAnonymizedState}}),Object.defineProperty(n,"getPersistentState",{enumerable:!0,get:function(){return s.getPersistentState}}),Object.defineProperty(n,"isBaseController",{enumerable:!0,get:function(){return s.isBaseController}});var i=e("./Messenger.cjs");Object.defineProperty(n,"Messenger",{enumerable:!0,get:function(){return i.Messenger}});var a=e("./RestrictedMessenger.cjs");Object.defineProperty(n,"RestrictedMessenger",{enumerable:!0,get:function(){return a.RestrictedMessenger}})}}},{package:"@metamask/smart-transactions-controller>@metamask/polling-controller>@metamask/base-controller",file:"node_modules/@metamask/smart-transactions-controller/node_modules/@metamask/polling-controller/node_modules/@metamask/base-controller/dist/index.cjs"}],[2005,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){!function(e){var n,s=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,i=Math.ceil,a=Math.floor,r="[BigNumber Error] ",o=r+"Number primitive has more than 15 significant digits: ",c=1e14,l=14,u=9007199254740991,d=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],h=1e7,p=1e9;function m(e){var t=0|e;return e>0||e===t?t:t-1}function f(e){for(var t,n,s=1,i=e.length,a=e[0]+"";s<i;){for(t=e[s++]+"",n=l-t.length;n--;t="0"+t);a+=t}for(i=a.length;48===a.charCodeAt(--i););return a.slice(0,i+1||1)}function g(e,t){var n,s,i=e.c,a=t.c,r=e.s,o=t.s,c=e.e,l=t.e;if(!r||!o)return null;if(n=i&&!i[0],s=a&&!a[0],n||s)return n?s?0:-o:r;if(r!=o)return r;if(n=r<0,s=c==l,!i||!a)return s?0:!i^n?1:-1;if(!s)return c>l^n?1:-1;for(o=(c=i.length)<(l=a.length)?c:l,r=0;r<o;r++)if(i[r]!=a[r])return i[r]>a[r]^n?1:-1;return c==l?0:c>l^n?1:-1}function y(e,t,n,s){if(e<t||e>n||e!==a(e))throw Error(r+(s||"Argument")+("number"==typeof e?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function w(e){var t=e.c.length-1;return m(e.e/l)==t&&e.c[t]%2!=0}function S(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function b(e,t,n){var s,i;if(t<0){for(i=n+".";++t;i+=n);e=i+e}else if(++t>(s=e.length)){for(i=n,t-=s;--t;i+=n);e+=i}else t<s&&(e=e.slice(0,t)+"."+e.slice(t));return e}n=function e(t){var n,v,T,k,_,E,C,P,A,I,O=q.prototype={constructor:q,toString:null,valueOf:null},M=new q(1),j=20,N=4,R=-7,x=21,D=-1e7,L=1e7,F=!1,H=1,B=0,U={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},$="0123456789abcdefghijklmnopqrstuvwxyz",W=!0;function q(e,t){var n,i,r,c,d,h,p,m,f=this;if(!(f instanceof q))return new q(e,t);if(null==t){if(e&&!0===e._isBigNumber)return f.s=e.s,void(!e.c||e.e>L?f.c=f.e=null:e.e<D?f.c=[f.e=0]:(f.e=e.e,f.c=e.c.slice()));if((h="number"==typeof e)&&0*e==0){if(f.s=1/e<0?(e=-e,-1):1,e===~~e){for(c=0,d=e;d>=10;d/=10,c++);return void(c>L?f.c=f.e=null:(f.e=c,f.c=[e]))}m=String(e)}else{if(!s.test(m=String(e)))return T(f,m,h);f.s=45==m.charCodeAt(0)?(m=m.slice(1),-1):1}(c=m.indexOf("."))>-1&&(m=m.replace(".","")),(d=m.search(/e/i))>0?(c<0&&(c=d),c+=+m.slice(d+1),m=m.substring(0,d)):c<0&&(c=m.length)}else{if(y(t,2,$.length,"Base"),10==t&&W)return z(f=new q(e),j+f.e+1,N);if(m=String(e),h="number"==typeof e){if(0*e!=0)return T(f,m,h,t);if(f.s=1/e<0?(m=m.slice(1),-1):1,q.DEBUG&&m.replace(/^0\.0*|\./,"").length>15)throw Error(o+e)}else f.s=45===m.charCodeAt(0)?(m=m.slice(1),-1):1;for(n=$.slice(0,t),c=d=0,p=m.length;d<p;d++)if(n.indexOf(i=m.charAt(d))<0){if("."==i){if(d>c){c=p;continue}}else if(!r&&(m==m.toUpperCase()&&(m=m.toLowerCase())||m==m.toLowerCase()&&(m=m.toUpperCase()))){r=!0,d=-1,c=0;continue}return T(f,String(e),h,t)}h=!1,(c=(m=v(m,t,10,f.s)).indexOf("."))>-1?m=m.replace(".",""):c=m.length}for(d=0;48===m.charCodeAt(d);d++);for(p=m.length;48===m.charCodeAt(--p););if(m=m.slice(d,++p)){if(p-=d,h&&q.DEBUG&&p>15&&(e>u||e!==a(e)))throw Error(o+f.s*e);if((c=c-d-1)>L)f.c=f.e=null;else if(c<D)f.c=[f.e=0];else{if(f.e=c,f.c=[],d=(c+1)%l,c<0&&(d+=l),d<p){for(d&&f.c.push(+m.slice(0,d)),p-=l;d<p;)f.c.push(+m.slice(d,d+=l));d=l-(m=m.slice(d)).length}else d-=p;for(;d--;m+="0");f.c.push(+m)}}else f.c=[f.e=0]}function K(e,t,n,s){var i,a,r,o,c;if(null==n?n=N:y(n,0,8),!e.c)return e.toString();if(i=e.c[0],r=e.e,null==t)c=f(e.c),c=1==s||2==s&&(r<=R||r>=x)?S(c,r):b(c,r,"0");else if(a=(e=z(new q(e),t,n)).e,o=(c=f(e.c)).length,1==s||2==s&&(t<=a||a<=R)){for(;o<t;c+="0",o++);c=S(c,a)}else if(t-=r,c=b(c,a,"0"),a+1>o){if(--t>0)for(c+=".";t--;c+="0");}else if((t+=a-o)>0)for(a+1==o&&(c+=".");t--;c+="0");return e.s<0&&i?"-"+c:c}function G(e,t){for(var n,s,i=1,a=new q(e[0]);i<e.length;i++)(!(s=new q(e[i])).s||(n=g(a,s))===t||0===n&&a.s===t)&&(a=s);return a}function V(e,t,n){for(var s=1,i=t.length;!t[--i];t.pop());for(i=t[0];i>=10;i/=10,s++);return(n=s+n*l-1)>L?e.c=e.e=null:n<D?e.c=[e.e=0]:(e.e=n,e.c=t),e}function z(e,t,n,s){var r,o,u,h,p,m,f,g=e.c,y=d;if(g){e:{for(r=1,h=g[0];h>=10;h/=10,r++);if((o=t-r)<0)o+=l,u=t,p=g[m=0],f=a(p/y[r-u-1]%10);else if((m=i((o+1)/l))>=g.length){if(!s)break e;for(;g.length<=m;g.push(0));p=f=0,r=1,u=(o%=l)-l+1}else{for(p=h=g[m],r=1;h>=10;h/=10,r++);f=(u=(o%=l)-l+r)<0?0:a(p/y[r-u-1]%10)}if(s=s||t<0||null!=g[m+1]||(u<0?p:p%y[r-u-1]),s=n<4?(f||s)&&(0==n||n==(e.s<0?3:2)):f>5||5==f&&(4==n||s||6==n&&(o>0?u>0?p/y[r-u]:0:g[m-1])%10&1||n==(e.s<0?8:7)),t<1||!g[0])return g.length=0,s?(t-=e.e+1,g[0]=y[(l-t%l)%l],e.e=-t||0):g[0]=e.e=0,e;if(0==o?(g.length=m,h=1,m--):(g.length=m+1,h=y[l-o],g[m]=u>0?a(p/y[r-u]%y[u])*h:0),s)for(;;){if(0==m){for(o=1,u=g[0];u>=10;u/=10,o++);for(u=g[0]+=h,h=1;u>=10;u/=10,h++);o!=h&&(e.e++,g[0]==c&&(g[0]=1));break}if(g[m]+=h,g[m]!=c)break;g[m--]=0,h=1}for(o=g.length;0===g[--o];g.pop());}e.e>L?e.c=e.e=null:e.e<D&&(e.c=[e.e=0])}return e}function Y(e){var t,n=e.e;return null===n?e.toString():(t=f(e.c),t=n<=R||n>=x?S(t,n):b(t,n,"0"),e.s<0?"-"+t:t)}return q.clone=e,q.ROUND_UP=0,q.ROUND_DOWN=1,q.ROUND_CEIL=2,q.ROUND_FLOOR=3,q.ROUND_HALF_UP=4,q.ROUND_HALF_DOWN=5,q.ROUND_HALF_EVEN=6,q.ROUND_HALF_CEIL=7,q.ROUND_HALF_FLOOR=8,q.EUCLID=9,q.config=q.set=function(e){var t,n;if(null!=e){if("object"!=typeof e)throw Error(r+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(y(n=e[t],0,p,t),j=n),e.hasOwnProperty(t="ROUNDING_MODE")&&(y(n=e[t],0,8,t),N=n),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((n=e[t])&&n.pop?(y(n[0],-p,0,t),y(n[1],0,p,t),R=n[0],x=n[1]):(y(n,-p,p,t),R=-(x=n<0?-n:n))),e.hasOwnProperty(t="RANGE"))if((n=e[t])&&n.pop)y(n[0],-p,-1,t),y(n[1],1,p,t),D=n[0],L=n[1];else{if(y(n,-p,p,t),!n)throw Error(r+t+" cannot be zero: "+n);D=-(L=n<0?-n:n)}if(e.hasOwnProperty(t="CRYPTO")){if((n=e[t])!==!!n)throw Error(r+t+" not true or false: "+n);if(n){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw F=!n,Error(r+"crypto unavailable");F=n}else F=n}if(e.hasOwnProperty(t="MODULO_MODE")&&(y(n=e[t],0,9,t),H=n),e.hasOwnProperty(t="POW_PRECISION")&&(y(n=e[t],0,p,t),B=n),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(n=e[t]))throw Error(r+t+" not an object: "+n);U=n}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(n=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(n))throw Error(r+t+" invalid: "+n);W="0123456789"==n.slice(0,10),$=n}}return{DECIMAL_PLACES:j,ROUNDING_MODE:N,EXPONENTIAL_AT:[R,x],RANGE:[D,L],CRYPTO:F,MODULO_MODE:H,POW_PRECISION:B,FORMAT:U,ALPHABET:$}},q.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!q.DEBUG)return!0;var t,n,s=e.c,i=e.e,o=e.s;e:if("[object Array]"=={}.toString.call(s)){if((1===o||-1===o)&&i>=-p&&i<=p&&i===a(i)){if(0===s[0]){if(0===i&&1===s.length)return!0;break e}if((t=(i+1)%l)<1&&(t+=l),String(s[0]).length==t){for(t=0;t<s.length;t++)if((n=s[t])<0||n>=c||n!==a(n))break e;if(0!==n)return!0}}}else if(null===s&&null===i&&(null===o||1===o||-1===o))return!0;throw Error(r+"Invalid BigNumber: "+e)},q.maximum=q.max=function(){return G(arguments,-1)},q.minimum=q.min=function(){return G(arguments,1)},q.random=(k=9007199254740992,_=Math.random()*k&2097151?function(){return a(Math.random()*k)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,n,s,o,c,u=0,h=[],m=new q(M);if(null==e?e=j:y(e,0,p),o=i(e/l),F)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(o*=2));u<o;)(c=131072*t[u]+(t[u+1]>>>11))>=9e15?(n=crypto.getRandomValues(new Uint32Array(2)),t[u]=n[0],t[u+1]=n[1]):(h.push(c%1e14),u+=2);u=o/2}else{if(!crypto.randomBytes)throw F=!1,Error(r+"crypto unavailable");for(t=crypto.randomBytes(o*=7);u<o;)(c=281474976710656*(31&t[u])+1099511627776*t[u+1]+4294967296*t[u+2]+16777216*t[u+3]+(t[u+4]<<16)+(t[u+5]<<8)+t[u+6])>=9e15?crypto.randomBytes(7).copy(t,u):(h.push(c%1e14),u+=7);u=o/7}if(!F)for(;u<o;)(c=_())<9e15&&(h[u++]=c%1e14);for(o=h[--u],e%=l,o&&e&&(c=d[l-e],h[u]=a(o/c)*c);0===h[u];h.pop(),u--);if(u<0)h=[s=0];else{for(s=-1;0===h[0];h.splice(0,1),s-=l);for(u=1,c=h[0];c>=10;c/=10,u++);u<l&&(s-=l-u)}return m.e=s,m.c=h,m}),q.sum=function(){for(var e=1,t=arguments,n=new q(t[0]);e<t.length;)n=n.plus(t[e++]);return n},v=function(){var e="0123456789";function t(e,t,n,s){for(var i,a,r=[0],o=0,c=e.length;o<c;){for(a=r.length;a--;r[a]*=t);for(r[0]+=s.indexOf(e.charAt(o++)),i=0;i<r.length;i++)r[i]>n-1&&(null==r[i+1]&&(r[i+1]=0),r[i+1]+=r[i]/n|0,r[i]%=n)}return r.reverse()}return function(s,i,a,r,o){var c,l,u,d,h,p,m,g,y=s.indexOf("."),w=j,S=N;for(y>=0&&(d=B,B=0,s=s.replace(".",""),p=(g=new q(i)).pow(s.length-y),B=d,g.c=t(b(f(p.c),p.e,"0"),10,a,e),g.e=g.c.length),u=d=(m=t(s,i,a,o?(c=$,e):(c=e,$))).length;0==m[--d];m.pop());if(!m[0])return c.charAt(0);if(y<0?--u:(p.c=m,p.e=u,p.s=r,m=(p=n(p,g,w,S,a)).c,h=p.r,u=p.e),y=m[l=u+w+1],d=a/2,h=h||l<0||null!=m[l+1],h=S<4?(null!=y||h)&&(0==S||S==(p.s<0?3:2)):y>d||y==d&&(4==S||h||6==S&&1&m[l-1]||S==(p.s<0?8:7)),l<1||!m[0])s=h?b(c.charAt(1),-w,c.charAt(0)):c.charAt(0);else{if(m.length=l,h)for(--a;++m[--l]>a;)m[l]=0,l||(++u,m=[1].concat(m));for(d=m.length;!m[--d];);for(y=0,s="";y<=d;s+=c.charAt(m[y++]));s=b(s,u,c.charAt(0))}return s}}(),n=function(){function e(e,t,n){var s,i,a,r,o=0,c=e.length,l=t%h,u=t/h|0;for(e=e.slice();c--;)o=((i=l*(a=e[c]%h)+(s=u*a+(r=e[c]/h|0)*l)%h*h+o)/n|0)+(s/h|0)+u*r,e[c]=i%n;return o&&(e=[o].concat(e)),e}function t(e,t,n,s){var i,a;if(n!=s)a=n>s?1:-1;else for(i=a=0;i<n;i++)if(e[i]!=t[i]){a=e[i]>t[i]?1:-1;break}return a}function n(e,t,n,s){for(var i=0;n--;)e[n]-=i,i=e[n]<t[n]?1:0,e[n]=i*s+e[n]-t[n];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(s,i,r,o,u){var d,h,p,f,g,y,w,S,b,v,T,k,_,E,C,P,A,I=s.s==i.s?1:-1,O=s.c,M=i.c;if(!(O&&O[0]&&M&&M[0]))return new q(s.s&&i.s&&(O?!M||O[0]!=M[0]:M)?O&&0==O[0]||!M?0*I:I/0:NaN);for(b=(S=new q(I)).c=[],I=r+(h=s.e-i.e)+1,u||(u=c,h=m(s.e/l)-m(i.e/l),I=I/l|0),p=0;M[p]==(O[p]||0);p++);if(M[p]>(O[p]||0)&&h--,I<0)b.push(1),f=!0;else{for(E=O.length,P=M.length,p=0,I+=2,(g=a(u/(M[0]+1)))>1&&(M=e(M,g,u),O=e(O,g,u),P=M.length,E=O.length),_=P,T=(v=O.slice(0,P)).length;T<P;v[T++]=0);A=M.slice(),A=[0].concat(A),C=M[0],M[1]>=u/2&&C++;do{if(g=0,(d=t(M,v,P,T))<0){if(k=v[0],P!=T&&(k=k*u+(v[1]||0)),(g=a(k/C))>1)for(g>=u&&(g=u-1),w=(y=e(M,g,u)).length,T=v.length;1==t(y,v,w,T);)g--,n(y,P<w?A:M,w,u),w=y.length,d=1;else 0==g&&(d=g=1),w=(y=M.slice()).length;if(w<T&&(y=[0].concat(y)),n(v,y,T,u),T=v.length,-1==d)for(;t(M,v,P,T)<1;)g++,n(v,P<T?A:M,T,u),T=v.length}else 0===d&&(g++,v=[0]);b[p++]=g,v[0]?v[T++]=O[_]||0:(v=[O[_]],T=1)}while((_++<E||null!=v[0])&&I--);f=null!=v[0],b[0]||b.splice(0,1)}if(u==c){for(p=1,I=b[0];I>=10;I/=10,p++);z(S,r+(S.e=p+h*l-1)+1,o,f)}else S.e=h,S.r=+f;return S}}(),E=/^(-?)0([xbo])(?=\w[\w.]*$)/i,C=/^([^.]+)\.$/,P=/^\.([^.]+)$/,A=/^-?(Infinity|NaN)$/,I=/^\s*\+(?=[\w.])|^\s+|\s+$/g,T=function(e,t,n,s){var i,a=n?t:t.replace(I,"");if(A.test(a))e.s=isNaN(a)?null:a<0?-1:1;else{if(!n&&(a=a.replace(E,function(e,t,n){return i="x"==(n=n.toLowerCase())?16:"b"==n?2:8,s&&s!=i?e:t}),s&&(i=s,a=a.replace(C,"$1").replace(P,"0.$1")),t!=a))return new q(a,i);if(q.DEBUG)throw Error(r+"Not a"+(s?" base "+s:"")+" number: "+t);e.s=null}e.c=e.e=null},O.absoluteValue=O.abs=function(){var e=new q(this);return e.s<0&&(e.s=1),e},O.comparedTo=function(e,t){return g(this,new q(e,t))},O.decimalPlaces=O.dp=function(e,t){var n,s,i,a=this;if(null!=e)return y(e,0,p),null==t?t=N:y(t,0,8),z(new q(a),e+a.e+1,t);if(!(n=a.c))return null;if(s=((i=n.length-1)-m(this.e/l))*l,i=n[i])for(;i%10==0;i/=10,s--);return s<0&&(s=0),s},O.dividedBy=O.div=function(e,t){return n(this,new q(e,t),j,N)},O.dividedToIntegerBy=O.idiv=function(e,t){return n(this,new q(e,t),0,1)},O.exponentiatedBy=O.pow=function(e,t){var n,s,o,c,u,d,h,p,m=this;if((e=new q(e)).c&&!e.isInteger())throw Error(r+"Exponent not an integer: "+Y(e));if(null!=t&&(t=new q(t)),u=e.e>14,!m.c||!m.c[0]||1==m.c[0]&&!m.e&&1==m.c.length||!e.c||!e.c[0])return p=new q(Math.pow(+Y(m),u?e.s*(2-w(e)):+Y(e))),t?p.mod(t):p;if(d=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new q(NaN);(s=!d&&m.isInteger()&&t.isInteger())&&(m=m.mod(t))}else{if(e.e>9&&(m.e>0||m.e<-1||(0==m.e?m.c[0]>1||u&&m.c[1]>=24e7:m.c[0]<8e13||u&&m.c[0]<=9999975e7)))return c=m.s<0&&w(e)?-0:0,m.e>-1&&(c=1/c),new q(d?1/c:c);B&&(c=i(B/l+2))}for(u?(n=new q(.5),d&&(e.s=1),h=w(e)):h=(o=Math.abs(+Y(e)))%2,p=new q(M);;){if(h){if(!(p=p.times(m)).c)break;c?p.c.length>c&&(p.c.length=c):s&&(p=p.mod(t))}if(o){if(0===(o=a(o/2)))break;h=o%2}else if(z(e=e.times(n),e.e+1,1),e.e>14)h=w(e);else{if(0===(o=+Y(e)))break;h=o%2}m=m.times(m),c?m.c&&m.c.length>c&&(m.c.length=c):s&&(m=m.mod(t))}return s?p:(d&&(p=M.div(p)),t?p.mod(t):c?z(p,B,N,undefined):p)},O.integerValue=function(e){var t=new q(this);return null==e?e=N:y(e,0,8),z(t,t.e+1,e)},O.isEqualTo=O.eq=function(e,t){return 0===g(this,new q(e,t))},O.isFinite=function(){return!!this.c},O.isGreaterThan=O.gt=function(e,t){return g(this,new q(e,t))>0},O.isGreaterThanOrEqualTo=O.gte=function(e,t){return 1===(t=g(this,new q(e,t)))||0===t},O.isInteger=function(){return!!this.c&&m(this.e/l)>this.c.length-2},O.isLessThan=O.lt=function(e,t){return g(this,new q(e,t))<0},O.isLessThanOrEqualTo=O.lte=function(e,t){return-1===(t=g(this,new q(e,t)))||0===t},O.isNaN=function(){return!this.s},O.isNegative=function(){return this.s<0},O.isPositive=function(){return this.s>0},O.isZero=function(){return!!this.c&&0==this.c[0]},O.minus=function(e,t){var n,s,i,a,r=this,o=r.s;if(t=(e=new q(e,t)).s,!o||!t)return new q(NaN);if(o!=t)return e.s=-t,r.plus(e);var u=r.e/l,d=e.e/l,h=r.c,p=e.c;if(!u||!d){if(!h||!p)return h?(e.s=-t,e):new q(p?r:NaN);if(!h[0]||!p[0])return p[0]?(e.s=-t,e):new q(h[0]?r:3==N?-0:0)}if(u=m(u),d=m(d),h=h.slice(),o=u-d){for((a=o<0)?(o=-o,i=h):(d=u,i=p),i.reverse(),t=o;t--;i.push(0));i.reverse()}else for(s=(a=(o=h.length)<(t=p.length))?o:t,o=t=0;t<s;t++)if(h[t]!=p[t]){a=h[t]<p[t];break}if(a&&(i=h,h=p,p=i,e.s=-e.s),(t=(s=p.length)-(n=h.length))>0)for(;t--;h[n++]=0);for(t=c-1;s>o;){if(h[--s]<p[s]){for(n=s;n&&!h[--n];h[n]=t);--h[n],h[s]+=c}h[s]-=p[s]}for(;0==h[0];h.splice(0,1),--d);return h[0]?V(e,h,d):(e.s=3==N?-1:1,e.c=[e.e=0],e)},O.modulo=O.mod=function(e,t){var s,i,a=this;return e=new q(e,t),!a.c||!e.s||e.c&&!e.c[0]?new q(NaN):!e.c||a.c&&!a.c[0]?new q(a):(9==H?(i=e.s,e.s=1,s=n(a,e,0,3),e.s=i,s.s*=i):s=n(a,e,0,H),(e=a.minus(s.times(e))).c[0]||1!=H||(e.s=a.s),e)},O.multipliedBy=O.times=function(e,t){var n,s,i,a,r,o,u,d,p,f,g,y,w,S,b,v=this,T=v.c,k=(e=new q(e,t)).c;if(!(T&&k&&T[0]&&k[0]))return!v.s||!e.s||T&&!T[0]&&!k||k&&!k[0]&&!T?e.c=e.e=e.s=null:(e.s*=v.s,T&&k?(e.c=[0],e.e=0):e.c=e.e=null),e;for(s=m(v.e/l)+m(e.e/l),e.s*=v.s,(u=T.length)<(f=k.length)&&(w=T,T=k,k=w,i=u,u=f,f=i),i=u+f,w=[];i--;w.push(0));for(S=c,b=h,i=f;--i>=0;){for(n=0,g=k[i]%b,y=k[i]/b|0,a=i+(r=u);a>i;)n=((d=g*(d=T[--r]%b)+(o=y*d+(p=T[r]/b|0)*g)%b*b+w[a]+n)/S|0)+(o/b|0)+y*p,w[a--]=d%S;w[a]=n}return n?++s:w.splice(0,1),V(e,w,s)},O.negated=function(){var e=new q(this);return e.s=-e.s||null,e},O.plus=function(e,t){var n,s=this,i=s.s;if(t=(e=new q(e,t)).s,!i||!t)return new q(NaN);if(i!=t)return e.s=-t,s.minus(e);var a=s.e/l,r=e.e/l,o=s.c,u=e.c;if(!a||!r){if(!o||!u)return new q(i/0);if(!o[0]||!u[0])return u[0]?e:new q(o[0]?s:0*i)}if(a=m(a),r=m(r),o=o.slice(),i=a-r){for(i>0?(r=a,n=u):(i=-i,n=o),n.reverse();i--;n.push(0));n.reverse()}for((i=o.length)-(t=u.length)<0&&(n=u,u=o,o=n,t=i),i=0;t;)i=(o[--t]=o[t]+u[t]+i)/c|0,o[t]=c===o[t]?0:o[t]%c;return i&&(o=[i].concat(o),++r),V(e,o,r)},O.precision=O.sd=function(e,t){var n,s,i,a=this;if(null!=e&&e!==!!e)return y(e,1,p),null==t?t=N:y(t,0,8),z(new q(a),e,t);if(!(n=a.c))return null;if(s=(i=n.length-1)*l+1,i=n[i]){for(;i%10==0;i/=10,s--);for(i=n[0];i>=10;i/=10,s++);}return e&&a.e+1>s&&(s=a.e+1),s},O.shiftedBy=function(e){return y(e,-9007199254740991,u),this.times("1e"+e)},O.squareRoot=O.sqrt=function(){var e,t,s,i,a,r=this,o=r.c,c=r.s,l=r.e,u=j+4,d=new q("0.5");if(1!==c||!o||!o[0])return new q(!c||c<0&&(!o||o[0])?NaN:o?r:1/0);if(0==(c=Math.sqrt(+Y(r)))||c==1/0?(((t=f(o)).length+l)%2==0&&(t+="0"),c=Math.sqrt(+t),l=m((l+1)/2)-(l<0||l%2),s=new q(t=c==1/0?"5e"+l:(t=c.toExponential()).slice(0,t.indexOf("e")+1)+l)):s=new q(c+""),s.c[0])for((c=(l=s.e)+u)<3&&(c=0);;)if(a=s,s=d.times(a.plus(n(r,a,u,1))),f(a.c).slice(0,c)===(t=f(s.c)).slice(0,c)){if(s.e<l&&--c,"9999"!=(t=t.slice(c-3,c+1))&&(i||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(z(s,s.e+j+2,1),e=!s.times(s).eq(r));break}if(!i&&(z(a,a.e+j+2,0),a.times(a).eq(r))){s=a;break}u+=4,c+=4,i=1}return z(s,s.e+j+1,N,e)},O.toExponential=function(e,t){return null!=e&&(y(e,0,p),e++),K(this,e,t,1)},O.toFixed=function(e,t){return null!=e&&(y(e,0,p),e=e+this.e+1),K(this,e,t)},O.toFormat=function(e,t,n){var s,i=this;if(null==n)null!=e&&t&&"object"==typeof t?(n=t,t=null):e&&"object"==typeof e?(n=e,e=t=null):n=U;else if("object"!=typeof n)throw Error(r+"Argument not an object: "+n);if(s=i.toFixed(e,t),i.c){var a,o=s.split("."),c=+n.groupSize,l=+n.secondaryGroupSize,u=n.groupSeparator||"",d=o[0],h=o[1],p=i.s<0,m=p?d.slice(1):d,f=m.length;if(l&&(a=c,c=l,l=a,f-=a),c>0&&f>0){for(a=f%c||c,d=m.substr(0,a);a<f;a+=c)d+=u+m.substr(a,c);l>0&&(d+=u+m.slice(a)),p&&(d="-"+d)}s=h?d+(n.decimalSeparator||"")+((l=+n.fractionGroupSize)?h.replace(new RegExp("\\d{"+l+"}\\B","g"),"$&"+(n.fractionGroupSeparator||"")):h):d}return(n.prefix||"")+s+(n.suffix||"")},O.toFraction=function(e){var t,s,i,a,o,c,u,h,p,m,g,y,w=this,S=w.c;if(null!=e&&(!(u=new q(e)).isInteger()&&(u.c||1!==u.s)||u.lt(M)))throw Error(r+"Argument "+(u.isInteger()?"out of range: ":"not an integer: ")+Y(u));if(!S)return new q(w);for(t=new q(M),p=s=new q(M),i=h=new q(M),y=f(S),o=t.e=y.length-w.e-1,t.c[0]=d[(c=o%l)<0?l+c:c],e=!e||u.comparedTo(t)>0?o>0?t:p:u,c=L,L=1/0,u=new q(y),h.c[0]=0;m=n(u,t,0,1),1!=(a=s.plus(m.times(i))).comparedTo(e);)s=i,i=a,p=h.plus(m.times(a=p)),h=a,t=u.minus(m.times(a=t)),u=a;return a=n(e.minus(s),i,0,1),h=h.plus(a.times(p)),s=s.plus(a.times(i)),h.s=p.s=w.s,g=n(p,i,o*=2,N).minus(w).abs().comparedTo(n(h,s,o,N).minus(w).abs())<1?[p,i]:[h,s],L=c,g},O.toNumber=function(){return+Y(this)},O.toPrecision=function(e,t){return null!=e&&y(e,1,p),K(this,e,t,2)},O.toString=function(e){var t,n=this,s=n.s,i=n.e;return null===i?s?(t="Infinity",s<0&&(t="-"+t)):t="NaN":(null==e?t=i<=R||i>=x?S(f(n.c),i):b(f(n.c),i,"0"):10===e&&W?t=b(f((n=z(new q(n),j+i+1,N)).c),n.e,"0"):(y(e,2,$.length,"Base"),t=v(b(f(n.c),i,"0"),10,e,s,!0)),s<0&&n.c[0]&&(t="-"+t)),t},O.valueOf=O.toJSON=function(){return Y(this)},O._isBigNumber=!0,null!=t&&q.set(t),q}(),n.default=n.BigNumber=n,"function"==typeof define&&define.amd?define(function(){return n}):void 0!==t&&t.exports?t.exports=n:(e||(e="undefined"!=typeof self&&self?self:window),e.BigNumber=n)}(this)}}},{package:"@metamask/smart-transactions-controller>bignumber.js",file:"node_modules/@metamask/smart-transactions-controller/node_modules/bignumber.js/bignumber.js"}],[2006,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){t.exports={name:"@metamask/smart-transactions-controller",version:"18.1.0",description:"Improves success rates for swaps by trialing transactions privately and finding minimum fees",repository:{type:"git",url:"https://github.com/MetaMask/smart-transactions-controller.git"},license:"SEE LICENSE IN LICENSE",main:"dist/index.js",types:"dist/index.d.ts",files:["dist/"],scripts:{build:"tsc --project tsconfig.build.json","build:clean":"rm -rf dist && yarn build","build:link":"yarn build && cd dist && yarn link && rm -rf node_modules && cd ..",lint:"yarn lint:eslint && yarn lint:misc --check && yarn lint:changelog","lint:changelog":"auto-changelog validate --prettier","lint:eslint":"eslint . --cache --ext js,ts","lint:fix":"yarn lint:eslint --fix && yarn lint:misc --write && yarn lint:changelog","lint:misc":"prettier '**/*.json' '**/*.md' '**/*.yml' '!.yarnrc.yml' --ignore-path .gitignore --no-error-on-unmatched-pattern",prepack:"./scripts/prepack.sh",test:"jest","test:watch":"jest --watchAll"},dependencies:{"@babel/runtime":"^7.24.1","@ethereumjs/tx":"^5.2.1","@ethereumjs/util":"^9.0.2","@ethersproject/bytes":"^5.7.0","@ethersproject/keccak256":"^5.8.0","@ethersproject/transactions":"^5.7.0","@metamask/base-controller":"^7.0.1","@metamask/controller-utils":"^11.0.0","@metamask/eth-json-rpc-provider":"^4.1.6","@metamask/eth-query":"^4.0.0","@metamask/polling-controller":"^12.0.0","bignumber.js":"^9.0.1","fast-json-patch":"^3.1.0",lodash:"^4.17.21"},devDependencies:{"@lavamoat/allow-scripts":"^3.2.1","@lavamoat/preinstall-always-fail":"^2.1.0","@metamask/auto-changelog":"^3.1.0","@metamask/eslint-config":"^12.2.0","@metamask/eslint-config-jest":"^12.1.0","@metamask/eslint-config-nodejs":"^12.1.0","@metamask/eslint-config-typescript":"^12.1.0","@metamask/gas-fee-controller":"^22.0.0","@metamask/json-rpc-engine":"^10.0.1","@metamask/network-controller":"^24.0.0","@metamask/transaction-controller":"^42.0.0","@types/jest":"^26.0.24","@types/lodash":"^4.14.194","@types/node":"^18.19.17","@types/sinon":"^9.0.10","@typescript-eslint/eslint-plugin":"^5.33.0","@typescript-eslint/parser":"^5.33.0",eslint:"^8.48.0","eslint-config-prettier":"^8.8.0","eslint-plugin-import":"~2.26.0","eslint-plugin-jest":"^27.1.5","eslint-plugin-jsdoc":"^39.2.9","eslint-plugin-n":"^15.7.0","eslint-plugin-prettier":"^4.2.1","eslint-plugin-promise":"^6.1.1","isomorphic-fetch":"^3.0.0",jest:"^29.7.0",nock:"^14.0.0-beta.7",prettier:"^2.8.8","prettier-plugin-packagejson":"^2.4.3",sinon:"^9.2.4","ts-jest":"^29.1.4",typescript:"~4.8.4"},peerDependencies:{"@metamask/network-controller":"^24.0.0","@metamask/transaction-controller":"^42.0.0"},peerDependenciesMeta:{"@metamask/accounts-controller":{optional:!0},"@metamask/approval-controller":{optional:!0}},packageManager:"yarn@3.2.1",engines:{node:"^18.18 || >=20"},publishConfig:{access:"public",registry:"https://registry.npmjs.org/"},lavamoat:{allowScripts:{"@lavamoat/preinstall-always-fail":!1,"@metamask/controller-utils>ethereumjs-util>ethereum-cryptography>keccak":!1,"@metamask/controller-utils>ethereumjs-util>ethereum-cryptography>secp256k1":!1,"@metamask/controller-utils>babel-runtime>core-js":!1,"@metamask/transaction-controller>@metamask/accounts-controller>@metamask/keyring-controller>ethereumjs-wallet>ethereum-cryptography>keccak":!1,"@metamask/transaction-controller>@metamask/accounts-controller>@metamask/keyring-controller>ethereumjs-wallet>ethereum-cryptography>secp256k1":!1}}}}}},{package:"@metamask/smart-transactions-controller",file:"node_modules/@metamask/smart-transactions-controller/package.json"}],[2007,{"../snaps/Timer.cjs":2029,"../snaps/constants.cjs":2030,"./utils.cjs":2009,"@metamask/base-controller":1238,"@metamask/snaps-rpc-methods":2075,"@metamask/snaps-utils":2245,"@metamask/utils":2361,immer:3883,luxon:4099,nanoid:4198},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){i(e,t),t.set(e,n)}function i(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t){return e.get(o(e,t))}function r(e,t,n){return e.set(o(e,t),n),n}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.CronjobController=n.DAILY_TIMEOUT=void 0;const c=e("@metamask/base-controller"),l=e("@metamask/snaps-rpc-methods"),u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),h=e("immer"),p=e("luxon"),m=e("nanoid"),f=e("./utils.cjs"),g=e("../snaps/constants.cjs"),y=e("../snaps/Timer.cjs");n.DAILY_TIMEOUT=(0,d.inMilliseconds)(24,d.Duration.Hour);const w="CronjobController";var S=new WeakMap,b=new WeakMap,v=new WeakMap,T=new WeakSet,k=new WeakMap,_=new WeakMap,E=new WeakMap,C=new WeakMap,P=new WeakMap;class A extends c.BaseController{constructor({messenger:e,state:t,stateManager:c}){var l,u;super({messenger:e,metadata:{events:{persist:!1,anonymous:!1}},name:w,state:{events:{},...t,...c.getInitialState()}}),i(l=this,u=T),u.add(l),s(this,S,void 0),s(this,b,void 0),s(this,v,new y.Timer(n.DAILY_TIMEOUT)),s(this,k,e=>{this.unregister(e.id),this.register(e.id)}),s(this,_,e=>{const t=this.get(e.id);o(T,this,D).call(this,t),this.register(e.id)}),s(this,E,e=>{this.unregister(e.id)}),s(this,C,e=>{this.unregister(e.id)}),s(this,P,e=>{this.unregister(e.id),this.register(e.id)}),r(S,this,new Map),r(b,this,c),this.messagingSystem.subscribe("SnapController:snapInstalled",a(k,this)),this.messagingSystem.subscribe("SnapController:snapUninstalled",a(E,this)),this.messagingSystem.subscribe("SnapController:snapEnabled",a(_,this)),this.messagingSystem.subscribe("SnapController:snapDisabled",a(C,this)),this.messagingSystem.subscribe("SnapController:snapUpdated",a(P,this)),this.messagingSystem.registerActionHandler(`${w}:init`,(...e)=>this.init(...e)),this.messagingSystem.registerActionHandler(`${w}:schedule`,(...e)=>this.schedule(...e)),this.messagingSystem.registerActionHandler(`${w}:cancel`,(...e)=>this.cancel(...e)),this.messagingSystem.registerActionHandler(`${w}:get`,(...e)=>this.get(...e))}init(){o(T,this,I).call(this),o(T,this,L).call(this),o(T,this,D).call(this)}schedule(e){return o(T,this,O).call(this,{...e,recurring:!1})}cancel(e,t){(0,d.assert)(this.state.events[t],`A background event with the id of "${t}" does not exist.`),(0,d.assert)(this.state.events[t].snapId===e,"Only the origin that scheduled this event can cancel it."),o(T,this,R).call(this,t)}get(e){return Object.values(this.state.events).filter(t=>t.snapId===e&&!t.recurring).map(e=>({...e,date:(0,u.toCensoredISO8601String)(e.date),scheduledAt:(0,u.toCensoredISO8601String)(e.scheduledAt)}))}register(e){const t=o(T,this,x).call(this,e);null==t||t.forEach(e=>o(T,this,O).call(this,e))}unregister(e){for(const[t,n]of Object.entries(this.state.events))n.snapId===e&&o(T,this,R).call(this,t)}destroy(){super.destroy(),this.messagingSystem.unsubscribe("SnapController:snapInstalled",a(k,this)),this.messagingSystem.unsubscribe("SnapController:snapUninstalled",a(E,this)),this.messagingSystem.unsubscribe("SnapController:snapEnabled",a(_,this)),this.messagingSystem.unsubscribe("SnapController:snapDisabled",a(C,this)),this.messagingSystem.unsubscribe("SnapController:snapUpdated",a(P,this)),a(S,this).forEach(e=>e.cancel()),a(S,this).clear(),"running"===a(v,this).status&&a(v,this).cancel()}}function I(){r(v,this,new y.Timer(n.DAILY_TIMEOUT)),a(v,this).start(()=>{o(T,this,D).call(this),o(T,this,I).call(this)})}function O(e){const t=e.id??(0,m.nanoid)(),n={...e,id:t,date:(0,f.getExecutionDate)(e.schedule),scheduledAt:(new Date).toISOString()},{nextState:s}=this.update(e=>{e.events[n.id]=(0,h.castDraft)(n)});return a(b,this).set(s),o(T,this,M).call(this,n),t}function M(e,t=!0){if(!t)return void o(T,this,j).call(this,e);const n=(0,f.getExecutionDate)(e.schedule),{nextState:s}=this.update(t=>{t.events[e.id].date=n});a(b,this).set(s),o(T,this,j).call(this,{...e,date:n})}function j(e){const t=p.DateTime.fromISO(e.date,{setZone:!0}).toMillis()-Date.now();if(t>n.DAILY_TIMEOUT)return;if(t<=0)return void o(T,this,N).call(this,e);const s=new y.Timer(t);s.start(()=>{o(T,this,N).call(this,e)}),a(S,this).set(e.id,s)}function N(e){if(this.messagingSystem.call("SnapController:handleRequest",{snapId:e.snapId,origin:g.METAMASK_ORIGIN,handler:u.HandlerType.OnCronjob,request:e.request}).catch(t=>{(0,u.logError)(`An error occurred while executing an event for Snap "${e.snapId}":`,t)}),a(S,this).delete(e.id),!e.recurring){const{nextState:t}=this.update(t=>{delete t.events[e.id]});return void a(b,this).set(t)}o(T,this,M).call(this,e)}function R(e){const t=a(S,this).get(e);null==t||t.cancel(),a(S,this).delete(e);const{nextState:n}=this.update(t=>{delete t.events[e]});a(b,this).set(n)}function x(e){const t=this.messagingSystem.call("PermissionController:getPermissions",e),n=null==t?void 0:t[l.SnapEndowments.Cronjob],s=(0,l.getCronjobCaveatJobs)(n);return s?s.map((t,n)=>({snapId:e,id:`cronjob-${e}-${n}`,request:t.request,schedule:(0,f.getCronjobSpecificationSchedule)(t),recurring:!0})):[]}function D(e=Object.values(this.state.events)){const t=Date.now();for(const n of e){if(a(S,this).has(n.id))continue;const e=p.DateTime.fromISO(n.date,{setZone:!0}).toUTC().toMillis();n.recurring&&e<=t?o(T,this,N).call(this,n):o(T,this,M).call(this,n,!1)}}function L(){const e=Date.now();for(const t of Object.values(this.state.events)){const n=p.DateTime.fromISO(t.date,{setZone:!0}).toUTC().toMillis();!t.recurring&&n<e&&o(T,this,R).call(this,t.id)}}n.CronjobController=A}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/cronjob/CronjobController.cjs"}],[2008,{"./CronjobController.cjs":2007},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},i=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),i(e("./CronjobController.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/cronjob/index.cjs"}],[2009,{"@metamask/utils":2361,"cron-parser":3424,luxon:4099},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getExecutionDate=n.getCronjobSpecificationSchedule=void 0;const s=e("@metamask/utils"),i=e("cron-parser"),a=e("luxon");n.getCronjobSpecificationSchedule=function(e){return(0,s.hasProperty)(e,"duration")?e.duration:e.expression},n.getExecutionDate=function(e){const t=a.DateTime.fromISO(e,{setZone:!0});if(t.isValid){const e=Date.now(),n=t.toUTC().startOf("second");if(n.toMillis()<e)throw new Error("Cannot schedule an event in the past.");return n.toISO({suppressMilliseconds:!0})}const n=a.Duration.fromISO(e);if(n.isValid){const e=function(e){return e.as("seconds")<1?a.Duration.fromObject({seconds:1}):e}(n);return a.DateTime.now().toUTC().plus(e).toISO()}try{const t=(0,i.parseExpression)(e,{utc:!0}).next(),n=a.DateTime.fromJSDate(t.toDate());return(0,s.assert)(n.isValid),n.toUTC().toISO()}catch{throw new Error(`Unable to parse "${e}" as ISO 8601 date, ISO 8601 duration, or cron expression.`)}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/cronjob/utils.cjs"}],[201,{"../../../../../shared/lib/four-byte":5055,"@ethersproject/abi":552,"@metamask/utils":2361,"ethereumjs-util":3575},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.decodeTransactionDataWithFourByte=async function(e){const t=e.slice(0,10),n=await(0,r.getMethodFrom4Byte)(t);if(!n)return undefined;const a=n.split("(")[0],d=function(e){let t=e.slice(e.indexOf("(")+1,-1);const n=[];for(;t.includes("(");){const e=u(t);if(!e)break;n.push(e.value),t=`${t.slice(0,e.start)}${n.length-1}#${t.slice(e.end+1)}`}return l(t,n)}(n);o("Generated inputs",d);const h=(0,s.addHexPrefix)(e.slice(10)),p=i.Interface.getAbiCoder().decode(d,h),m=d.map((e,t)=>c(e,t,p));return{name:a,params:m}};var s=e("ethereumjs-util"),i=e("@ethersproject/abi"),a=e("@metamask/utils"),r=e("../../../../../shared/lib/four-byte");const o=(0,a.createProjectLogger)("four-byte");function c(e,t,n){var s;const i=n[t],{type:a,name:r}=e;let o=null===(s=e.components)||void 0===s?void 0:s.map((e,t)=>c(e,t,i));if(a.endsWith("[]")){const t=a.slice(0,-2);o=i.map((n,s)=>{const a=`Item ${s+1}`;return c({...e,name:a,type:t},s,i)})}return{name:r,type:a,value:i,children:o}}function l(e,t){return e.split(",").map(e=>{const n=e.split("#"),s=n.length>1?parseInt(n[0],10):undefined;return{type:s===undefined?e:`tuple${n[1]??""}`,components:s===undefined?undefined:l(t[s],t)}})}function u(e){let t=-1;for(let n=0;n<e.length;n++)if("("===e[n])t=n;else if(")"===e[n]&&-1!==t)return{start:t,end:n,value:e.slice(t+1,n)};return undefined}}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/four-byte.ts"}],[2010,{"@metamask/utils":2361,"@xstate/fsm":2829},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.forceStrict=n.validateMachine=void 0;const s=e("@metamask/utils"),i=e("@xstate/fsm");n.validateMachine=function(e){(0,s.assert)("_options"in e,"The machine is not an @xstate/fsm machine");const t=e,n=new Set,i=e=>{return(t=e,Array.isArray(t)?t:t===undefined||null===t?[]:[t]).flatMap(e=>"string"==typeof e?[e]:((0,s.assert)("function"==typeof e),[])).forEach(n.add.bind(n));var t};for(const e of Object.values(t.config.states)){i(e.entry),i(e.exit);for(const t of Object.values(e.on??{}))i(t.actions)}n.forEach(e=>(0,s.assert)(t._options.actions!==undefined&&e in t._options.actions,`Action "${e}" doesn't have an implementation`))},n.forceStrict=function(e){let t=!1;e.subscribe(e=>{(0,s.assert)(!t||e.changed,"Invalid state transition"),t=!0});const n=e.send.bind(e);e.send=(...t)=>((0,s.assert)(e.status===i.InterpreterStatus.Running,"Interpreter is stopped"),n(...t))}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/fsm.cjs"}],[2011,{"./cronjob/index.cjs":2008,"./insights/index.cjs":2013,"./interface/index.cjs":2015,"./multichain/index.cjs":2019,"./services/index.cjs":2024,"./snaps/index.cjs":2031,"./utils.cjs":2041,"./websocket/index.cjs":2043},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},i=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),i(e("./services/index.cjs"),n),i(e("./snaps/index.cjs"),n),i(e("./utils.cjs"),n),i(e("./cronjob/index.cjs"),n),i(e("./interface/index.cjs"),n),i(e("./insights/index.cjs"),n),i(e("./multichain/index.cjs"),n),i(e("./websocket/index.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/index.cjs"}],[2012,{"../snaps/index.cjs":2031,"@metamask/base-controller":1238,"@metamask/snaps-rpc-methods":2075,"@metamask/snaps-utils":2245,"@metamask/utils":2361},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function i(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.SnapInsightsController=void 0;const a=e("@metamask/base-controller"),r=e("@metamask/snaps-rpc-methods"),o=e("@metamask/snaps-utils"),c=e("@metamask/utils"),l=e("../snaps/index.cjs");var u=new WeakSet;class d extends a.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:{insights:{persist:!1,anonymous:!1}},name:"SnapInsightsController",state:{insights:{},...t}}),s(this,u),this.messagingSystem.subscribe("TransactionController:unapprovedTransactionAdded",i(u,this,m).bind(this)),this.messagingSystem.subscribe("TransactionController:transactionStatusUpdated",i(u,this,y).bind(this)),this.messagingSystem.subscribe("SignatureController:stateChange",i(u,this,f).bind(this))}}function h(e){return(0,c.hasProperty)(this.state.insights,e)}function p(e){const t=this.messagingSystem.call("SnapController:getAll");return(0,l.getRunnableSnaps)(t).reduce((t,n)=>{const s=this.messagingSystem.call("PermissionController:getPermissions",n.id);return s&&(0,c.hasProperty)(s,e)&&t.push({snapId:n.id,permission:s[e]}),t},[])}function m(e){const{id:t,txParams:n,chainId:s,origin:a}=e,l=`eip155:${(0,c.hexToBigInt)(s).toString(10)}`;i(u,this,p).call(this,r.SnapEndowments.TransactionInsight).forEach(({snapId:e,permission:s})=>{const c=(0,r.getTransactionOriginCaveat)(s)&&a?a:null;this.update(n=>{var s;(s=n.insights)[t]??(s[t]={}),n.insights[t][e]={snapId:e,loading:!0}}),i(u,this,S).call(this,{snapId:e,handler:o.HandlerType.OnTransaction,params:{transaction:n,chainId:l,transactionOrigin:c}}).then(n=>i(u,this,b).call(this,{id:t,snapId:e,response:n})).catch(n=>i(u,this,b).call(this,{id:t,snapId:e,error:n}))})}function f(e){for(const t of Object.keys(this.state.insights))(0,c.hasProperty)(e.unapprovedTypedMessages,t)||(0,c.hasProperty)(e.unapprovedPersonalMsgs,t)||i(u,this,w).call(this,t);if(e.unapprovedPersonalMsgCount>0||e.unapprovedTypedMessagesCount>0){const t=i(u,this,p).call(this,r.SnapEndowments.SignatureInsight);for(const n of Object.values(e.unapprovedPersonalMsgs))i(u,this,g).call(this,t,n);for(const n of Object.values(e.unapprovedTypedMessages))i(u,this,g).call(this,t,n)}}function g(e,t){const{id:n,msgParams:s}=t;if(i(u,this,h).call(this,n))return;const{from:a,data:c,signatureMethod:l,origin:d}=s,p={from:a,data:"eth_signTypedData_v3"===l||"eth_signTypedData_v4"===l?JSON.parse(c):c,signatureMethod:l};e.forEach(({snapId:e,permission:t})=>{const s=(0,r.getSignatureOriginCaveat)(t),a=d&&s?d:null;this.update(t=>{var s;(s=t.insights)[n]??(s[n]={}),t.insights[n][e]={snapId:e,loading:!0}}),i(u,this,S).call(this,{snapId:e,handler:o.HandlerType.OnSignature,params:{signature:p,signatureOrigin:a}}).then(t=>i(u,this,b).call(this,{id:n,snapId:e,response:t})).catch(t=>i(u,this,b).call(this,{id:n,snapId:e,error:t}))})}function y({transactionMeta:e}){"unapproved"!==e.status&&i(u,this,w).call(this,e.id)}function w(e){i(u,this,h).call(this,e)&&(Object.values(this.state.insights[e]).filter(e=>e.interfaceId).forEach(e=>{this.messagingSystem.call("SnapInterfaceController:deleteInterface",e.interfaceId)}),this.update(t=>{delete t.insights[e]}))}async function S({snapId:e,handler:t,params:n}){return this.messagingSystem.call("SnapController:handleRequest",{snapId:e,origin:"metamask",handler:t,request:{method:"",params:n}})}function b({id:e,snapId:t,response:n,error:s}){i(u,this,h).call(this,e)&&this.update(i=>{i.insights[e][t].loading=!1,i.insights[e][t].interfaceId=null==n?void 0:n.id,i.insights[e][t].severity=null==n?void 0:n.severity,i.insights[e][t].error=null==s?void 0:s.message})}n.SnapInsightsController=d}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/insights/SnapInsightsController.cjs"}],[2013,{"./SnapInsightsController.cjs":2012},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},i=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),i(e("./SnapInsightsController.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/insights/index.cjs"}],[2014,{"./utils.cjs":2016,"@metamask/base-controller":1238,"@metamask/snaps-sdk":2131,"@metamask/snaps-utils":2245,"@metamask/utils":2361,immer:3883,nanoid:4198},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.add(e)}function i(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.SnapInterfaceController=void 0;const a=e("@metamask/base-controller"),r=e("@metamask/snaps-sdk"),o=e("@metamask/snaps-utils"),c=e("@metamask/utils"),l=e("immer"),u=e("nanoid"),d=e("./utils.cjs"),h=1e7,p="SnapInterfaceController";var m=new WeakSet;class f extends a.BaseController{constructor({messenger:e,state:t}){super({messenger:e,metadata:{interfaces:{persist:e=>Object.entries(e).reduce((e,[t,n])=>n.contentType===r.ContentType.Notification?(e[t]=n,e):e,{}),anonymous:!1}},name:p,state:{interfaces:{},...t}}),s(this,m),this.messagingSystem.subscribe("NotificationServicesController:notificationsListUpdated",i(m,this,A).bind(this)),i(m,this,g).call(this)}async createInterface(e,t,n,s){const a=(0,d.getJsxInterface)(t);await i(m,this,P).call(this,a),(0,d.validateInterfaceContext)(n);const r=(0,u.nanoid)(),c=(0,d.constructState)({},a,{getAssetsState:i(m,this,E).bind(this),getAccountByAddress:i(m,this,_).bind(this),getSelectedAccount:i(m,this,T).bind(this),listAccounts:i(m,this,k).bind(this),snapOwnsAccount:t=>(0,o.snapOwnsAccount)(e,t)});return this.update(t=>{t.interfaces[r]={snapId:e,content:(0,l.castDraft)(a),state:c,context:n??null,contentType:s??null}}),r}getInterface(e,t){return i(m,this,y).call(this,e,t),this.state.interfaces[t]}async updateInterface(e,t,n,s){i(m,this,y).call(this,e,t);const a=(0,d.getJsxInterface)(n);await i(m,this,P).call(this,a),(0,d.validateInterfaceContext)(s);const r=this.state.interfaces[t].state,c=(0,d.constructState)(r,a,{getAssetsState:i(m,this,E).bind(this),getAccountByAddress:i(m,this,_).bind(this),getSelectedAccount:i(m,this,T).bind(this),listAccounts:i(m,this,k).bind(this),snapOwnsAccount:t=>(0,o.snapOwnsAccount)(e,t)});this.update(e=>{e.interfaces[t].state=c,e.interfaces[t].content=(0,l.castDraft)(a),s&&(e.interfaces[t].context=s)})}deleteInterface(e){this.update(t=>{delete t.interfaces[e]})}updateInterfaceState(e,t){this.update(n=>{n.interfaces[e].state=t})}async resolveInterface(e,t,n){i(m,this,y).call(this,e,t),i(m,this,w).call(this,t),await i(m,this,v).call(this,t,n),this.deleteInterface(t)}}function g(){this.messagingSystem.registerActionHandler(`${p}:createInterface`,this.createInterface.bind(this)),this.messagingSystem.registerActionHandler(`${p}:getInterface`,this.getInterface.bind(this)),this.messagingSystem.registerActionHandler(`${p}:updateInterface`,this.updateInterface.bind(this)),this.messagingSystem.registerActionHandler(`${p}:deleteInterface`,this.deleteInterface.bind(this)),this.messagingSystem.registerActionHandler(`${p}:updateInterfaceState`,this.updateInterfaceState.bind(this)),this.messagingSystem.registerActionHandler(`${p}:resolveInterface`,this.resolveInterface.bind(this))}function y(e,t){const n=this.state.interfaces[t];(0,c.assert)(n!==undefined,`Interface with id '${t}' not found.`),(0,c.assert)(n.snapId===e,`Interface not created by ${e}.`)}function w(e){(0,c.assert)(i(m,this,b).call(this,e),`Approval request with id '${e}' not found.`)}function S(e){return this.messagingSystem.call("PhishingController:testOrigin",e).result}function b(e){return this.messagingSystem.call("ApprovalController:hasRequest",{id:e})}async function v(e,t){await this.messagingSystem.call("ApprovalController:acceptRequest",e,t)}function T(){return this.messagingSystem.call("AccountsController:getSelectedMultichainAccount")}function k(e){const t=this.messagingSystem.call("AccountsController:listMultichainAccounts");return e&&0!==e.length?t.filter(t=>t.scopes.some(t=>(0,d.isMatchingChainId)(t,e))):t}function _(e){const{address:t}=(0,c.parseCaipAccountId)(e);return this.messagingSystem.call("AccountsController:getAccountByAddress",t)}function E(){return this.messagingSystem.call("MultichainAssetsController:getState")}function C(e){return this.messagingSystem.call("SnapController:get",e)}async function P(e){const t=(0,o.getJsonSizeUnsafe)(e);(0,c.assert)(t<=h,"A Snap UI may not be larger than 10 MB."),(0,o.validateJsxElements)(e,{isOnPhishingList:i(m,this,S).bind(this),getSnap:i(m,this,C).bind(this),getAccountByAddress:i(m,this,_).bind(this)})}function A(e){const t=e.filter(e=>"snap"===e.type&&(0,c.hasProperty)(e.data,"detailedView")),n=new Set(t.map(e=>e.data.detailedView.interfaceId));this.update(e=>{Object.entries(e.interfaces).forEach(([t,s])=>{s.contentType!==r.ContentType.Notification||n.has(t)||delete e.interfaces[t]})})}n.SnapInterfaceController=f}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/interface/SnapInterfaceController.cjs"}],[2015,{"./SnapInterfaceController.cjs":2014},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},i=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),i(e("./SnapInterfaceController.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/interface/index.cjs"}],[2016,{"@metamask/snaps-sdk":2131,"@metamask/snaps-sdk/jsx":2215,"@metamask/snaps-utils":2245,"@metamask/utils":2361},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.validateInterfaceContext=n.constructState=n.getAccountSelectorStateValue=n.getAssetSelectorStateValue=n.getAccountSelectorDefaultStateValue=n.getDefaultAsset=n.formatAccountSelectorStateValue=n.isMatchingChainId=n.assertNameIsUnique=n.getJsxInterface=n.isStatefulComponent=void 0;const s=e("@metamask/snaps-sdk"),i=e("@metamask/snaps-sdk/jsx"),a=e("@metamask/snaps-utils"),r=e("@metamask/utils"),o=["Input","Dropdown","RadioGroup","FileInput","Checkbox","Selector","AssetSelector","AddressInput","AccountSelector"];function c(e){return o.includes(e.type)}function l(e,t){(0,s.assert)(e[t]===undefined,`Duplicate component names are not allowed, found multiple instances of: "${t}".`)}function u(e,t){return"eip155:0"===e?t.some(e=>{const{namespace:t}=(0,r.parseCaipChainId)(e);return t===r.KnownCaipNamespace.Eip155}):t.includes(e)}function d(e,t){const{id:n,address:s,scopes:i}=e,r=(0,a.createChainIdList)(i,t);return{accountId:n,addresses:(0,a.createAccountList)(s,r)}}function h(e,t,{getAccountByAddress:n,getAssetsState:i}){var a;const{assetsMetadata:o,accountsAssets:c}=i(),l=e.map(e=>(0,r.parseCaipAccountId)(e)).map(({chainId:e})=>e),u=t&&t.length>0?l.filter(e=>t.includes(e)):l,d=null===(a=n(e[0]))||void 0===a?void 0:a.id;(0,s.assert)(d,`Account not found for address: ${e[0]}.`);const h=c[d];if(0===h.length)return null;const p=h.find(e=>{const{chainId:t,assetNamespace:n}=(0,r.parseCaipAssetType)(e);return u.includes(t)&&"slip44"===n});return p?{asset:p,name:o[p].name,symbol:o[p].symbol}:{asset:h[0],name:o[h[0]].name,symbol:o[h[0]].symbol}}function p(e,{getSelectedAccount:t,listAccounts:n,snapOwnsAccount:s}){const{chainIds:i,hideExternalAccounts:a}=e.props,r=t();if((!i||0===i.length||r.scopes.some(e=>u(e,i)))&&(!a||a&&s(r)))return d(r,i);const o=n(i),c=a?o.filter(e=>s(e)):o;return 0===c.length?null:d(c[0],i)}function m(e,t){if(!e)return null;const{assetsMetadata:n}=t(),s=n[e];return s?{asset:e,name:s.name??s.symbol??"Unknown",symbol:s.symbol??"Unknown"}:null}function f(e,{getAccountByAddress:t,snapOwnsAccount:n}){const{value:s,hideExternalAccounts:i}=e.props;if(!s)return null;const a=t(s);return a?i&&!n(a)?null:d(a,e.props.chainIds):null}function g(e,t,n,s){const i=s?e[s]:e,o=null==i?void 0:i[t.props.name];return"FileInput"===t.type?o??null:function(e,t){switch(e.type){case"Checkbox":return e.props.checked;case"AssetSelector":return m(e.props.value,t.getAssetsState);case"AddressInput":{if(!e.props.value)return null;const{namespace:t,reference:n}=(0,r.parseCaipChainId)(e.props.chainId);return(0,r.toCaipAccountId)(t,n,e.props.value)}case"AccountSelector":return f(e,t);default:return e.props.value}}(t,n)??o??function(e,t){switch(e.type){case"Dropdown":var n;return null===(n=(0,a.getJsxChildren)(e)[0])||void 0===n?void 0:n.props.value;case"RadioGroup":var s;return null===(s=(0,a.getJsxChildren)(e)[0])||void 0===s?void 0:s.props.value;case"Selector":var i;return null===(i=(0,a.getJsxChildren)(e)[0])||void 0===i?void 0:i.props.value;case"AccountSelector":return p(e,t);case"Checkbox":return!1;case"AssetSelector":return h(e.props.addresses,e.props.chainIds,t);default:return null}}(t,n)??null}n.isStatefulComponent=c,n.getJsxInterface=function(e){return(0,i.isJSXElementUnsafe)(e)?e:(0,a.getJsxElementFromComponent)(e)},n.assertNameIsUnique=l,n.isMatchingChainId=u,n.formatAccountSelectorStateValue=d,n.getDefaultAsset=h,n.getAccountSelectorDefaultStateValue=p,n.getAssetSelectorStateValue=m,n.getAccountSelectorStateValue=f,n.constructState=function(e,t,n){const s={},i=[];return(0,a.walkJsx)(t,(t,a)=>{let r=i[i.length-1];if(r&&a<=r.depth&&(i.pop(),r=i[i.length-1]),"Form"===t.type)return l(s,t.props.name),i.push({name:t.props.name,depth:a}),void(s[t.props.name]={});if(r&&c(t)){const i=s[r.name];return l(i,t.props.name),void(i[t.props.name]=g(e,t,n,r.name))}c(t)&&(l(s,t.props.name),s[t.props.name]=g(e,t,n))}),s};const y=5e6;n.validateInterfaceContext=function(e){if(!e)return;const t=(0,a.getJsonSizeUnsafe)(e);(0,s.assert)(t<=y,"A Snap interface context may not be larger than 5 MB.")}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/interface/utils.cjs"}],[2017,{"@metamask/snaps-utils":2245,"@metamask/utils":2361},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.log=void 0;const s=e("@metamask/snaps-utils"),i=e("@metamask/utils");n.log=(0,i.createModuleLogger)(s.snapsLogger,"snaps-controllers")}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/logging.cjs"}],[2018,{"../snaps/index.cjs":2031,"@metamask/rpc-errors":1958,"@metamask/snaps-rpc-methods":2075,"@metamask/snaps-utils":2245,"@metamask/utils":2361,nanoid:4198},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){i(e,t),t.set(e,n)}function i(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){return e.get(c(e,t))}function o(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.MultichainRouter=void 0;const l=e("@metamask/rpc-errors"),u=e("@metamask/snaps-rpc-methods"),d=e("@metamask/snaps-utils"),h=e("@metamask/utils"),p=e("nanoid"),m=e("../snaps/index.cjs"),f="MultichainRouter";var g=new WeakMap,y=new WeakMap,w=new WeakSet;async function S(e,t,n){try{const s=await r(y,this).call(this,async({keyring:s})=>s.resolveAccountAddress(e,t,n)),i=null==s?void 0:s.address;return i?(0,h.parseCaipAccountId)(i).address:null}catch{throw l.rpcErrors.internal()}}async function b(e,t,n){const s=r(g,this).call("AccountsController:listMultichainAccounts",t).filter(e=>{var t;return Boolean(null===(t=e.metadata.snap)||void 0===t?void 0:t.enabled)&&e.methods.includes(n.method)});if(0===s.length)return null;const i=s[0].metadata.snap.id,a=await c(w,this,S).call(this,i,t,n),o=e.map(e=>(0,h.parseCaipAccountId)(e).address),u=s.find(e=>o.includes(e.address)&&(!a||e.address===a));if(!u)throw l.rpcErrors.invalidParams({message:"No available account found for request."});return u.id}function v(e){const t=r(g,this).call("SnapController:getAll");return(0,m.getRunnableSnaps)(t).reduce((t,n)=>{const s=r(g,this).call("PermissionController:getPermissions",n.id);if(s&&(0,h.hasProperty)(s,u.SnapEndowments.Protocol)){const i=s[u.SnapEndowments.Protocol],a=(0,u.getProtocolCaveatScopes)(i);a&&(0,h.hasProperty)(a,e)&&t.push({snapId:n.id,methods:a[e].methods})}return t},[])}function T(e){return r(g,this).call("AccountsController:listMultichainAccounts",e).filter(e=>{var t;return null===(t=e.metadata.snap)||void 0===t?void 0:t.enabled})}n.MultichainRouter=class{constructor({messenger:e,withSnapKeyring:t}){var n,c;i(n=this,c=w),c.add(n),a(this,"name",f),a(this,"state",null),s(this,g,void 0),s(this,y,void 0),o(g,this,e),o(y,this,t),r(g,this).registerActionHandler(`${f}:handleRequest`,async(...e)=>this.handleRequest(...e)),r(g,this).registerActionHandler(`${f}:getSupportedMethods`,(...e)=>this.getSupportedMethods(...e)),r(g,this).registerActionHandler(`${f}:getSupportedAccounts`,(...e)=>this.getSupportedAccounts(...e)),r(g,this).registerActionHandler(`${f}:isSupportedScope`,(...e)=>this.isSupportedScope(...e))}async handleRequest({connectedAddresses:e,origin:t,scope:n,request:s}){(0,h.assert)(!n.startsWith(h.KnownCaipNamespace.Eip155)&&!n.startsWith("wallet:eip155"));const i={jsonrpc:"2.0",id:s.id??(0,p.nanoid)(),method:s.method,...s.params?{params:s.params}:{}},{method:a,params:o}=i,u=await c(w,this,b).call(this,e,n,i);if(u)return r(y,this).call(this,async({keyring:e})=>e.submitRequest({origin:t,account:u,scope:n,method:a,params:o}));const m=c(w,this,v).call(this,n).find(e=>e.methods.includes(a));if(m)return r(g,this).call("SnapController:handleRequest",{snapId:m.snapId,origin:t,request:{method:"",params:{request:i,scope:n}},handler:d.HandlerType.OnProtocolRequest});throw l.rpcErrors.methodNotFound()}getSupportedMethods(e){const t=c(w,this,T).call(this,e).flatMap(e=>e.methods),n=c(w,this,v).call(this,e).flatMap(e=>e.methods);return Array.from(new Set([...t,...n]))}getSupportedAccounts(e){return c(w,this,T).call(this,e).map(t=>`${e}:${t.address}`)}isSupportedScope(e){return r(g,this).call("AccountsController:listMultichainAccounts",e).some(e=>{var t;return null===(t=e.metadata.snap)||void 0===t?void 0:t.enabled})||c(w,this,v).call(this,e).length>0}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/multichain/MultichainRouter.cjs"}],[2019,{"./MultichainRouter.cjs":2018},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},i=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),i(e("./MultichainRouter.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/multichain/index.cjs"}],[202,{"ethereumjs-util":3575},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getContractProxyAddress=async function(e,t){const n=(await Promise.all(i.map(n=>t.request({method:"eth_getStorageAt",params:[e,n,"latest"]})))).find(e=>(0,s.stripHexPrefix)(e)!==a);return n&&(0,s.addHexPrefix)(n.slice(26))};var s=e("ethereumjs-util");const i=["0x7050c9e0f4ca769c69bd3a8ef740bc37934f8e2c036e5a723fd8ee048ed3f8c3","0x360894a13ba1a3210667c828492db98dca3e2076cc3735a920a3ca505d382bbc"],a="0".padEnd(64,"0")}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/proxy.ts"}],[2020,{"../logging.cjs":2017,"../snaps/Timer.cjs":2029,"../utils.cjs":2041,"@metamask/json-rpc-engine":1508,"@metamask/json-rpc-middleware-stream":1512,"@metamask/object-multiplex":1807,"@metamask/rpc-errors":1958,"@metamask/snaps-utils":2245,"@metamask/utils":2361,nanoid:4198,"readable-stream":4454},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){i(e,t),t.set(e,n)}function i(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){return e.get(c(e,t))}function o(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var l=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.setupMultiplex=n.AbstractExecutionService=void 0;const u=e("@metamask/json-rpc-engine"),d=e("@metamask/json-rpc-middleware-stream"),h=l(e("@metamask/object-multiplex")),p=e("@metamask/rpc-errors"),m=e("@metamask/snaps-utils"),f=e("@metamask/utils"),g=e("nanoid"),y=e("readable-stream"),w=e("../logging.cjs"),S=e("../snaps/Timer.cjs"),b=e("../utils.cjs"),v="ExecutionService";var T=new WeakMap,k=new WeakMap,_=new WeakMap,E=new WeakMap,C=new WeakMap,P=new WeakMap,A=new WeakMap,I=new WeakMap,O=new WeakSet;function M(){r(E,this).registerActionHandler(`${v}:handleRpcRequest`,async(e,t)=>this.handleRpcRequest(e,t)),r(E,this).registerActionHandler(`${v}:executeSnap`,async e=>this.executeSnap(e)),r(E,this).registerActionHandler(`${v}:terminateSnap`,async e=>this.terminateSnap(e)),r(E,this).registerActionHandler(`${v}:terminateAllSnaps`,async()=>this.terminateAllSnaps())}async function j(e,t){const{streams:n,worker:s}=await c(O,this,N).call(this,e,t),i=new u.JsonRpcEngine,a=(0,d.createStreamMiddleware)();(0,y.pipeline)(a.stream,n.command,a.stream,e=>{var t;!e||null!==(t=e.message)&&void 0!==t&&t.match("Premature close")||(0,m.logError)("Command stream failure.",e)}),i.push(a.middleware);const o={id:e,streams:n,rpcEngine:i,worker:s};return r(T,this).set(e,o),o}async function N(e,t){const n=await(0,b.withTimeout)(this.initEnvStream(e),t);if(n===b.hasTimedOut){this.terminateJob({id:e});if("created"===r(k,this).get(e))throw new Error(`The executor for "${e}" couldn't start initialization. The offscreen document may not exist.`);throw new Error(`The executor for "${e}" failed to initialize. The iframe/webview/worker failed to load.`)}const{worker:s,stream:i}=n,a=x(i,`Snap: "${e}"`),o=a.createStream(m.SNAP_STREAM_NAMES.COMMAND),c=t=>{(0,f.hasProperty)(t,"id")||("OutboundRequest"===t.method?r(E,this).publish("ExecutionService:outboundRequest",e):"OutboundResponse"===t.method?r(E,this).publish("ExecutionService:outboundResponse",e):"UnhandledError"===t.method?(r(E,this).publish("ExecutionService:unhandledError",e,t.params.error),o.removeListener("data",c)):(0,m.logError)(new Error(`Received unexpected command stream notification "${t.method}".`)))};o.on("data",c);const l=a.createStream(m.SNAP_STREAM_NAMES.JSON_RPC);return{streams:{command:o,rpc:l,_connection:i},worker:s}}async function R(e,t){const n=r(T,this).get(e);if(!n)throw new Error(`"${e}" is not currently running.`);(0,w.log)("Parent: Sending Command",t);const s=await n.rpcEngine.handle(t);if((0,f.isJsonRpcFailure)(s))throw new p.JsonRpcError(s.error.code,s.error.message,s.error.data);return s.result}function x(e,t){const n=new h.default;return(0,y.pipeline)(e,n,e,e=>{var n;!e||null!==(n=e.message)&&void 0!==n&&n.match("Premature close")||(0,m.logError)(`"${t}" stream failure.`,e)}),n}n.AbstractExecutionService=class{constructor({setupSnapProvider:e,messenger:t,initTimeout:n=(0,f.inMilliseconds)(60,f.Duration.Second),pingTimeout:r=(0,f.inMilliseconds)(2,f.Duration.Second),terminationTimeout:l=(0,f.inMilliseconds)(1,f.Duration.Second),usePing:u=!0}){var d,h;i(d=this,h=O),h.add(d),a(this,"name",v),a(this,"state",null),s(this,T,void 0),s(this,k,void 0),s(this,_,void 0),s(this,E,void 0),s(this,C,void 0),s(this,P,void 0),s(this,A,void 0),s(this,I,void 0),o(T,this,new Map),o(k,this,new Map),o(_,this,e),o(E,this,t),o(C,this,n),o(P,this,r),o(A,this,l),o(I,this,u),c(O,this,M).call(this)}async terminateSnap(e){const t=r(T,this).get(e);if(t){try{const t=await(0,b.withTimeout)(c(O,this,R).call(this,e,{jsonrpc:"2.0",method:"terminate",params:[],id:(0,g.nanoid)()}),r(A,this));t!==b.hasTimedOut&&"OK"===t||(0,m.logError)(`Snap "${e}" failed to terminate gracefully.`,t)}catch{}Object.values(t.streams).forEach(e=>{try{e.destroyed||e.destroy()}catch(e){(0,m.logError)("Error while destroying stream",e)}}),this.terminateJob(t),r(T,this).delete(e),r(k,this).delete(e),(0,w.log)(`Snap "${e}" terminated.`)}}setSnapStatus(e,t){r(k,this).set(e,t)}async terminateAllSnaps(){await Promise.all([...r(T,this).keys()].map(async e=>this.terminateSnap(e)))}async executeSnap({snapId:e,sourceCode:t,endowments:n}){if(r(T,this).has(e))throw new Error(`"${e}" is already running.`);this.setSnapStatus(e,"created");const s=new S.Timer(r(C,this)),i=await c(O,this,j).call(this,e,s);if(r(I,this)){if(await(0,b.withTimeout)(c(O,this,R).call(this,i.id,{jsonrpc:"2.0",method:"ping",id:(0,g.nanoid)()}),r(P,this))===b.hasTimedOut)throw new Error(`The executor for "${e}" was unreachable. The executor did not respond in time.`)}const a=i.streams.rpc;r(_,this).call(this,e,a);const o=Math.max(s.remaining,r(C,this)/2);this.setSnapStatus(e,"initialized");const l={jsonrpc:"2.0",method:"executeSnap",params:{snapId:e,sourceCode:t,endowments:n},id:(0,g.nanoid)()};(0,f.assertIsJsonRpcRequest)(l),this.setSnapStatus(e,"executing");const u=await(0,b.withTimeout)(c(O,this,R).call(this,i.id,l),o);if(u===b.hasTimedOut)throw new Error(`${e} failed to start.`);return"OK"===u&&this.setSnapStatus(e,"running"),u}async handleRpcRequest(e,t){const{handler:n,request:s,origin:i}=t;return await c(O,this,R).call(this,e,{id:(0,g.nanoid)(),jsonrpc:"2.0",method:"snapRpc",params:{origin:i,handler:n,request:s,target:e}})}},n.setupMultiplex=x}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/AbstractExecutionService.cjs"}],[2021,{"@metamask/post-message-stream":1840},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){i(e,t),t.set(e,n)}function i(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t){return e.get(o(e,t))}function r(e,t,n){return e.set(o(e,t),n),n}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.ProxyPostMessageStream=void 0;const c=e("@metamask/post-message-stream");var l=new WeakMap,u=new WeakMap,d=new WeakSet;class h extends c.BasePostMessageStream{constructor({stream:e,jobId:t}){var n,c;super(),i(n=this,c=d),c.add(n),s(this,l,void 0),s(this,u,void 0),r(l,this,e),r(u,this,t),a(l,this).on("data",o(d,this,p).bind(this))}_postMessage(e){a(l,this).write({jobId:a(u,this),data:e})}}function p(e){e.jobId===a(u,this)&&this.push(e.data)}n.ProxyPostMessageStream=h}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/ProxyPostMessageStream.cjs"}],[2022,{"../AbstractExecutionService.cjs":2020,"@metamask/post-message-stream":1840,"@metamask/snaps-utils":2245},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.IframeExecutionService=void 0;const i=e("@metamask/post-message-stream"),a=e("@metamask/snaps-utils"),r=e("../AbstractExecutionService.cjs");class o extends r.AbstractExecutionService{constructor({iframeUrl:e,messenger:t,setupSnapProvider:n,...i}){super({...i,messenger:t,setupSnapProvider:n}),s(this,"iframeUrl",void 0),this.iframeUrl=e}terminateJob(e){var t;null===(t=document.getElementById(e.id))||void 0===t||t.remove()}async initEnvStream(e){this.setSnapStatus(e,"initializing");const t=await(0,a.createWindow)({uri:this.iframeUrl.toString(),id:e});return{worker:t,stream:new i.WindowPostMessageStream({name:"parent",target:"child",targetWindow:t,targetOrigin:"*"})}}}n.IframeExecutionService=o}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/iframe/IframeExecutionService.cjs"}],[2023,{"./IframeExecutionService.cjs":2022},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},i=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),i(e("./IframeExecutionService.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/iframe/index.cjs"}],[2024,{"./AbstractExecutionService.cjs":2020,"./ProxyPostMessageStream.cjs":2021,"./iframe/index.cjs":2023,"./offscreen/index.cjs":2026},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},i=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),i(e("./AbstractExecutionService.cjs"),n),i(e("./ProxyPostMessageStream.cjs"),n),i(e("./iframe/index.cjs"),n),i(e("./offscreen/index.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/index.cjs"}],[2025,{"../proxy/ProxyExecutionService.cjs":2027,"@metamask/post-message-stream":1840},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function i(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.OffscreenExecutionService=void 0;const a=e("@metamask/post-message-stream"),r=e("../proxy/ProxyExecutionService.cjs");var o=new WeakMap;class c extends r.ProxyExecutionService{constructor({messenger:e,setupSnapProvider:t,offscreenPromise:n,...r}){var c,l,u;super({...r,messenger:e,setupSnapProvider:t,stream:new a.BrowserRuntimePostMessageStream({name:"parent",target:"child"})}),s(this,o,void 0),l=this,u=n,(c=o).set(i(c,l),u)}async initEnvStream(e){var t,n;return await(t=o,n=this,t.get(i(t,n))),await super.initEnvStream(e)}}n.OffscreenExecutionService=c}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/offscreen/OffscreenExecutionService.cjs"}],[2026,{"./OffscreenExecutionService.cjs":2025},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},i=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),i(e("./OffscreenExecutionService.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/offscreen/index.cjs"}],[2027,{"../AbstractExecutionService.cjs":2020,"../ProxyPostMessageStream.cjs":2021,nanoid:4198},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function i(e,t){return e.get(a(e,t))}function a(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.ProxyExecutionService=void 0;const r=e("nanoid"),o=e("../AbstractExecutionService.cjs"),c=e("../ProxyPostMessageStream.cjs");var l=new WeakMap;class u extends o.AbstractExecutionService{constructor({stream:e,messenger:t,setupSnapProvider:n,...i}){var r,o,c;super({...i,messenger:t,setupSnapProvider:n,usePing:!1}),s(this,l,void 0),o=this,c=e,(r=l).set(a(r,o),c)}async terminateJob(e){i(l,this).write({jobId:e.id,data:{jsonrpc:"2.0",method:"terminateJob",id:(0,r.nanoid)()}})}async initEnvStream(e){this.setSnapStatus(e,"initializing");const t=new c.ProxyPostMessageStream({stream:i(l,this),jobId:e});return await new Promise(e=>{t.once("data",e),t.write({name:"command",data:{jsonrpc:"2.0",method:"ping",id:(0,r.nanoid)()}})}),{worker:e,stream:t}}}n.ProxyExecutionService=u}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/services/proxy/ProxyExecutionService.cjs"}],[2028,{"../fsm.cjs":2010,"../logging.cjs":2017,"../utils.cjs":2041,"./Timer.cjs":2029,"./constants.cjs":2030,"./location/index.cjs":2033,"./registry/index.cjs":2037,"./selectors.cjs":2040,"@metamask/base-controller":1238,"@metamask/permission-controller":1819,"@metamask/rpc-errors":1958,"@metamask/snaps-rpc-methods":2075,"@metamask/snaps-sdk":2131,"@metamask/snaps-utils":2245,"@metamask/utils":2361,"@xstate/fsm":2829,"async-mutex":3144,nanoid:4198,semver:4804},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t,n){a(e,t),t.set(e,n)}function a(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function r(e,t){return e.get(c(e,t))}function o(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.SnapController=n.SNAP_APPROVAL_RESULT=n.SNAP_APPROVAL_UPDATE=n.SNAP_APPROVAL_INSTALL=n.controllerName=void 0;const l=e("@metamask/base-controller"),u=e("@metamask/permission-controller"),d=e("@metamask/rpc-errors"),h=e("@metamask/snaps-rpc-methods"),p=e("@metamask/snaps-sdk"),m=e("@metamask/snaps-utils"),f=e("@metamask/utils"),g=e("@xstate/fsm"),y=e("async-mutex"),w=e("nanoid"),S=e("semver"),b=e("./constants.cjs"),v=e("./location/index.cjs"),T=e("./registry/index.cjs"),k=e("./selectors.cjs"),_=e("./Timer.cjs"),E=e("../fsm.cjs"),C=e("../logging.cjs"),P=e("../utils.cjs");n.controllerName="SnapController",n.SNAP_APPROVAL_INSTALL="wallet_installSnap",n.SNAP_APPROVAL_UPDATE="wallet_updateSnap",n.SNAP_APPROVAL_RESULT="wallet_installSnapResult";const A=new Set(["initialPermissions","id","version","enabled","blocked"]),I={snaps:{},snapStates:{},unencryptedSnapStates:{}};function O(e){return Object.keys(e).reduce((t,n)=>(A.has(n)&&(t[n]=e[n]),t),{})}var M=new WeakMap,j=new WeakMap,N=new WeakMap,R=new WeakMap,x=new WeakMap,D=new WeakMap,L=new WeakMap,F=new WeakMap,H=new WeakMap,B=new WeakMap,U=new WeakMap,$=new WeakMap,W=new WeakMap,q=new WeakMap,K=new WeakMap,G=new WeakMap,V=new WeakMap,z=new WeakMap,Y=new WeakMap,J=new WeakMap,X=new WeakSet,Z=new WeakMap;class Q extends l.BaseController{constructor({closeAllConnections:e,messenger:t,state:l,dynamicPermissions:u=["eth_accounts"],environmentEndowmentPermissions:d=[],excludedPermissions:h={},idleTimeCheckInterval:g=(0,f.inMilliseconds)(5,f.Duration.Second),maxIdleTime:y=(0,f.inMilliseconds)(30,f.Duration.Second),maxRequestTime:w=(0,f.inMilliseconds)(60,f.Duration.Second),fetchFunction:S=globalThis.fetch.bind(undefined),featureFlags:T={},detectSnapLocation:k=v.detectSnapLocation,preinstalledSnaps:_=null,encryptor:E,getMnemonicSeed:C,getFeatureFlags:A=()=>({}),clientCryptography:O,trackEvent:Q}){var ie,ae,re;super({messenger:t,metadata:{snapStates:{persist:!0,anonymous:!1},unencryptedSnapStates:{persist:!0,anonymous:!1},snaps:{persist:e=>Object.values(e).filter(e=>e.status!==m.SnapStatus.Installing).map(e=>({...e,status:m.SnapStatus.Stopped})).reduce((e,t)=>(e[t.id]=t,e),{}),anonymous:!1}},name:n.controllerName,state:{...I,...l}}),a(ae=this,re=X),re.add(ae),i(this,M,void 0),i(this,j,void 0),i(this,N,void 0),i(this,R,void 0),i(this,x,void 0),i(this,D,void 0),i(this,L,void 0),i(this,F,void 0),s(this,"maxRequestTime",void 0),i(this,H,void 0),i(this,B,void 0),i(this,U,void 0),i(this,$,void 0),i(this,W,void 0),i(this,q,void 0),i(this,K,void 0),i(this,G,void 0),i(this,V,void 0),i(this,z,void 0),i(this,Y,void 0),i(this,J,void 0),i(this,Z,(0,P.debouncePersistState)((e,t,n)=>{c(X,this,Ge).call(this,e).stateMutex.runExclusive(async()=>{const s=await c(X,this,ge).call(this,e,t,n);return n?this.update(t=>{t.snapStates[e]=s}):this.update(t=>{t.unencryptedSnapStates[e]=s})}).catch(m.logError)},b.STATE_DEBOUNCE_TIMEOUT)),o(M,this,e),o(j,this,u),o(N,this,d),o(R,this,h),o(x,this,T),o(D,this,S),o(L,this,g),o(F,this,y),this.maxRequestTime=w,o(W,this,k),o(H,this,E),o(B,this,C),o(U,this,A),o($,this,O),o(z,this,_),this._onUnhandledSnapError=this._onUnhandledSnapError.bind(this),this._onOutboundRequest=this._onOutboundRequest.bind(this),this._onOutboundResponse=this._onOutboundResponse.bind(this),o(K,this,new Map),o(q,this,new Map),o(Y,this,Q),c(X,this,se).call(this),this.messagingSystem.subscribe("ExecutionService:unhandledError",this._onUnhandledSnapError),this.messagingSystem.subscribe("ExecutionService:outboundRequest",this._onOutboundRequest),this.messagingSystem.subscribe("ExecutionService:outboundResponse",this._onOutboundResponse),this.messagingSystem.subscribe("SnapController:snapInstalled",({id:e},t)=>{c(X,this,tt).call(this,t,e,m.HandlerType.OnInstall).catch(t=>{(0,m.logError)(`Error when calling \`onInstall\` lifecycle hook for snap "${e}": ${(0,p.getErrorMessage)(t)}`)})}),this.messagingSystem.subscribe("SnapController:snapUpdated",({id:e},t,n)=>{c(X,this,tt).call(this,n,e,m.HandlerType.OnUpdate).catch(t=>{(0,m.logError)(`Error when calling \`onUpdate\` lifecycle hook for snap "${e}": ${(0,p.getErrorMessage)(t)}`)})}),this.messagingSystem.subscribe("KeyringController:lock",c(X,this,nt).bind(this)),c(X,this,ee).call(this),c(X,this,te).call(this),Object.values((null===(ie=this.state)||void 0===ie?void 0:ie.snaps)??{}).forEach(e=>c(X,this,Ve).call(this,e.id)),r(z,this)&&c(X,this,ne).call(this,r(z,this)),o(J,this,(0,P.throttleTracking)((e,t,n,s)=>{const i=this.messagingSystem.call("SnapsRegistry:getMetadata",e);r(Y,this).call(this,{event:"Snap Export Used",category:"Snaps",properties:{snap_id:e,export:t,snap_category:null==i?void 0:i.category,success:n,origin:s}})}))}init(){c(X,this,et).call(this,b.METAMASK_ORIGIN,m.HandlerType.OnStart)}async updateBlockedSnaps(){c(X,this,ce).call(this),await this.messagingSystem.call("SnapsRegistry:update");const e=await this.messagingSystem.call("SnapsRegistry:get",Object.values(this.state.snaps).reduce((e,t)=>(e[t.id]={version:t.version,checksum:t.manifest.source.shasum},e),{}));await Promise.all(Object.entries(e).map(async([e,{status:t,reason:n}])=>t===T.SnapsRegistryStatus.Blocked?c(X,this,ie).call(this,e,n):c(X,this,ae).call(this,e)))}_onUnhandledSnapError(e,t){(0,m.logError)(`Unhandled error from "${e}":`,t),this.stopSnap(e,m.SnapStatusEvents.Crash).catch(e=>{(0,m.logError)(e)})}_onOutboundRequest(e){const t=c(X,this,Ge).call(this,e);t.pendingInboundRequests.filter(e=>"running"===e.timer.status).forEach(e=>e.timer.pause()),t.pendingOutboundRequests+=1}_onOutboundResponse(e){const t=c(X,this,Ge).call(this,e);t.pendingOutboundRequests-=1,0===t.pendingOutboundRequests&&t.pendingInboundRequests.filter(e=>"paused"===e.timer.status).forEach(e=>e.timer.resume())}async startSnap(e){c(X,this,ce).call(this);const t=this.state.snaps[e];if(!t.enabled)throw new Error(`Snap "${e}" is disabled.`);await c(X,this,Ee).call(this,{snapId:e,sourceCode:t.sourceCode})}enableSnap(e){if(this.getExpect(e),this.state.snaps[e].blocked)throw new Error(`Snap "${e}" is blocked and cannot be enabled.`);this.update(t=>{t.snaps[e].enabled=!0}),this.messagingSystem.publish("SnapController:snapEnabled",this.getTruncatedExpect(e))}async disableSnap(e){if(!this.has(e))throw new Error(`Snap "${e}" not found.`);this.update(t=>{t.snaps[e].enabled=!1}),this.isRunning(e)&&await this.stopSnap(e,m.SnapStatusEvents.Stop),this.messagingSystem.publish("SnapController:snapDisabled",this.getTruncatedExpect(e))}async stopSnap(e,t=m.SnapStatusEvents.Stop){const n=c(X,this,Ke).call(this,e);if(!n)throw new Error(`The snap "${e}" is not running.`);if(n.stopPromise)return void await n.stopPromise;const{promise:s,resolve:i}=(0,f.createDeferredPromise)();n.stopPromise=s;try{var a;if(this.isRunning(e))null===(a=r(M,this))||void 0===a||a.call(this,e),await c(X,this,de).call(this,e)}finally{n.lastRequest=null,n.pendingInboundRequests=[],n.pendingOutboundRequests=0,n.stopPromise=null,this.isRunning(e)&&c(X,this,ue).call(this,e,t),i()}}async stopAllSnaps(e=m.SnapStatusEvents.Stop){const t=Object.values(this.state.snaps).filter(e=>this.isRunning(e.id)).map(async t=>this.stopSnap(t.id,e));await Promise.allSettled(t)}isRunning(e){return"running"===this.getExpect(e).status}has(e){return Boolean(this.get(e))}get(e){return this.state.snaps[e]}getExpect(e){const t=this.get(e);return(0,f.assert)(t!==undefined,new Error(`Snap "${e}" not found.`)),t}getTruncated(e){const t=this.get(e);return t?O(t):null}getTruncatedExpect(e){return O(this.getExpect(e))}async updateSnapState(e,t,n){const s=c(X,this,Ge).call(this,e);n?s.state=t:s.unencryptedState=t,r(Z,this).call(this,e,t,n)}clearSnapState(e,t){const n=c(X,this,Ge).call(this,e);t?n.state=null:n.unencryptedState=null,r(Z,this).call(this,e,null,t)}async getSnapState(e,t){const n=c(X,this,Ge).call(this,e);return await n.getStateMutex.runExclusive(async()=>{const s=t?n.state:n.unencryptedState;if(s!==undefined)return s;const i=t?this.state.snapStates[e]:this.state.unencryptedSnapStates[e];if(null===i||i===undefined)return null;if(!t){const e=JSON.parse(i);return n.unencryptedState=e,e}const a=await c(X,this,me).call(this,e,i);return n.state=a,a})}async getSnapFile(e,t,n=p.AuxiliaryFileEncoding.Base64){var s;const i=this.getExpect(e),a=(0,m.normalizeRelative)(t),r=null===(s=i.auxiliaryFiles)||void 0===s||null===(s=s.find(e=>e.path===a))||void 0===s?void 0:s.value;if(!r)return null;const o=await(0,m.encodeAuxiliaryFile)(r,n);return(0,f.assert)(o.length<m.MAX_FILE_SIZE,`Failed to encode static file to "${n}": Static files must be less than 64 MB when encoded.`),o}isMinimumPlatformVersion(e,t){const n=this.getExpect(e),{platformVersion:s}=n.manifest;return!!s&&(0,S.gte)(s,t)}async clearState(){const e=Object.keys(this.state.snaps);await this.stopAllSnaps(),e.forEach(e=>c(X,this,be).call(this,e)),this.update(e=>{e.snaps={},e.snapStates={},e.unencryptedSnapStates={}}),r(q,this).clear(),r(K,this).clear(),r(z,this)&&c(X,this,ne).call(this,r(z,this))}async removeSnap(e){return this.removeSnaps([e])}async removeSnaps(e){if(!Array.isArray(e))throw new Error("Expected array of snap ids.");e.forEach(e=>{const t=this.getExpect(e);(0,f.assert)(!1!==t.removable,`${e} is not removable.`)}),await Promise.all(e.map(async e=>{const t=this.getExpect(e),n=this.getTruncatedExpect(e);await this.disableSnap(e),c(X,this,be).call(this,e),c(X,this,Se).call(this,e),r(q,this).delete(e),this.update(t=>{delete t.snaps[e],delete t.snapStates[e],delete t.unencryptedSnapStates[e]}),t.status!==m.SnapStatus.Installing&&this.messagingSystem.publish("SnapController:snapUninstalled",n)}))}removeSnapFromSubject(e,t){var n,s;const i=this.messagingSystem.call("PermissionController:getPermissions",e),a=null==i||null===(n=i[h.WALLET_SNAP_PERMISSION_KEY])||void 0===n||null===(n=n.caveats)||void 0===n?void 0:n.find(e=>e.type===m.SnapCaveatType.SnapIds);if(!a)return;if(Boolean(null===(s=a.value)||void 0===s?void 0:s[t])){const n={...a.value};delete n[t],Object.keys(n).length>0?this.messagingSystem.call("PermissionController:updateCaveat",e,h.WALLET_SNAP_PERMISSION_KEY,m.SnapCaveatType.SnapIds,n):this.messagingSystem.call("PermissionController:revokePermissions",{[e]:[h.WALLET_SNAP_PERMISSION_KEY]})}}revokeDynamicSnapPermissions(e,t){(0,f.assert)(t.every(e=>r(j,this).includes(e)),"Non-dynamic permissions cannot be revoked"),this.messagingSystem.call("PermissionController:revokePermissions",{[e]:t})}incrementActiveReferences(e){c(X,this,Ge).call(this,e).activeReferences+=1}decrementActiveReferences(e){const t=c(X,this,Ge).call(this,e);(0,f.assert)(t.activeReferences>0,"SnapController reference management is in an invalid state."),t.activeReferences-=1}getAllSnaps(){return Object.values(this.state.snaps).map(O)}getRunnableSnaps(){return(0,k.getRunnableSnaps)(this.getAllSnaps())}getPermittedSnaps(e){var t;const n=(null===(t=(this.messagingSystem.call("PermissionController:getPermissions",e)??{})[h.WALLET_SNAP_PERMISSION_KEY])||void 0===t||null===(t=t.caveats)||void 0===t||null===(t=t.find(e=>e.type===m.SnapCaveatType.SnapIds))||void 0===t?void 0:t.value)??{};return Object.keys(n).reduce((e,t)=>{const n=this.get(t),s=this.getTruncated(t);return s&&(null==n?void 0:n.status)!==m.SnapStatus.Installing&&(e[t]=s),e},{})}async installSnaps(e,t){c(X,this,ce).call(this);const n={},s=Object.keys(t),i=[],a=[];try{for(const[s,{version:o}]of Object.entries(t)){(0,m.assertIsValidSnapId)(s);const[t,l]=(0,m.resolveVersionRange)(o);if(t)throw d.rpcErrors.invalidParams(`The "version" field must be a valid SemVer version range if specified. Received: "${o}".`);const u=r(W,this).call(this,s,{versionRange:l,fetch:r(D,this),allowLocal:r(x,this).allowLocalSnaps,resolveVersion:async e=>r(x,this).requireAllowlist?await c(X,this,ke).call(this,s,e):e}),h=this.has(s)&&!u.shouldAlwaysReload;if(h&&c(X,this,Qe).call(this,s,l)){const e=this.getExpect(s);i.push({snapId:s,oldVersion:e.version});let t=c(X,this,Ue).call(this,s);if(t!==undefined)throw new Error("This snap is already being updated.");t=c(X,this,$e).call(this,s),t.newVersion=l}else h||a.push(s);n[s]=await this.processRequestedSnap(e,s,u,l)}a.forEach(t=>this.messagingSystem.publish("SnapController:snapInstalled",this.getTruncatedExpect(t),e,!1)),i.forEach(({snapId:t,oldVersion:n})=>this.messagingSystem.publish("SnapController:snapUpdated",this.getTruncatedExpect(t),n,e,!1)),s.forEach(e=>r(K,this).delete(e))}catch(e){const t=a.filter(e=>this.has(e));await this.removeSnaps(t);const n=[...r(K,this).keys()],s=i.map(({snapId:e})=>e).filter(e=>n.includes(e));throw await c(X,this,qe).call(this,s),e}return n}async processRequestedSnap(e,t,s,i){const a=this.getTruncated(t);if(a&&!s.shouldAlwaysReload)return(0,f.satisfiesVersionRange)(a.version,i)?a:await this.updateSnap(e,t,s,i,!1);c(X,this,oe).call(this);let r=c(X,this,ve).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_INSTALL});this.messagingSystem.publish("SnapController:snapInstallStarted",t,e,!1),a&&this.isRunning(t)&&await this.stopSnap(t,m.SnapStatusEvents.Stop),a&&s.shouldAlwaysReload&&c(X,this,be).call(this,t);try{const{sourceCode:a}=await c(X,this,_e).call(this,{origin:e,id:t,location:s,versionRange:i});await this.authorize(t,r),r=c(X,this,ve).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_RESULT}),await c(X,this,Ee).call(this,{snapId:t,sourceCode:a});const o=this.getTruncatedExpect(t);return c(X,this,Te).call(this,r.id,{loading:!1,type:n.SNAP_APPROVAL_INSTALL}),o}catch(s){(0,m.logError)(`Error when adding ${t}.`,s);const i=s instanceof Error?s.message:s.toString();throw c(X,this,Te).call(this,r.id,{loading:!1,type:n.SNAP_APPROVAL_INSTALL,error:i}),this.messagingSystem.publish("SnapController:snapInstallFailed",t,e,!1,i),s}}async updateSnap(e,t,s,i=m.DEFAULT_REQUESTED_SNAP_VERSION,a=!0){c(X,this,oe).call(this),c(X,this,ce).call(this);const r=this.getExpect(t);if(r.preinstalled)throw new Error("Preinstalled Snaps cannot be manually updated.");if(!(0,f.isValidSemVerRange)(i))throw new Error(`Received invalid snap version range: "${i}".`);let o=c(X,this,ve).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_UPDATE});try{this.messagingSystem.publish("SnapController:snapInstallStarted",t,e,!0);const l=r.manifest,u=await(0,P.fetchSnap)(t,s),{sourceCode:p,manifest:g}=u,y=g.result,w=y.version;if(!(0,f.gtVersion)(w,r.version))throw d.rpcErrors.invalidParams(`Snap "${t}@${r.version}" is already installed. Couldn't update to a version inside requested "${i}" range.`);if(!(0,f.satisfiesVersionRange)(w,i))throw new Error(`Version mismatch. Manifest for "${t}" specifies version "${w}" which doesn't satisfy requested version range "${i}".`);await c(X,this,re).call(this,t,{version:w,checksum:y.source.shasum,permissions:y.initialPermissions,platformVersion:y.platformVersion});const S=(0,h.processSnapPermissions)(y.initialPermissions);c(X,this,Ae).call(this,S);const{newPermissions:b,unusedPermissions:v,approvedPermissions:T}=c(X,this,ze).call(this,t,S),{newConnections:k,unusedConnections:_,approvedConnections:E}=c(X,this,Je).call(this,t,l.initialConnections??{},y.initialConnections??{});c(X,this,Te).call(this,o.id,{permissions:b,newVersion:y.version,newPermissions:b,approvedPermissions:T,unusedPermissions:v,newConnections:k,unusedConnections:_,approvedConnections:E,loading:!1});const{permissions:C,...A}=await o.promise;o=c(X,this,ve).call(this,{origin:e,snapId:t,type:n.SNAP_APPROVAL_RESULT}),this.isRunning(t)&&await this.stopSnap(t,m.SnapStatusEvents.Stop),c(X,this,ue).call(this,t,m.SnapStatusEvents.Update),c(X,this,Pe).call(this,{origin:e,id:t,files:u,isUpdate:!0}),c(X,this,Ze).call(this,{snapId:t,unusedPermissions:v,newPermissions:C,requestData:A}),y.initialConnections&&c(X,this,ye).call(this,t,l.initialConnections??null,y.initialConnections);const I=c(X,this,Ue).call(this,t);I!==undefined&&(I.permissions.revoked=v,I.permissions.granted=C,I.permissions.requestData=A);const O=p.toString();(0,f.assert)("string"==typeof O&&O.length>0,`Invalid source code for snap "${t}".`);try{await c(X,this,Ee).call(this,{snapId:t,sourceCode:O})}catch{throw new Error(`Snap ${t} crashed with updated source code.`)}const M=this.getTruncatedExpect(t);return a&&this.messagingSystem.publish("SnapController:snapUpdated",M,r.version,e,!1),c(X,this,Te).call(this,o.id,{loading:!1,type:n.SNAP_APPROVAL_UPDATE}),M}catch(s){(0,m.logError)(`Error when updating ${t},`,s);const i=s instanceof Error?s.message:s.toString();throw c(X,this,Te).call(this,o.id,{loading:!1,error:i,type:n.SNAP_APPROVAL_UPDATE}),this.messagingSystem.publish("SnapController:snapInstallFailed",t,e,!0,i),s}}async authorize(e,t){(0,C.log)(`Authorizing snap: ${e}`);const n=this.state.snaps[e],{initialPermissions:s,initialConnections:i}=n;try{const a=(0,h.processSnapPermissions)(s);c(X,this,Ae).call(this,a),c(X,this,Te).call(this,t.id,{loading:!1,connections:i??{},permissions:a});const{permissions:r,...o}=await t.promise;c(X,this,Ze).call(this,{snapId:e,newPermissions:r,requestData:o}),n.manifest.initialConnections&&c(X,this,ye).call(this,e,null,n.manifest.initialConnections)}finally{c(X,this,Ge).call(this,e).installPromise=null}}destroy(){super.destroy(),r(G,this)&&clearTimeout(r(G,this)),this.messagingSystem.unsubscribe("ExecutionService:unhandledError",this._onUnhandledSnapError),this.messagingSystem.unsubscribe("ExecutionService:outboundRequest",this._onOutboundRequest),this.messagingSystem.unsubscribe("ExecutionService:outboundResponse",this._onOutboundResponse),this.messagingSystem.clearEventSubscriptions("SnapController:snapInstalled"),this.messagingSystem.clearEventSubscriptions("SnapController:snapUpdated")}async handleRequest({snapId:e,origin:t,handler:n,request:s}){c(X,this,ce).call(this),(0,f.assert)(t===b.METAMASK_ORIGIN||(0,m.isValidUrl)(t),"'origin' must be a valid URL or 'metamask'.");const i={jsonrpc:"2.0",id:(0,w.nanoid)(),...s};(0,f.assertIsJsonRpcRequest)(i);const a=h.handlerEndowments[n];(0,f.assert)("string"==typeof a||null===a,"'permissionName' must be either a string or null.");const r=this.messagingSystem.call("PermissionController:getPermissions",e);if(!(null===a||r&&(0,f.hasProperty)(r,a)))throw new Error(`Snap "${e}" is not permitted to use "${a}".`);const o=a?r[a]:undefined;if(a===h.SnapEndowments.Rpc||a===h.SnapEndowments.Keyring){(0,f.assert)(o);const n=this.messagingSystem.call("SubjectMetadataController:getSubjectMetadata",t),s=a===h.SnapEndowments.Rpc?(0,h.getRpcCaveatOrigins)(o):(0,h.getKeyringCaveatOrigins)(o);if((0,f.assert)(s),!(0,m.isOriginAllowed)(s,(null==n?void 0:n.subjectType)??u.SubjectType.Website,t))throw new Error(`Snap "${e}" is not permitted to handle requests from "${t}".`)}if(t!==b.METAMASK_ORIGIN&&b.CLIENT_ONLY_HANDLERS.includes(n))throw new Error(`"${n}" can only be invoked by MetaMask.`);if(!this.state.snaps[e].enabled)throw new Error(`Snap "${e}" is disabled.`);if(this.state.snaps[e].status===m.SnapStatus.Installing)throw new Error(`Snap "${e}" is currently being installed. Please try again later.`);const l=c(X,this,Oe).call(this,o),d=c(X,this,Ge).call(this,e);if(d.stopPromise&&await d.stopPromise,!this.isRunning(e)){d.startPromise||(d.startPromise=this.startSnap(e));try{await d.startPromise}finally{d.startPromise=null}}const p=c(X,this,Le).call(this,e,n,i),g=new _.Timer(l);c(X,this,He).call(this,e,p.id,g);const y=this.messagingSystem.call("ExecutionService:handleRpcRequest",e,{origin:t,handler:n,request:p});try{const s=await(0,P.withTimeout)(y,g);if(s===P.hasTimedOut){const t=null!==d.stopPromise||!this.isRunning(e);throw new Error(t?`${e} was stopped and the request was cancelled. This is likely because the Snap crashed.`:`${e} failed to respond to the request in time.`)}await c(X,this,Fe).call(this,e,n,s);const i=await c(X,this,Ne).call(this,e,n,p,s);return c(X,this,Be).call(this,e,p.id,n,t,!0),i}catch(s){c(X,this,Be).call(this,e,p.id,n,t,!1);const[i,a]=(0,m.unwrapError)(s);throw a||((0,m.logError)(`"${e}" crashed due to an unhandled error:`,i),await this.stopSnap(e,m.SnapStatusEvents.Crash)),i}}setClientActive(e){e?c(X,this,et).call(this,b.METAMASK_ORIGIN,m.HandlerType.OnActive):c(X,this,et).call(this,b.METAMASK_ORIGIN,m.HandlerType.OnInactive)}}function ee(){const e=({snapId:e})=>this.getExpect(e).enabled,t={initial:m.SnapStatus.Installing,states:{[m.SnapStatus.Installing]:{on:{[m.SnapStatusEvents.Start]:{target:m.SnapStatus.Running,cond:e}}},[m.SnapStatus.Updating]:{on:{[m.SnapStatusEvents.Start]:{target:m.SnapStatus.Running,cond:e},[m.SnapStatusEvents.Stop]:m.SnapStatus.Stopped}},[m.SnapStatus.Running]:{on:{[m.SnapStatusEvents.Stop]:m.SnapStatus.Stopped,[m.SnapStatusEvents.Crash]:m.SnapStatus.Crashed}},[m.SnapStatus.Stopped]:{on:{[m.SnapStatusEvents.Start]:{target:m.SnapStatus.Running,cond:e},[m.SnapStatusEvents.Update]:m.SnapStatus.Updating}},[m.SnapStatus.Crashed]:{on:{[m.SnapStatusEvents.Start]:{target:m.SnapStatus.Running,cond:e},[m.SnapStatusEvents.Update]:m.SnapStatus.Updating}}}};o(V,this,(0,g.createMachine)(t)),(0,E.validateMachine)(r(V,this))}function te(){this.messagingSystem.registerActionHandler(`${n.controllerName}:init`,(...e)=>this.init(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:clearSnapState`,(...e)=>this.clearSnapState(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:get`,(...e)=>this.get(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:getSnapState`,async(...e)=>this.getSnapState(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:handleRequest`,async(...e)=>this.handleRequest(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:has`,(...e)=>this.has(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:updateBlockedSnaps`,async()=>this.updateBlockedSnaps()),this.messagingSystem.registerActionHandler(`${n.controllerName}:updateSnapState`,async(...e)=>this.updateSnapState(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:enable`,(...e)=>this.enableSnap(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:disable`,async(...e)=>this.disableSnap(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:remove`,async(...e)=>this.removeSnap(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:getPermitted`,(...e)=>this.getPermittedSnaps(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:install`,async(...e)=>this.installSnaps(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:getAll`,(...e)=>this.getAllSnaps(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:getRunnableSnaps`,(...e)=>this.getRunnableSnaps(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:incrementActiveReferences`,(...e)=>this.incrementActiveReferences(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:decrementActiveReferences`,(...e)=>this.decrementActiveReferences(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:disconnectOrigin`,(...e)=>this.removeSnapFromSubject(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:revokeDynamicPermissions`,(...e)=>this.revokeDynamicSnapPermissions(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:getFile`,async(...e)=>this.getSnapFile(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:stopAllSnaps`,async(...e)=>this.stopAllSnaps(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:isMinimumPlatformVersion`,(...e)=>this.isMinimumPlatformVersion(...e)),this.messagingSystem.registerActionHandler(`${n.controllerName}:setClientActive`,(...e)=>this.setClientActive(...e))}function ne(e){for(const{snapId:n,manifest:s,files:i,removable:a,hidden:r,hideSnapBranding:o}of e){var t;const e=this.get(n),l=e!==undefined,u=l&&(0,f.gtVersion)(s.version,e.version);if(l&&(!u||!0!==e.preinstalled))continue;const d=new m.VirtualFile({path:m.NpmSnapFileNames.Manifest,value:JSON.stringify(s),result:s}),p=i.map(({path:e,value:t})=>new m.VirtualFile({value:t,path:e})),{filePath:g,iconPath:y}=s.source.location.npm,w=p.find(e=>e.path===g),S=y?p.find(e=>e.path===y):undefined;(0,f.assert)(w,"Source code not provided for preinstalled snap."),(0,f.assert)(!y||y&&S,"Icon not provided for preinstalled snap."),(0,f.assert)(s.source.files===undefined,"Auxiliary files are not currently supported for preinstalled snaps.");const v=(null===(t=s.source.locales)||void 0===t?void 0:t.map(e=>p.find(t=>t.path===e)))??[],T=(0,m.getValidatedLocalizationFiles)(v.filter(Boolean));(0,f.assert)(v.length===T.length,"Missing localization files for preinstalled snap.");const k={manifest:d,sourceCode:w,svgIcon:S,auxiliaryFiles:[],localizationFiles:T};c(X,this,Pe).call(this,{id:n,origin:b.METAMASK_ORIGIN,files:k,removable:a,hidden:r,hideSnapBranding:o,preinstalled:!0});const _=(0,h.processSnapPermissions)(s.initialPermissions);c(X,this,Ae).call(this,_);const{newPermissions:E,unusedPermissions:C}=c(X,this,ze).call(this,n,_);c(X,this,Ze).call(this,{snapId:n,newPermissions:E,unusedPermissions:C}),s.initialConnections&&c(X,this,ye).call(this,n,(null==e?void 0:e.initialConnections)??null,s.initialConnections),this.update(e=>{e.snaps[n].status=m.SnapStatus.Stopped}),c(X,this,Ve).call(this,n),u?this.messagingSystem.publish("SnapController:snapUpdated",this.getTruncatedExpect(n),e.version,b.METAMASK_ORIGIN,!0):this.messagingSystem.publish("SnapController:snapInstalled",this.getTruncatedExpect(n),b.METAMASK_ORIGIN,!0)}}function se(){o(G,this,setTimeout(()=>{c(X,this,le).call(this).catch(e=>{(0,m.logError)(e)}),c(X,this,se).call(this)},r(L,this)))}async function ie(e,t){if(this.has(e)){try{this.update(n=>{n.snaps[e].blocked=!0,n.snaps[e].blockInformation=t}),await this.disableSnap(e)}catch(t){(0,m.logError)(`Encountered error when stopping blocked snap "${e}".`,t)}this.messagingSystem.publish(`${n.controllerName}:snapBlocked`,e,t)}}function ae(e){this.has(e)&&this.state.snaps[e].blocked&&(this.update(t=>{t.snaps[e].blocked=!1,delete t.snaps[e].blockInformation}),this.messagingSystem.publish(`${n.controllerName}:snapUnblocked`,e))}async function re(e,{platformVersion:t,...n}){const s=(await this.messagingSystem.call("SnapsRegistry:get",{[e]:n}))[e];var i;if(s.status===T.SnapsRegistryStatus.Blocked)throw new Error(`Cannot install version "${n.version}" of snap "${e}": The version is blocked. ${(null===(i=s.reason)||void 0===i?void 0:i.explanation)??""}`);const a=Object.keys(n.permissions).some(e=>!b.ALLOWED_PERMISSIONS.includes(e));if(r(x,this).requireAllowlist&&a&&s.status!==T.SnapsRegistryStatus.Verified)throw new Error(`Cannot install version "${n.version}" of snap "${e}": ${s.status===T.SnapsRegistryStatus.Unavailable?"The registry is temporarily unavailable.":"The snap is not on the allowlist."}`);c(X,this,Ie).call(this,e,t)}function oe(){(0,f.assert)(!0!==r(x,this).disableSnapInstallation,"Installing Snaps is currently disabled in this version of MetaMask.")}function ce(){const e=r(U,this).call(this);(0,f.assert)(!0!==e.disableSnaps,"The Snaps platform requires basic functionality to be used. Enable basic functionality in the settings to use the Snaps platform.")}async function le(){const e=[...r(q,this).entries()];return Promise.all(e.filter(([e,t])=>0===t.activeReferences&&0===t.pendingInboundRequests.length&&t.lastRequest&&r(F,this)&&(0,f.timeSince)(t.lastRequest)>r(F,this)).map(async([e])=>this.stopSnap(e,m.SnapStatusEvents.Stop)))}function ue(e,t){const{interpreter:n}=c(X,this,Ge).call(this,e);n.send(t),this.update(t=>{t.snaps[e].status=n.state.value})}async function de(e){await this.messagingSystem.call("ExecutionService:terminateSnap",e),await new Promise(e=>setTimeout(e,1));c(X,this,Ge).call(this,e).pendingInboundRequests.filter(e=>"finished"!==e.timer.status).forEach(e=>e.timer.finish()),await new Promise(e=>setTimeout(e,1)),this.messagingSystem.publish("SnapController:snapTerminated",this.getTruncatedExpect(e))}function he(e,t=c(X,this,Ge).call(this,e)){return null!==t.encryptionKey&&null!==t.encryptionSalt}async function pe({snapId:e,salt:t,useCache:n,keyMetadata:s}){const i=c(X,this,Ge).call(this,e);if(c(X,this,he).call(this,e,i)&&n)return{key:await r(H,this).importKey(i.encryptionKey),salt:i.encryptionSalt};const a=t??r(H,this).generateSalt(),o=await r(B,this).call(this),l=await(0,h.getEncryptionEntropy)({snapId:e,seed:o,cryptographicFunctions:r($,this)}),u=await r(H,this).keyFromPassword(l,a,!0,s),d=await r(H,this).exportKey(u);return n&&(i.encryptionKey=d,i.encryptionSalt=a),{key:u,salt:a}}async function me(e,t){try{const n=JSON.parse(t),{salt:s,keyMetadata:i}=n,a=c(X,this,he).call(this,e)||r(H,this).isVaultUpdated(t),{key:o}=await c(X,this,pe).call(this,{snapId:e,salt:s,useCache:a,keyMetadata:i??b.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS});return await r(H,this).decryptWithKey(o,n)}catch{throw d.rpcErrors.internal({message:"Failed to decrypt snap state, the state must be corrupted."})}}async function fe(e,t){const{key:n,salt:s}=await c(X,this,pe).call(this,{snapId:e,useCache:!0}),i=await r(H,this).encryptWithKey(n,t);return i.salt=s,JSON.stringify(i)}async function ge(e,t,n){return null===t?null:n?await c(X,this,fe).call(this,e,t):JSON.stringify(t)}function ye(e,t,n){if(t){const s=(0,P.setDiff)(t,n);for(const t of Object.keys(s))this.removeSnapFromSubject(t,e)}for(const t of Object.keys(n))c(X,this,we).call(this,t,e)}function we(e,t){var n,s;const i=this.messagingSystem.call("PermissionController:getPermissions",e),a=null==i||null===(n=i[h.WALLET_SNAP_PERMISSION_KEY])||void 0===n||null===(n=n.caveats)||void 0===n?void 0:n.find(e=>e.type===m.SnapCaveatType.SnapIds);if(Boolean(null==a||null===(s=a.value)||void 0===s?void 0:s[t]))return;if(a)return void this.messagingSystem.call("PermissionController:updateCaveat",e,h.WALLET_SNAP_PERMISSION_KEY,m.SnapCaveatType.SnapIds,{...a.value,[t]:{}});const r={[h.WALLET_SNAP_PERMISSION_KEY]:{caveats:[{type:m.SnapCaveatType.SnapIds,value:{[t]:{}}}]}};this.messagingSystem.call("PermissionController:grantPermissions",{approvedPermissions:r,subject:{origin:e}})}function Se(e){const t=this.messagingSystem.call("PermissionController:getSubjectNames");for(const n of t)this.removeSnapFromSubject(n,e)}function be(e){this.messagingSystem.call("PermissionController:hasPermissions",e)&&this.messagingSystem.call("PermissionController:revokeAllPermissions",e)}function ve({origin:e,snapId:t,type:n}){const s=(0,w.nanoid)();return{id:s,promise:this.messagingSystem.call("ApprovalController:addRequest",{origin:e,id:s,type:n,requestData:{metadata:{id:s,origin:t,dappOrigin:e},snapId:t},requestState:{loading:!0}},!0)}}function Te(e,t){try{this.messagingSystem.call("ApprovalController:updateRequestState",{id:e,requestState:t})}catch{}}async function ke(e,t){return await this.messagingSystem.call("SnapsRegistry:resolveVersion",e,t)}async function _e(e){const{id:t,location:n,versionRange:s}=e;c(X,this,Ve).call(this,t);const i=c(X,this,Ge).call(this,t);i.installPromise||((0,C.log)(`Adding snap: ${t}`),i.installPromise=(async()=>{const i=await(0,P.fetchSnap)(t,n),a=i.manifest.result;if(!(0,f.satisfiesVersionRange)(a.version,s))throw new Error(`Version mismatch. Manifest for "${t}" specifies version "${a.version}" which doesn't satisfy requested version range "${s}".`);await c(X,this,re).call(this,t,{version:a.version,checksum:a.source.shasum,permissions:a.initialPermissions,platformVersion:a.platformVersion});const o=r(x,this).forcePreinstalledSnaps&&(0,P.isLocalSnapId)(t)?{preinstalled:!0,hideSnapBranding:!0,hidden:!1}:{};return c(X,this,Pe).call(this,{...e,files:i,id:t,...o})})());try{return await i.installPromise}catch(e){throw i.installPromise=null,e}}async function Ee(e){const{snapId:t}=e;if(this.isRunning(t))throw new Error(`Snap "${t}" is already started.`);try{const n=c(X,this,Ge).call(this,t),s=await this.messagingSystem.call("ExecutionService:executeSnap",{...e,endowments:await c(X,this,Ce).call(this,t)});return c(X,this,ue).call(this,t,m.SnapStatusEvents.Start),n.lastRequest=Date.now(),s}catch(e){throw await c(X,this,de).call(this,t),e}}async function Ce(e){let t=[];for(const n of r(N,this))if(this.messagingSystem.call("PermissionController:hasPermission",e,n)){const s=await this.messagingSystem.call("PermissionController:getEndowments",e,n);if(s){if(!Array.isArray(s)||s.some(e=>"string"!=typeof e))throw new Error("Expected an array of string endowment names.");t=t.concat(s)}}const n=[...new Set([...m.DEFAULT_ENDOWMENTS,...t])];return n.length<m.DEFAULT_ENDOWMENTS.length+t.length&&(0,m.logError)(`Duplicate endowments found for ${e}. Default endowments should not be requested.`,t),n}function Pe(e){const{id:t,origin:n,files:s,isUpdate:i=!1,removable:a,preinstalled:o,hidden:l,hideSnapBranding:d}=e,{manifest:h,sourceCode:p,svgIcon:g,auxiliaryFiles:y,localizationFiles:w}=s;(0,m.assertIsSnapManifest)(h.result);const{version:S}=h.result,b=p.toString();(0,f.assert)("string"==typeof b&&b.length>0,`Invalid source code for snap "${t}".`);const v=y.map(e=>((0,f.assert)("string"==typeof e.data.base64),{path:e.path,value:e.data.base64})),T=this.state.snaps[t],k=[...(null==T?void 0:T.versionHistory)??[],{version:S,date:Date.now(),origin:n}],_=w.map(e=>e.result),E={...T,blocked:!1,enabled:!0,removable:a,preinstalled:o,hidden:l,hideSnapBranding:d,id:t,initialConnections:h.result.initialConnections,initialPermissions:h.result.initialPermissions,manifest:h.result,status:r(V,this).config.initial,sourceCode:b,version:S,versionHistory:k,auxiliaryFiles:v,localizationFiles:_};delete E.blockInformation;const{inversePatches:C}=this.update(e=>{e.snaps[t]=E});if(i){const e=c(X,this,Ue).call(this,t);e!==undefined&&(e.statePatches=C)}const{proposedName:P}=(0,m.getLocalizedSnapManifest)(h.result,"en",_);return this.messagingSystem.call("SubjectMetadataController:addSubjectMetadata",{subjectType:u.SubjectType.Snap,name:P,origin:E.id,version:S,svgIcon:(null==g?void 0:g.toString())??null}),{...E,sourceCode:b}}function Ae(e){const t=Object.keys(e),n=Array.from(new Set(Object.values(h.handlerEndowments)));(0,f.assert)(t.some(e=>n.includes(e)),`A snap must request at least one of the following permissions: ${n.filter(e=>null!==e).join(", ")}.`);const s=t.reduce((e,t)=>((0,f.hasProperty)(r(R,this),t)&&e.push(r(R,this)[t]),e),[]);(0,f.assert)(0===s.length,`One or more permissions are not allowed:\n${s.join("\n")}`)}function Ie(e,t){if(t!==undefined&&(0,S.gt)(t,(0,m.getPlatformVersion)())){const n=`The Snap "${e}" requires platform version "${t}" which is greater than the current platform version "${(0,m.getPlatformVersion)()}".`;if(r(x,this).rejectInvalidPlatformVersion)throw new Error(n);(0,m.logWarning)(n)}}function Oe(e){return(0,h.getMaxRequestTimeCaveat)(e)??this.maxRequestTime}async function Me(e,t,n){return this.messagingSystem.call("SnapInterfaceController:createInterface",e,t,undefined,n)}function je(e,t){(0,f.assert)(this.messagingSystem.call("SnapInterfaceController:getInterface",e,t))}async function Ne(e,t,n,s){switch(t){case m.HandlerType.OnTransaction:case m.HandlerType.OnSignature:case m.HandlerType.OnHomePage:case m.HandlerType.OnSettingsPage:{const t=s;if(t&&(0,f.hasProperty)(t,"content")){const{content:n,...s}=t;return{...s,id:await c(X,this,Me).call(this,e,n)}}return s}case m.HandlerType.OnAssetsLookup:return c(X,this,Re).call(this,e,n,s);case m.HandlerType.OnAssetsConversion:return c(X,this,xe).call(this,n,s);case m.HandlerType.OnAssetsMarketData:return c(X,this,De).call(this,n,s);default:return s}}function Re(e,{params:t},{assets:n}){const s=this.messagingSystem.call("PermissionController:getPermissions",e);(0,f.assert)(s);const i=s[h.SnapEndowments.Assets],a=(0,h.getChainIdsCaveat)(i);(0,f.assert)(a);const{assets:r}=t;return{assets:Object.keys(n).reduce((e,t)=>{const s=t;return a.some(e=>s.startsWith(e))&&r.includes(s)&&(e[s]=n[s]),e},{})}}function xe({params:e},{conversionRates:t}){const{conversions:n}=e;return{conversionRates:n.reduce((e,n)=>{var s;const i=null===(s=t[n.from])||void 0===s?void 0:s[n.to];var a;i&&(e[a=n.from]??(e[a]={}),e[n.from][n.to]=i);return e},{})}}function De({params:e},{marketData:t}){const{assets:n}=e;return{marketData:n.reduce((e,n)=>{var s;const i=null===(s=t[n.asset])||void 0===s?void 0:s[n.unit];var a;i&&(e[a=n.asset]??(e[a]={}),e[n.asset][n.unit]=i);return e},{})}}function Le(e,t,n){if(t===m.HandlerType.OnUserInput){(0,f.assert)(n.params&&(0,f.hasProperty)(n.params,"id"));const t=n.params.id,{context:s}=this.messagingSystem.call("SnapInterfaceController:getInterface",e,t);return{...n,params:{...n.params,context:s}}}return n}async function Fe(e,t,n){switch(t){case m.HandlerType.OnTransaction:(0,f.assertStruct)(n,m.OnTransactionResponseStruct),n&&(0,f.hasProperty)(n,"id")&&c(X,this,je).call(this,e,n.id);break;case m.HandlerType.OnSignature:(0,f.assertStruct)(n,m.OnSignatureResponseStruct),n&&(0,f.hasProperty)(n,"id")&&c(X,this,je).call(this,e,n.id);break;case m.HandlerType.OnHomePage:(0,f.assertStruct)(n,m.OnHomePageResponseStruct),n&&(0,f.hasProperty)(n,"id")&&c(X,this,je).call(this,e,n.id);break;case m.HandlerType.OnSettingsPage:(0,f.assertStruct)(n,m.OnSettingsPageResponseStruct),n&&(0,f.hasProperty)(n,"id")&&c(X,this,je).call(this,e,n.id);break;case m.HandlerType.OnNameLookup:(0,f.assertStruct)(n,m.OnNameLookupResponseStruct);break;case m.HandlerType.OnAssetsLookup:(0,f.assertStruct)(n,p.OnAssetsLookupResponseStruct);break;case m.HandlerType.OnAssetsConversion:(0,f.assertStruct)(n,m.OnAssetsConversionResponseStruct);break;case m.HandlerType.OnAssetHistoricalPrice:(0,f.assertStruct)(n,m.OnAssetHistoricalPriceResponseStruct);break;case m.HandlerType.OnAssetsMarketData:(0,f.assertStruct)(n,m.OnAssetsMarketDataResponseStruct)}}function He(e,t,n){const s=c(X,this,Ge).call(this,e);s.pendingInboundRequests.push({requestId:t,timer:n}),s.lastRequest=null}function Be(e,t,n,s,i){const a=c(X,this,Ge).call(this,e);a.pendingInboundRequests=a.pendingInboundRequests.filter(e=>e.requestId!==t),0===a.pendingInboundRequests.length&&(a.lastRequest=Date.now());const o=this.get(e);if((0,P.isTrackableHandler)(n)&&(null==o||!o.preinstalled))try{r(J,this).call(this,e,n,i,s)}catch(e){(0,m.logError)(`Error when calling MetaMetrics hook for snap "${null==o?void 0:o.id}": ${(0,p.getErrorMessage)(e)}`)}}function Ue(e){return r(K,this).get(e)}function $e(e){(0,f.assert)(r(K,this).get(e)===undefined,new Error(`Snap "${e}" rollback snapshot already exists.`)),r(K,this).set(e,{statePatches:[],permissions:{},newVersion:""});const t=r(K,this).get(e);return(0,f.assert)(t!==undefined,new Error(`Snapshot creation failed for ${e}.`)),t}async function We(e){var t,n;const s=c(X,this,Ue).call(this,e);if(!s)throw new Error("A snapshot does not exist for this snap.");await this.stopSnap(e,m.SnapStatusEvents.Stop),(null===(t=this.get(e))||void 0===t?void 0:t.status)!==m.SnapStatus.Stopped&&c(X,this,ue).call(this,e,m.SnapStatusEvents.Stop);const{statePatches:i,permissions:a}=s;null!=i&&i.length&&this.applyPatches(i),(null===(n=this.get(e))||void 0===n?void 0:n.status)!==m.SnapStatus.Stopped&&this.update(t=>{t.snaps[e].status=m.SnapStatus.Stopped}),c(X,this,Ze).call(this,{snapId:e,unusedPermissions:a.granted,newPermissions:a.revoked,requestData:a.requestData});const o=this.getTruncatedExpect(e);this.messagingSystem.publish("SnapController:snapRolledback",o,s.newVersion),r(K,this).delete(e)}async function qe(e){for(const t of e)await c(X,this,We).call(this,t)}function Ke(e){return r(q,this).get(e)}function Ge(e){const t=c(X,this,Ke).call(this,e);return(0,f.assert)(t!==undefined,new Error(`Snap "${e}" runtime data not found`)),t}function Ve(e){if(r(q,this).has(e))return;const t=this.get(e),n=(0,g.interpret)(r(V,this));n.start({context:{snapId:e},value:(null==t?void 0:t.status)??r(V,this).config.initial}),(0,E.forceStrict)(n),r(q,this).set(e,{lastRequest:null,startPromise:null,stopPromise:null,installPromise:null,encryptionKey:null,encryptionSalt:null,activeReferences:0,pendingInboundRequests:[],pendingOutboundRequests:0,interpreter:n,stateMutex:new y.Mutex,getStateMutex:new y.Mutex})}function ze(e,t){const n=this.messagingSystem.call("PermissionController:getPermissions",e)??{},s=(0,P.permissionsDiff)(t,n),i=(0,P.permissionsDiff)(n,t);return{newPermissions:s,unusedPermissions:i,approvedPermissions:(0,P.permissionsDiff)(n,i)}}function Ye(e,t){var n,s;const i=this.messagingSystem.call("PermissionController:getPermissions",t),a=null==i||null===(n=i[h.WALLET_SNAP_PERMISSION_KEY])||void 0===n||null===(n=n.caveats)||void 0===n?void 0:n.find(e=>e.type===m.SnapCaveatType.SnapIds);return Boolean(null==a||null===(s=a.value)||void 0===s?void 0:s[e])}function Je(e,t,n){const s=Object.keys(t).filter(t=>c(X,this,Ye).call(this,e,t)).reduce((e,n)=>(e[n]=t[n],e),{}),i=(0,P.setDiff)(n,s),a=(0,P.setDiff)(s,n);return{newConnections:i,unusedConnections:a,approvedConnections:(0,P.setDiff)(s,a)}}function Xe(e,t){if(r(x,this).useCaip25Permission&&Object.keys(t).includes(h.SnapEndowments.EthereumProvider)){const n=this.messagingSystem.call("SelectedNetworkController:getNetworkClientIdForDomain",e),{configuration:s}=this.messagingSystem.call("NetworkController:getNetworkClientById",n),i=(0,f.hexToNumber)(s.chainId);return{...t,"endowment:caip25":{caveats:[{type:"authorizedScopes",value:{requiredScopes:{},optionalScopes:{[`eip155:${i}`]:{accounts:[]}},sessionProperties:{},isMultichainOrigin:!1}}]}}}return t}function Ze({snapId:e,unusedPermissions:t={},newPermissions:n={},requestData:s}){const i=Object.keys(t);if((0,f.isNonEmptyArray)(i)&&this.messagingSystem.call("PermissionController:revokePermissions",{[e]:i}),(0,f.isNonEmptyArray)(Object.keys(n))){const t=c(X,this,Xe).call(this,e,n);this.messagingSystem.call("PermissionController:grantPermissions",{approvedPermissions:t,subject:{origin:e},requestData:s})}}function Qe(e,t){const n=this.getExpect(e);return!(0,f.satisfiesVersionRange)(n.version,t)&&!(0,f.gtRange)(n.version,t)}function et(e,t){const n=this.getRunnableSnaps();for(const{id:s}of n){this.messagingSystem.call("PermissionController:hasPermission",s,h.SnapEndowments.LifecycleHooks)&&c(X,this,tt).call(this,e,s,t).catch(e=>{(0,m.logError)(`Error calling lifecycle hook "${t}" for Snap "${s}": ${(0,p.getErrorMessage)(e)}`)})}}async function tt(e,t,n){const s=h.handlerEndowments[n];(0,f.assert)(s,"Lifecycle hook must have an endowment.");this.messagingSystem.call("PermissionController:hasPermission",t,s)&&await this.handleRequest({snapId:t,handler:n,origin:e,request:{jsonrpc:"2.0",method:n}})}function nt(){for(const e of r(q,this).values())e.encryptionKey=null,e.encryptionSalt=null,e.state=undefined}n.SnapController=Q}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/SnapController.cjs"}],[2029,{"@metamask/utils":2361},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.Timer=void 0;const i=e("@metamask/utils");n.Timer=class{constructor(e){s(this,"state",void 0),(0,i.assert)(!Number.isNaN(e),new TypeError("Can't start a timer with NaN time")),(0,i.assert)(e>=0,new TypeError("Can't start a timer with negative time")),this.state={value:"stopped",remaining:e}}get status(){return this.state.value}get remaining(){return this.state.remaining}cancel(){(0,i.assert)("paused"===this.status||"running"===this.status,new Error("Tried to cancel a not running Timer")),this.onFinish(!1)}finish(){(0,i.assert)("finished"!==this.status,new Error("Tried to finish a finished Timer.")),this.onFinish(!0)}pause(){(0,i.assert)("running"===this.state.value,new Error("Tried to pause a not running Timer"));const{callback:e,start:t,timeout:n,remaining:s}=this.state;n!==undefined&&clearTimeout(n),this.state={value:"paused",callback:e,remaining:s-(Date.now()-t)}}start(e){(0,i.assert)("stopped"===this.state.value,new Error("Tried to start an already running Timer"));const{remaining:t}=this.state;this.state={value:"paused",remaining:t,callback:e},this.resume()}resume(){(0,i.assert)("paused"===this.state.value,new Error("Tried to resume not paused Timer"));const{remaining:e,callback:t}=this.state,n=Date.now();let s;e!==Number.POSITIVE_INFINITY&&(s=setTimeout(()=>this.onFinish(!0),e)),this.state={value:"running",callback:t,remaining:e,start:n,timeout:s}}onFinish(e){(0,i.assert)("running"===this.state.value||"paused"===this.state.value),"running"===this.state.value&&this.state.timeout!==undefined&&clearTimeout(this.state.timeout);const{callback:t,remaining:n}=this.state;this.state={value:"finished",remaining:"running"===this.state.value?n-(Date.now()-this.state.start):n},e&&t()}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/Timer.cjs"}],[203,{"@ethersproject/abi":552,"@metamask/utils":2361},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.decodeTransactionDataWithSourcify=async function(e,t,n){var o,c;const l=await async function(e,t){var n;const s=await async function(e,t){const n=parseInt(t,16),s=await fetch(`https://sourcify.dev/server/files/any/${n}/${e}`);if(!s.ok)throw new Error("Failed to fetch Sourcify files");return s.json()}(e,t),i=null===(n=s.files)||void 0===n?void 0:n.find(e=>e.name.includes("metadata.json"));if(!i)throw new Error("Metadata not found");return JSON.parse(i.content)}(t,n);i("Retrieved Sourcify metadata",{contractAddress:t,chainId:n,metadata:l});const{abi:u}=l.output,d=new s.Interface(u),h=e.slice(0,10);let p;try{p=d.getFunction(h)}catch(e){}if(!p)return i("Failed to find function in ABI",h,u),undefined;const{name:m,inputs:f}=p,g=r(m,f),y=null===(o=l.output.userdoc)||void 0===o?void 0:o.methods[g],w=null===(c=l.output.devdoc)||void 0===c?void 0:c.methods[g],S=(null==y?void 0:y.notice)??(null==w?void 0:w.details);i("Extracted NatSpec",{signature:g,userDoc:y,devDoc:w});const b=d.decodeFunctionData(h,e),v=f.map((e,t)=>a(e,t,b,y,w));return{name:m,description:S,params:v}};var s=e("@ethersproject/abi");const i=(0,e("@metamask/utils").createProjectLogger)("sourcify");function a(e,t,n,s,i){var r,o;const{name:c,type:l,components:u}=e,d=(null==s||null===(r=s.params)||void 0===r?void 0:r[c])??(null==i||null===(o=i.params)||void 0===o?void 0:o[c]),h=n[t];let p=null==u?void 0:u.map((e,t)=>a(e,t,h,{},{}));if(l.endsWith("[]")){const t=l.slice(0,-2);p=h.map((n,s)=>{const i=`Item ${s+1}`;return a({...e,name:i,type:t},s,h,{},{})})}return{name:c,description:d,type:l,value:h,children:p}}function r(e,t){return`${e??""}(${t.map(e=>{var t;return null!==(t=e.components)&&void 0!==t&&t.length?`${r(undefined,e.components)}${e.type.endsWith("[]")?"[]":""}`:e.type}).join(",")})`}}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/sourcify.ts"}],[2030,{"@metamask/snaps-rpc-methods":2075,"@metamask/snaps-utils":2245},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.CLIENT_ONLY_HANDLERS=n.METAMASK_ORIGIN=n.STATE_DEBOUNCE_TIMEOUT=n.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS=n.ALLOWED_PERMISSIONS=void 0;const s=e("@metamask/snaps-rpc-methods"),i=e("@metamask/snaps-utils");n.ALLOWED_PERMISSIONS=Object.freeze(["snap_dialog","snap_manageState","snap_notify","snap_getLocale",s.SnapEndowments.Cronjob,s.SnapEndowments.HomePage,s.SnapEndowments.LifecycleHooks,s.SnapEndowments.EthereumProvider,s.SnapEndowments.TransactionInsight,s.SnapEndowments.SignatureInsight]),n.LEGACY_ENCRYPTION_KEY_DERIVATION_OPTIONS={algorithm:"PBKDF2",params:{iterations:1e4}},n.STATE_DEBOUNCE_TIMEOUT=500,n.METAMASK_ORIGIN="metamask",n.CLIENT_ONLY_HANDLERS=Object.freeze([i.HandlerType.OnClientRequest,i.HandlerType.OnSignature,i.HandlerType.OnTransaction,i.HandlerType.OnCronjob,i.HandlerType.OnNameLookup,i.HandlerType.OnHomePage,i.HandlerType.OnSettingsPage,i.HandlerType.OnUserInput,i.HandlerType.OnAssetsLookup,i.HandlerType.OnAssetsConversion,i.HandlerType.OnAssetHistoricalPrice,i.HandlerType.OnAssetsMarketData,i.HandlerType.OnWebSocketEvent])}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/constants.cjs"}],[2031,{"./SnapController.cjs":2028,"./constants.cjs":2030,"./location/index.cjs":2033,"./registry/index.cjs":2037,"./selectors.cjs":2040},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},i=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),i(e("./constants.cjs"),n),i(e("./location/index.cjs"),n),i(e("./SnapController.cjs"),n),i(e("./selectors.cjs"),n),i(e("./registry/index.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/index.cjs"}],[2032,{"@metamask/snaps-utils":2245,"@metamask/utils":2361},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0}),n.HttpLocation=void 0;const i=e("@metamask/snaps-utils"),a=e("@metamask/utils");n.HttpLocation=class{constructor(e,t={}){s(this,"cache",new Map),s(this,"validatedManifest",void 0),s(this,"url",void 0),s(this,"fetchFn",void 0),s(this,"fetchOptions",void 0),(0,a.assertStruct)(e.toString(),i.HttpSnapIdStruct,"Invalid Snap Id: "),this.fetchFn=t.fetch??globalThis.fetch.bind(undefined),this.fetchOptions=t.fetchOptions,this.url=e}async manifest(){if(this.validatedManifest)return this.validatedManifest.clone();const e=new URL(i.NpmSnapFileNames.Manifest,this.url).toString(),t=await this.fetchFn(e,this.fetchOptions);if(!t.ok)throw new Error(`Failed to fetch "${e}". Status code: ${t.status}.`);const n=await t.text(),s=(0,i.parseJson)(n),a=new i.VirtualFile({value:n,result:(0,i.createSnapManifest)(s),path:i.NpmSnapFileNames.Manifest,data:{canonicalPath:e}});return this.validatedManifest=a,this.manifest()}async fetch(e){const t=(0,i.normalizeRelative)(e),n=this.cache.get(t);if(n!==undefined)return n.clone();const s=this.toCanonical(t).toString(),r=await this.fetchFn(s,this.fetchOptions);if(!r.ok)throw new Error(`Failed to fetch "${s}". Status code: ${r.status}.`);const o=await r.arrayBuffer(),c=new i.VirtualFile({value:new Uint8Array(o),path:t,data:{canonicalPath:s}});return(0,a.assert)(!this.cache.has(t),"Corrupted cache, multiple files with same path."),this.cache.set(t,c),this.fetch(t)}get root(){return new URL(this.url)}toCanonical(e){return(0,a.assert)(!e.startsWith("/"),"Tried to parse absolute path."),new URL(e,this.url)}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/http.cjs"}],[2033,{"./http.cjs":2032,"./local.cjs":2034,"./location.cjs":2035,"./npm.cjs":2036},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},i=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),i(e("./location.cjs"),n),i(e("./npm.cjs"),n),i(e("./local.cjs"),n),i(e("./http.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/index.cjs"}],[2034,{"./http.cjs":2032,"@metamask/snaps-utils":2245,"@metamask/utils":2361},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function i(e,t){return e.get(a(e,t))}function a(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.LocalLocation=void 0;const r=e("@metamask/snaps-utils"),o=e("@metamask/utils"),c=e("./http.cjs");var l=new WeakMap;function u(e){return(0,o.assert)(e.data.canonicalPath!==undefined),e.data.canonicalPath=`local:${e.data.canonicalPath}`,e}n.LocalLocation=class{constructor(e,t={}){var n,i,u;s(this,l,void 0),(0,o.assertStruct)(e.toString(),r.LocalSnapIdStruct,"Invalid Snap Id"),(0,o.assert)(t.fetchOptions===undefined,"Currently adding fetch options to local: is unsupported."),n=l,i=this,u=new c.HttpLocation(new URL(e.toString().slice(r.SnapIdPrefixes.local.length)),{...t,fetchOptions:{cache:"no-cache"}}),n.set(a(n,i),u)}async manifest(){return u(await i(l,this).manifest())}async fetch(e){return u(await i(l,this).fetch(e))}get shouldAlwaysReload(){return!0}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/local.cjs"}],[2035,{"./http.cjs":2032,"./local.cjs":2034,"./npm.cjs":2036,"@metamask/utils":2361},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.detectSnapLocation=void 0;const s=e("@metamask/utils"),i=e("./http.cjs"),a=e("./local.cjs"),r=e("./npm.cjs");n.detectSnapLocation=function(e,t){const n=(null==t?void 0:t.allowHttp)??!1,o=(null==t?void 0:t.allowLocal)??!1,c=new URL(e);switch(c.protocol){case"npm:":return new r.NpmLocation(c,t);case"local:":return(0,s.assert)(o,new TypeError("Fetching local snaps is disabled.")),new a.LocalLocation(c,t);case"http:":case"https:":return(0,s.assert)(n,new TypeError("Fetching snaps through http/https is disabled.")),new i.HttpLocation(c,t);default:throw new TypeError(`Unrecognized "${c.protocol}" snap location protocol.`)}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/location.cjs"}],[2036,{"@metamask/snaps-utils":2245,"@metamask/utils":2361,"concat-stream":2044,"get-npm-tarball-url":3712,"readable-stream":4454,"readable-web-to-node-stream":4455,"tar-stream":2048},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){i(e,t),t.set(e,n)}function i(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t,n){return e.set(c(e,t),n),n}function o(e,t){return e.get(c(e,t))}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var l=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.getNpmCanonicalBasePath=n.fetchNpmMetadata=n.NpmLocation=n.TARBALL_SIZE_SAFETY_LIMIT=n.BaseNpmLocation=n.DEFAULT_NPM_REGISTRY=void 0;const u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),h=l(e("concat-stream")),p=l(e("get-npm-tarball-url")),m=e("readable-stream"),f=e("readable-web-to-node-stream"),g=e("tar-stream");n.DEFAULT_NPM_REGISTRY=new URL("https://registry.npmjs.org");var y=new WeakMap,w=new WeakMap,S=new WeakSet;class b{constructor(e,t={}){var r,o;i(r=this,o=S),o.add(r),a(this,"meta",void 0),s(this,y,void 0),s(this,w,void 0);const c=t.allowCustomRegistries??!1,l=t.fetch??globalThis.fetch.bind(undefined),h=t.versionRange??u.DEFAULT_REQUESTED_SNAP_VERSION,p=t.resolveVersion??(async e=>e);let m;(0,d.assertStruct)(e.toString(),u.NpmSnapIdStruct,"Invalid Snap Id: "),""===e.host&&""===e.port&&""===e.username&&""===e.password?m=n.DEFAULT_NPM_REGISTRY:(m="https://",e.username&&(m+=e.username,e.password&&(m+=`:${e.password}`),m+="@"),m+=e.host,m=new URL(m),(0,d.assert)(c,new TypeError(`Custom NPM registries are disabled, tried to use "${m.toString()}".`))),(0,d.assert)("/"===m.pathname&&""===m.search&&""===m.hash),(0,d.assert)(""!==e.pathname&&"/"!==e.pathname,new TypeError("The package name in NPM location is empty."));let f=e.pathname;f.startsWith("/")&&(f=f.slice(1)),this.meta={requestedRange:h,registry:m,packageName:f,fetch:l,resolveVersion:p}}async manifest(){if(o(y,this))return o(y,this).clone();const e=await this.fetch("snap.manifest.json"),t=(0,u.parseJson)(e.toString());return e.result=(0,u.createSnapManifest)(t),r(y,this,e),this.manifest()}async fetch(e){const t=(0,u.normalizeRelative)(e);o(w,this)||(await c(S,this,v).call(this),(0,d.assert)(o(w,this)!==undefined));const n=o(w,this).get(t);return(0,d.assert)(n!==undefined,new TypeError(`File "${e}" not found in package.`)),n.clone()}get packageName(){return this.meta.packageName}get version(){return(0,d.assert)(this.meta.version!==undefined,"Tried to access version without first fetching NPM package."),this.meta.version}get registry(){return this.meta.registry}get versionRange(){return this.meta.requestedRange}}async function v(){(0,d.assert)(o(w,this)===undefined);const e=await this.meta.resolveVersion(this.meta.requestedRange),{tarballURL:t,targetVersion:n}=await async function(e,t,n,s){var i;if(_(n)&&(0,d.isValidSemVerVersion)(t))return{tarballURL:(0,p.default)(e,t),targetVersion:t};const a=await T(e,n,s),r=Object.keys((null==a?void 0:a.versions)??{}).map(e=>((0,d.assertIsSemVerVersion)(e),e)),o=(0,u.getTargetVersion)(r,t);if(null===o)throw new Error(`Failed to find a matching version in npm metadata for package "${e}" and requested semver range "${t}".`);const c=null==a||null===(i=a.versions)||void 0===i||null===(i=i[o])||void 0===i||null===(i=i.dist)||void 0===i?void 0:i.tarball;return{tarballURL:c,targetVersion:o}}(this.meta.packageName,e,this.meta.registry,this.meta.fetch);if(!(0,u.isValidUrl)(t)||!t.toString().endsWith(".tgz"))throw new Error(`Failed to find valid tarball URL in NPM metadata for package "${this.meta.packageName}".`);const s=new URL(t);s.hostname=this.meta.registry.hostname,s.protocol=this.meta.registry.protocol;const i=await this.fetchNpmTarball(s);r(w,this,i),this.meta.version=n}n.BaseNpmLocation=b,n.TARBALL_SIZE_SAFETY_LIMIT=262144e3;async function T(e,t,n){const s=await n(new URL(e,t).toString(),{headers:{accept:_(t)?"application/vnd.npm.install-v1+json; q=1.0, application/json; q=0.8, */*":"application/json"}});if(!s.ok)throw new Error(`Failed to fetch NPM registry entry. Status code: ${s.status}.`);const i=await s.json();if(!(0,d.isObject)(i))throw new Error(`Failed to fetch package "${e}" metadata from npm.`);return i}function k(e,t){let n="npm://";return""!==e.username&&(n+=e.username,""!==e.password&&(n+=`:${e.password}`),n+="@"),`${n}${e.host}/${t}/`}function _(e){return e.toString()===n.DEFAULT_NPM_REGISTRY.toString()}n.NpmLocation=class extends b{async fetchNpmTarball(e){const t=await this.meta.fetch(e.toString());if(!t.ok||!t.body)throw new Error(`Failed to fetch tarball for package "${this.meta.packageName}".`);const s=t.headers.get("content-length");(0,d.assert)(s,"Snap tarball has invalid content-length");const i=parseInt(s,10);return(0,d.assert)(i<=n.TARBALL_SIZE_SAFETY_LIMIT,"Snap tarball exceeds size limit"),new Promise((e,s)=>{const i=new Map,a=function(e,t){(0,d.assert)(e.endsWith("/"),"Base needs to end with '/' for relative paths to be added as children instead of siblings."),(0,d.assert)(e.startsWith("npm:"),'Protocol mismatch, expected "npm:".');const s=(0,g.extract)();let i=0;return s.on("entry",(a,r,o)=>{const{name:c,type:l}=a;if("file"===l){const a=c.replace(E,"");return r.pipe((0,h.default)({encoding:"uint8array"},r=>{try{i+=r.byteLength,(0,d.assert)(i<n.TARBALL_SIZE_SAFETY_LIMIT,`Snap tarball exceeds limit of ${n.TARBALL_SIZE_SAFETY_LIMIT} bytes.`);const s=new u.VirtualFile({value:r,path:a,data:{canonicalPath:new URL(a,e).toString()}});return(0,d.assert)(!t.has(a),"Malformed tarball, multiple files with the same path."),t.set(a,s),o()}catch(e){return s.destroy(e)}}))}return r.on("end",()=>o()),r.resume()}),s}(k(this.meta.registry,this.meta.packageName),i),r=t.body,o=new DecompressionStream("gzip"),c=r.pipeThrough(o);(0,m.pipeline)(function(e){if("function"!=typeof e.getReader)return e;return new f.ReadableWebToNodeStream(e)}(c),a,t=>{t?s(t):e(i)})})}},n.fetchNpmMetadata=T,n.getNpmCanonicalBasePath=k;const E=/^package\//u}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/location/npm.cjs"}],[2037,{"./json.cjs":2038,"./registry.cjs":2039},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},i=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),i(e("./registry.cjs"),n),i(e("./json.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/index.cjs"}],[2038,{"./registry.cjs":2039,"@metamask/base-controller":1238,"@metamask/snaps-registry":2054,"@metamask/snaps-utils":2245,"@metamask/utils":2361},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){i(e,t),t.set(e,n)}function i(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t){return e.get(o(e,t))}function r(e,t,n){return e.set(o(e,t),n),n}function o(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.JsonSnapsRegistry=void 0;const c=e("@metamask/base-controller"),l=e("@metamask/snaps-registry"),u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),h=e("./registry.cjs"),p={database:null,lastUpdated:null,databaseUnavailable:!1};var m=new WeakMap,f=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,S=new WeakMap,b=new WeakSet;class v extends c.BaseController{constructor({messenger:e,state:t,url:n={registry:"https://acl.execution.metamask.io/latest/registry.json",signature:"https://acl.execution.metamask.io/latest/signature.json"},publicKey:a="0x025b65308f0f0fb8bc7f7ff87bfc296e0330eee5d3c1d1ee4a048b2fd6a86fa0a6",fetchFunction:c=globalThis.fetch.bind(undefined),recentFetchThreshold:l=(0,d.inMilliseconds)(5,d.Duration.Minute),refetchOnAllowlistMiss:u=!0}){var h,v;super({messenger:e,metadata:{database:{persist:!0,anonymous:!1},lastUpdated:{persist:!0,anonymous:!1},databaseUnavailable:{persist:!0,anonymous:!1}},name:"SnapsRegistry",state:{...p,...t}}),i(h=this,v=b),v.add(h),s(this,m,void 0),s(this,f,void 0),s(this,g,void 0),s(this,y,void 0),s(this,w,void 0),s(this,S,void 0),r(m,this,n),r(f,this,a),r(g,this,c),r(y,this,l),r(w,this,u),r(S,this,null),this.messagingSystem.registerActionHandler("SnapsRegistry:get",async(...e)=>o(b,this,P).call(this,...e)),this.messagingSystem.registerActionHandler("SnapsRegistry:getMetadata",(...e)=>o(b,this,I).call(this,...e)),this.messagingSystem.registerActionHandler("SnapsRegistry:resolveVersion",async(...e)=>o(b,this,A).call(this,...e)),this.messagingSystem.registerActionHandler("SnapsRegistry:update",async()=>o(b,this,k).call(this))}}function T(){return this.state.lastUpdated&&Date.now()-this.state.lastUpdated<a(y,this)}async function k(){a(S,this)?await a(S,this):(null===a(S,this)&&r(S,this,o(b,this,_).call(this)),await a(S,this),r(S,this,null))}async function _(){if(!o(b,this,T).call(this))try{const[e,t]=await Promise.all([o(b,this,M).call(this,a(m,this).registry),o(b,this,M).call(this,a(m,this).signature)]);o(b,this,O).call(this,e,t),this.update(t=>{t.database=JSON.parse(e),t.lastUpdated=Date.now(),t.databaseUnavailable=!1})}catch{this.update(e=>{e.databaseUnavailable=!0})}}async function E(){return null===this.state.database&&await o(b,this,k).call(this),this.state.database}async function C(e,t,n=!1){var s;const i=await o(b,this,E).call(this),r=null==i?void 0:i.blockedSnaps.find(n=>"id"in n?n.id===e&&(0,d.satisfiesVersionRange)(t.version,n.versionRange):n.checksum===t.checksum);if(r)return{status:h.SnapsRegistryStatus.Blocked,reason:r.reason};const c=null==i?void 0:i.verifiedSnaps[e],l=null==c||null===(s=c.versions)||void 0===s?void 0:s[t.version];return l&&l.checksum===t.checksum?{status:h.SnapsRegistryStatus.Verified}:a(w,this)&&!n?(await o(b,this,k).call(this),o(b,this,C).call(this,e,t,!0)):{status:this.state.databaseUnavailable?h.SnapsRegistryStatus.Unavailable:h.SnapsRegistryStatus.Unverified}}async function P(e){return Object.entries(e).reduce(async(e,[t,n])=>{const s=await o(b,this,C).call(this,t,n),i=await e;return i[t]=s,i},Promise.resolve({}))}async function A(e,t,n=!1){var s;const i=await o(b,this,E).call(this),r=(null==i||null===(s=i.verifiedSnaps[e])||void 0===s?void 0:s.versions)??null;if(!r&&a(w,this)&&!n)return await o(b,this,k).call(this),o(b,this,A).call(this,e,t,!0);if(!r)return t;const c=(0,u.getTargetVersion)(Object.keys(r),t);return c||!a(w,this)||n?c?((0,d.assertIsSemVerRange)(c),c):t:(await o(b,this,k).call(this),o(b,this,A).call(this,e,t,!0))}function I(e){var t;return(null===(t=this.state)||void 0===t||null===(t=t.database)||void 0===t||null===(t=t.verifiedSnaps[e])||void 0===t?void 0:t.metadata)??null}function O(e,t){(0,d.assert)(a(f,this),"No public key provided.");const n=(0,l.verify)({registry:e,signature:JSON.parse(t),publicKey:a(f,this)});(0,d.assert)(n,"Invalid registry signature.")}async function M(e){const t=await a(g,this).call(this,e);if(!t.ok)throw new Error(`Failed to fetch ${e}.`);return await t.text()}n.JsonSnapsRegistry=v}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/json.cjs"}],[2039,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s;Object.defineProperty(n,"__esModule",{value:!0}),n.SnapsRegistryStatus=void 0,function(e){e[e.Unverified=0]="Unverified",e[e.Blocked=1]="Blocked",e[e.Verified=2]="Verified",e[e.Unavailable=3]="Unavailable"}(s||(n.SnapsRegistryStatus=s={}))}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/registry/registry.cjs"}],[204,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.UNISWAP_ROUTER_COMMANDS=void 0;n.UNISWAP_ROUTER_COMMANDS={0:{name:"V3_SWAP_EXACT_IN",params:[{type:"address",description:"The recipient of the output of the trade",name:"recipient"},{type:"uint256",description:"The amount of input tokens for the trade",name:"amountIn"},{type:"uint256",description:"The minimum amount of output tokens the user wants",name:"amountOutMin"},{type:"bytes",description:"The UniswapV3 encoded path to trade along",name:"path"},{type:"bool",description:"A flag for whether the input tokens should come from the msg.sender (through Permit2) or whether the funds are already in the UniversalRouter",name:"payerIsUser"}]},1:{name:"V3_SWAP_EXACT_OUT",params:[{type:"address",description:"The recipient of the output of the trade",name:"recipient"},{type:"uint256",description:"The amount of output tokens to receive",name:"amountOut"},{type:"uint256",description:"The maximum number of input tokens that should be spent",name:"amountInMax"},{type:"bytes",description:"The UniswapV3 encoded path to trade along",name:"path"},{type:"bool",description:"A flag for whether the input tokens should come from the msg.sender (through Permit2) or whether the funds are already in the UniversalRouter",name:"payerIsUser"}]},2:{name:"PERMIT2_TRANSFER_FROM",params:[{type:"address",description:"The token to fetch from Permit2",name:"token"},{type:"address",description:"The recipient of the tokens fetched",name:"recipient"},{type:"uint256",description:"The amount of token to fetch",name:"amount"}]},3:{name:"PERMIT2_PERMIT_BATCH",params:[{type:"bytes",description:"A PermitBatch struct outlining all of the Permit2 permits to execute.",name:"batch"},{type:"bytes",description:"The signature to provide to Permit2",name:"data"}]},4:{name:"SWEEP",params:[{type:"address",description:"The ERC20 token to sweep (or Constants.ETH for ETH)",name:"token"},{type:"address",description:"The recipient of the sweep",name:"recipient"},{type:"uint256",description:"The minimum required tokens to receive from the sweep",name:"amountMin"}]},5:{name:"TRANSFER",params:[{type:"address",description:"The ERC20 token to transfer (or Constants.ETH for ETH)",name:"token"},{type:"address",description:"The recipient of the transfer",name:"recipient"},{type:"uint256",description:"The amount to transfer",name:"value"}]},6:{name:"PAY_PORTION",params:[{type:"address",description:"The ERC20 token to transfer (or Constants.ETH for ETH)",name:"token"},{type:"address",description:"The recipient of the transfer",name:"recipient"},{type:"uint256",description:"In basis points, the percentage of the contract’s balance to transfer",name:"bips"}]},8:{name:"V2_SWAP_EXACT_IN",params:[{type:"address",description:"The recipient of the output of the trade",name:"recipient"},{type:"uint256",description:"The amount of input tokens for the trade",name:"amountIn"},{type:"uint256",description:"The minimum amount of output tokens the user wants",name:"amountOutMin"},{type:"address[]",description:"The UniswapV2 token path to trade along",name:"path"},{type:"bool",description:"A flag for whether the input tokens should come from the msg.sender (through Permit2) or whether the funds are already in the UniversalRouter",name:"payerIsUser"}]},9:{name:"V2_SWAP_EXACT_OUT",params:[{type:"address",description:"The recipient of the output of the trade",name:"recipient"},{type:"uint256",description:"The amount of output tokens to receive",name:"amountOut"},{type:"uint256",description:"The maximum number of input tokens that should be spent",name:"amountInMax"},{type:"address[]",description:"The UniswapV2 token path to trade along",name:"path"},{type:"bool",description:"A flag for whether the input tokens should come from the msg.sender (through Permit2) or whether the funds are already in the UniversalRouter",name:"payerIsUser"}]},10:{name:"PERMIT2_PERMIT",params:[{type:"bytes",description:"A PermitSingle struct outlining the Permit2 permit to execute",name:"permitSingle"},{type:"bytes",description:"The signature to provide to Permit2",name:"signature"}]},11:{name:"WRAP_ETH",params:[{type:"address",description:"The recipient of the WETH",name:"recipient"},{type:"uint256",description:"The amount of ETH to wrap",name:"amountMin"}]},12:{name:"UNWRAP_WETH",params:[{type:"address",description:"The recipient of the ETH",name:"recipient"},{type:"uint256",description:"The minimum required ETH to receive from the unwrapping",name:"amountMin"}]},13:{name:"PERMIT2_TRANSFER_FROM_BATCH",params:[{type:"bytes",description:"An array of AllowanceTransferDetails structs that each describe a Permit2 transfer to perform",name:"batchDetails"}]},16:{name:"SEAPORT",params:[{type:"uint256",description:"The ETH value to forward to the Seaport contract",name:"value"},{type:"bytes",description:"The calldata to use to call the Seaport contract",name:"data"}]},17:{name:"LOOKS_RARE_721",params:[{type:"uint256",description:"The ETH value to forward to the LooksRare contract",name:"value"},{type:"bytes",description:"The calldata to use to call the LooksRare contract",name:"data"},{type:"address",description:"The recipient of the ERC721",name:"recipient"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC721",name:"id"}]},18:{name:"NFTX",params:[{type:"uint256",description:"The ETH value to forward to the NFTX contract",name:"value"},{type:"bytes",description:"The calldata to use to call the NFTX contract",name:"data"}]},19:{name:"CRYPTOPUNKS",params:[{type:"uint256",description:"The PunkID to purchase",name:"punkId"},{type:"address",description:"The recipient for the cryptopunk",name:"recipient"},{type:"uint256",description:"The ETH value to forward to the Cryptopunks contract",name:"value"}]},20:{name:"LOOKS_RARE_1155",params:[{type:"uint256",description:"The ETH value to forward to the LooksRare contract",name:"value"},{type:"bytes",description:"The calldata to use to call the LooksRare contract",name:"data"},{type:"address",description:"The recipient of the ERC1155",name:"recipient"},{type:"address",description:"The ERC1155 token address",name:"token"},{type:"uint256",description:"The ID of the ERC1155",name:"id"},{type:"uint256",description:"The amount of the ERC1155 to transfer",name:"amount"}]},21:{name:"OWNER_CHECK_721",params:[{type:"address",description:"The required owner of the ERC721",name:"owner"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC721",name:"id"}]},22:{name:"OWNER_CHECK_1155",params:[{type:"address",description:"The required owner of the ERC1155",name:"owner"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC1155",name:"id"},{type:"uint256",description:"The minimum required amount of the ERC1155",name:"minBalance"}]},23:{name:"SWEEP_ERC721",params:[{type:"address",description:"The ERC721 token address to transfer",name:"token"},{type:"address",description:"The recipient of the transfer",name:"recipient"},{type:"uint256",description:"The token ID to transfer",name:"id"}]},24:{name:"X2Y2_721",params:[{type:"uint256",description:"The ETH value to forward to the X2Y2 contract",name:"value"},{type:"bytes",description:"The calldata to use to call the X2Y2 contract",name:"data"},{type:"address",description:"The recipient of the ERC721",name:"recipient"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC721",name:"id"}]},25:{name:"SUDOSWAP",params:[{type:"uint256",description:"The ETH value to forward to the Sudoswap contract",name:"value"},{type:"bytes",description:"The calldata to use to call the Sudoswap contract",name:"data"}]},26:{name:"NFT20",params:[{type:"uint256",description:"The ETH value to forward to the NFT20 contract",name:"value"},{type:"bytes",description:"The calldata to use to call the NFT20 contract",name:"data"}]},27:{name:"X2Y2_1155",params:[{type:"uint256",description:"The ETH value to forward to the X2Y2 contract",name:"value"},{type:"bytes",description:"The calldata to use to call the X2Y2 contract",name:"data"},{type:"address",description:"The recipient of the ERC1155",name:"recipient"},{type:"address",description:"The ERC1155 token address",name:"token"},{type:"uint256",description:"The ID of the ERC1155",name:"id"},{type:"uint256",description:"The amount of the ERC1155 to transfer",name:"amount"}]},28:{name:"FOUNDATION",params:[{type:"uint256",description:"The ETH value to forward to the Foundation contract",name:"value"},{type:"bytes",description:"The calldata to use to call the Foundation contract",name:"data"},{type:"address",description:"The recipient of the ERC721",name:"recipient"},{type:"address",description:"The ERC721 token address",name:"token"},{type:"uint256",description:"The ID of the ERC721",name:"id"}]},29:{name:"SWEEP_ERC1155",params:[{type:"address",description:"The ERC1155 token address to sweep",name:"token"},{type:"address",description:"The recipient of the sweep",name:"recipient"},{type:"uint256",description:"The token ID to sweep",name:"id"},{type:"uint256",description:"The minimum required tokens to receive from the sweep",name:"amount"}]}}}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/uniswap-commands.ts"}],[2040,{},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getRunnableSnaps=void 0;n.getRunnableSnaps=e=>e.filter(e=>e.enabled&&!e.blocked)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/snaps/selectors.cjs"}],[2041,{"./snaps/Timer.cjs":2029,"@metamask/snaps-sdk":2131,"@metamask/snaps-utils":2245,"fast-deep-equal":3659},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(n,"__esModule",{value:!0}),n.isLocalSnapId=n.isTrackableHandler=n.throttleTracking=n.TRACKABLE_HANDLERS=n.debouncePersistState=n.fetchSnap=n.getSnapFiles=n.withTimeout=n.hasTimedOut=n.delayWithTimer=n.delay=n.permissionsDiff=n.setDiff=void 0;const i=e("@metamask/snaps-sdk"),a=e("@metamask/snaps-utils"),r=s(e("fast-deep-equal")),o=e("./snaps/Timer.cjs");function c(e,t){let n;const s=new Promise((s,i)=>{e.start(()=>{t===undefined?s():s(t)}),n=i});return s.cancel=()=>{"finished"!==e.status&&(e.cancel(),n(new Error("The delay has been canceled.")))},s}async function l(e,t){return t&&0!==t.length?await Promise.all(t.map(async t=>e.fetch(t))):[]}n.setDiff=function(e,t){return Object.entries(e).reduce((e,[n,s])=>(n in t||(e[n]=s),e),{})},n.permissionsDiff=function(e,t){return Object.entries(e).reduce((e,[n,s])=>{const i=n in t;return(!i||i&&!(0,r.default)(s.caveats??[],t[n].caveats??[]))&&(e[n]=s),e},{})},n.delay=function(e,t){return c(new o.Timer(e),t)},n.delayWithTimer=c,n.hasTimedOut=Symbol("Used to check if the requested promise has timeout (see withTimeout)"),n.withTimeout=async function(e,t){const s=c("number"==typeof t?new o.Timer(t):t,n.hasTimedOut);try{return await Promise.race([e,s])}finally{s.cancel()}},n.getSnapFiles=l,n.fetchSnap=async function(e,t){try{const e=await t.manifest(),n=await t.fetch(e.result.source.location.npm.filePath);(0,i.assert)(n.size<a.MAX_FILE_SIZE,"Snap source code must be smaller than 64 MB.");const{iconPath:s}=e.result.source.location.npm,r=s?await t.fetch(s):undefined,o=await l(t,e.result.source.files);(0,a.validateAuxiliaryFiles)(o),await Promise.all(o.map(async e=>{e.data.base64=await(0,a.encodeBase64)(e)}));const c=await l(t,e.result.source.locales),u={manifest:e,sourceCode:n,svgIcon:r,auxiliaryFiles:o,localizationFiles:(0,a.getValidatedLocalizationFiles)(c)};return await(0,a.validateFetchedSnap)(u),u}catch(t){throw new Error(`Failed to fetch snap "${e}": ${(0,i.getErrorMessage)(t)}.`)}},n.debouncePersistState=function(e,t=1e3){const n=new Map;return(s,i,a)=>{const r=`${s}-${a}`;n.has(r)&&clearTimeout(n.get(r)),n.set(r,setTimeout(()=>{e(s,i,a),n.delete(r)},t))}},n.TRACKABLE_HANDLERS=Object.freeze([a.HandlerType.OnHomePage,a.HandlerType.OnInstall,a.HandlerType.OnNameLookup,a.HandlerType.OnRpcRequest,a.HandlerType.OnSignature,a.HandlerType.OnTransaction,a.HandlerType.OnUpdate]),n.throttleTracking=function(e,t=6e4){const n=new Map,s=new Map;return(i,a,r,o)=>{const c=`${i}${a}${r}${o}`,l=Date.now(),u=n.get(c)??0,d=[i,a,r,o];if(l-u>=t)return n.set(c,l),void e(...d);const h=s.get(c);null!=h&&h.timer&&clearTimeout(h.timer),n.set(c,l),s.set(c,{args:d,timer:setTimeout(()=>{e(...d),s.delete(c)},t)})}},n.isTrackableHandler=function(e){return n.TRACKABLE_HANDLERS.includes(e)},n.isLocalSnapId=function(e){return e.startsWith("local:")}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/utils.cjs"}],[2042,{"../snaps/index.cjs":2031,"@metamask/rpc-errors":1958,"@metamask/snaps-utils":2245,"@metamask/utils":2361,nanoid:4198},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){function s(e,t,n){i(e,t),t.set(e,n)}function i(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function a(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){return e.get(c(e,t))}function o(e,t,n){return e.set(c(e,t),n),n}function c(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}Object.defineProperty(n,"__esModule",{value:!0}),n.WebSocketService=void 0;const l=e("@metamask/rpc-errors"),u=e("@metamask/snaps-utils"),d=e("@metamask/utils"),h=e("nanoid"),p=e("../snaps/index.cjs"),m="WebSocketService";var f=new WeakMap,g=new WeakMap,y=new WeakSet;function w(e,t){const n=r(g,this).get(t);return(0,d.assert)(n&&n.snapId===e,`Socket with ID "${t}" not found.`),n}function S(e,t,n){return c(y,this,E).call(this,e).some(e=>e.url===t&&(0,u.isEqual)(e.protocols,n))}function b(e,t){r(f,this).call("SnapController:handleRequest",{origin:p.METAMASK_ORIGIN,snapId:e,handler:u.HandlerType.OnWebSocketEvent,request:{method:"",params:{event:t}}}).catch(t=>{(0,u.logError)(`An error occurred while handling a WebSocket message for Snap "${e}":`,t)})}async function v(e,t,n=[]){(0,d.assert)(!c(y,this,S).call(this,e,t,n),`An open WebSocket connection to ${t} already exists.`);const s=new URL(t),{origin:i}=s,a=(0,h.nanoid)(),o=new WebSocket(t,n);o.binaryType="arraybuffer";const{promise:u,resolve:p,reject:m}=(0,d.createDeferredPromise)();o.addEventListener("open",()=>{p(),c(y,this,b).call(this,e,{type:"open",id:a,origin:i})}),o.addEventListener("close",t=>{r(g,this).delete(a),c(y,this,b).call(this,e,{type:"close",id:a,origin:i,code:t.code,reason:t.reason,wasClean:t.wasClean??null})});const f=()=>{m(l.rpcErrors.resourceUnavailable("An error occurred while opening the WebSocket."))};return o.addEventListener("error",f),o.addEventListener("message",t=>{const n="string"==typeof t.data?{type:"text",message:t.data}:{type:"binary",message:Array.from(new Uint8Array(t.data))};c(y,this,b).call(this,e,{type:"message",id:a,origin:i,data:n})}),r(g,this).set(a,{id:a,snapId:e,url:t,protocols:n,socket:o,openPromise:u}),await u,o.removeEventListener("error",f),a}function T(e,t){const{socket:n}=c(y,this,w).call(this,e,t);n.close()}function k(e){for(const t of c(y,this,E).call(this,e))c(y,this,T).call(this,e,t.id)}async function _(e,t,n){const{socket:s,openPromise:i}=c(y,this,w).call(this,e,t);await i;const a=Array.isArray(n)?new Uint8Array(n):n;s.send(a)}function E(e){return[...r(g,this).values()].filter(t=>t.snapId===e).map(e=>({id:e.id,url:e.url,protocols:e.protocols}))}n.WebSocketService=class{constructor({messenger:e}){var t,n;i(t=this,n=y),n.add(t),a(this,"name",m),a(this,"state",null),s(this,f,void 0),s(this,g,void 0),o(f,this,e),o(g,this,new Map),r(f,this).registerActionHandler(`${m}:open`,async(...e)=>c(y,this,v).call(this,...e)),r(f,this).registerActionHandler(`${m}:close`,(...e)=>c(y,this,T).call(this,...e)),r(f,this).registerActionHandler(`${m}:sendMessage`,async(...e)=>c(y,this,_).call(this,...e)),r(f,this).registerActionHandler(`${m}:getAll`,(...e)=>c(y,this,E).call(this,...e)),r(f,this).subscribe("SnapController:snapUpdated",e=>{c(y,this,k).call(this,e.id)}),r(f,this).subscribe("SnapController:snapUninstalled",e=>{c(y,this,k).call(this,e.id)}),r(f,this).subscribe("SnapController:snapInstalled",e=>{c(y,this,k).call(this,e.id)})}}}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/websocket/WebSocketService.cjs"}],[2043,{"./WebSocketService.cjs":2042},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=Object.create?function(e,t,n,s){s===undefined&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]},i=function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),i(e("./WebSocketService.cjs"),n)}}},{package:"@metamask/snaps-controllers",file:"node_modules/@metamask/snaps-controllers/dist/websocket/index.cjs"}],[2044,{buffer:3318,"buffer-from":3324,inherits:3884,"readable-stream":4454,typedarray:4874},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){(function(n){(function(){var s=e("readable-stream").Writable,i=e("inherits"),a=e("buffer-from");if("undefined"==typeof Uint8Array)var r=e("typedarray").Uint8Array;else r=Uint8Array;function o(e,t){if(!(this instanceof o))return new o(e,t);"function"==typeof e&&(t=e,e={}),e||(e={});var n=e.encoding,i=!1;n?"u8"!==(n=String(n).toLowerCase())&&"uint8"!==n||(n="uint8array"):i=!0,s.call(this,{objectMode:!0}),this.encoding=n,this.shouldInferEncoding=i,t&&this.on("finish",function(){t(this.getBody())}),this.body=[]}t.exports=o,i(o,s),o.prototype._write=function(e,t,n){this.body.push(e),n()},o.prototype.inferEncoding=function(e){var t=e===undefined?this.body[0]:e;return n.isBuffer(t)?"buffer":"undefined"!=typeof Uint8Array&&t instanceof Uint8Array?"uint8array":Array.isArray(t)?"array":"string"==typeof t?"string":"[object Object]"===Object.prototype.toString.call(t)?"object":"buffer"},o.prototype.getBody=function(){return this.encoding||0!==this.body.length?(this.shouldInferEncoding&&(this.encoding=this.inferEncoding()),"array"===this.encoding?function(e){for(var t=[],n=0;n<e.length;n++)t.push.apply(t,e[n]);return t}(this.body):"string"===this.encoding?function(e){for(var t=[],s=0;s<e.length;s++){var i=e[s];"string"==typeof i||n.isBuffer(i)?t.push(i):c(i)?t.push(a(i)):t.push(a(String(i)))}t=n.isBuffer(e[0])?(t=n.concat(t)).toString("utf8"):t.join("");return t}(this.body):"buffer"===this.encoding?function(e){for(var t=[],s=0;s<e.length;s++){var i=e[s];n.isBuffer(i)?t.push(i):c(i)?t.push(a(i)):t.push(a(String(i)))}return n.concat(t)}(this.body):"uint8array"===this.encoding?function(e){for(var t=0,n=0;n<e.length;n++)"string"==typeof e[n]&&(e[n]=a(e[n])),t+=e[n].length;for(var s=new r(t),i=(n=0,0);n<e.length;n++)for(var o=e[n],c=0;c<o.length;c++)s[i++]=o[c];return s}(this.body):this.body):[]};Array.isArray;function c(e){return"string"==typeof e||(t=e,/Array\]$/.test(Object.prototype.toString.call(t)))||e&&"function"==typeof e.subarray;var t}}).call(this)}).call(this,e("buffer").Buffer)}}},{package:"@metamask/snaps-controllers>concat-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/concat-stream/index.js"}],[2045,{fs:3270},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){const s={S_IFMT:61440,S_IFDIR:16384,S_IFCHR:8192,S_IFBLK:24576,S_IFIFO:4096,S_IFLNK:40960};try{t.exports=e("fs").constants||s}catch{t.exports=s}}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/tar-stream/constants.js"}],[2046,{"./headers":2047,b4a:3199,"fast-fifo":3661,streamx:4853},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){const{Writable:s,Readable:i,getStreamError:a}=e("streamx"),r=e("fast-fifo"),o=e("b4a"),c=e("./headers"),l=o.alloc(0);class u{constructor(){this.buffered=0,this.shifted=0,this.queue=new r,this._offset=0}push(e){this.buffered+=e.byteLength,this.queue.push(e)}shiftFirst(e){return 0===this._buffered?null:this._next(e)}shift(e){if(e>this.buffered)return null;if(0===e)return l;let t=this._next(e);if(e===t.byteLength)return t;const n=[t];for(;(e-=t.byteLength)>0;)t=this._next(e),n.push(t);return o.concat(n)}_next(e){const t=this.queue.peek(),n=t.byteLength-this._offset;if(e>=n){const e=this._offset?t.subarray(this._offset,t.byteLength):t;return this.queue.shift(),this._offset=0,this.buffered-=n,this.shifted+=n,e}return this.buffered-=e,this.shifted+=e,t.subarray(this._offset,this._offset+=e)}}class d extends i{constructor(e,t,n){super(),this.header=t,this.offset=n,this._parent=e}_read(e){0===this.header.size&&this.push(null),this._parent._stream===this&&this._parent._update(),e(null)}_predestroy(){this._parent.destroy(a(this))}_detach(){this._parent._stream===this&&(this._parent._stream=null,this._parent._missing=m(this.header.size),this._parent._update())}_destroy(e){this._detach(),e(null)}}class h extends s{constructor(e){super(e),e||(e={}),this._buffer=new u,this._offset=0,this._header=null,this._stream=null,this._missing=0,this._longHeader=!1,this._callback=p,this._locked=!1,this._finished=!1,this._pax=null,this._paxGlobal=null,this._gnuLongPath=null,this._gnuLongLinkPath=null,this._filenameEncoding=e.filenameEncoding||"utf-8",this._allowUnknownFormat=!!e.allowUnknownFormat,this._unlockBound=this._unlock.bind(this)}_unlock(e){if(this._locked=!1,e)return this.destroy(e),void this._continueWrite(e);this._update()}_consumeHeader(){if(this._locked)return!1;this._offset=this._buffer.shifted;try{this._header=c.decode(this._buffer.shift(512),this._filenameEncoding,this._allowUnknownFormat)}catch(e){return this._continueWrite(e),!1}if(!this._header)return!0;switch(this._header.type){case"gnu-long-path":case"gnu-long-link-path":case"pax-global-header":case"pax-header":return this._longHeader=!0,this._missing=this._header.size,!0}return this._locked=!0,this._applyLongHeaders(),0===this._header.size||"directory"===this._header.type?(this.emit("entry",this._header,this._createStream(),this._unlockBound),!0):(this._stream=this._createStream(),this._missing=this._header.size,this.emit("entry",this._header,this._stream,this._unlockBound),!0)}_applyLongHeaders(){this._gnuLongPath&&(this._header.name=this._gnuLongPath,this._gnuLongPath=null),this._gnuLongLinkPath&&(this._header.linkname=this._gnuLongLinkPath,this._gnuLongLinkPath=null),this._pax&&(this._pax.path&&(this._header.name=this._pax.path),this._pax.linkpath&&(this._header.linkname=this._pax.linkpath),this._pax.size&&(this._header.size=parseInt(this._pax.size,10)),this._header.pax=this._pax,this._pax=null)}_decodeLongHeader(e){switch(this._header.type){case"gnu-long-path":this._gnuLongPath=c.decodeLongPath(e,this._filenameEncoding);break;case"gnu-long-link-path":this._gnuLongLinkPath=c.decodeLongPath(e,this._filenameEncoding);break;case"pax-global-header":this._paxGlobal=c.decodePax(e);break;case"pax-header":this._pax=null===this._paxGlobal?c.decodePax(e):Object.assign({},this._paxGlobal,c.decodePax(e))}}_consumeLongHeader(){this._longHeader=!1,this._missing=m(this._header.size);const e=this._buffer.shift(this._header.size);try{this._decodeLongHeader(e)}catch(e){return this._continueWrite(e),!1}return!0}_consumeStream(){const e=this._buffer.shiftFirst(this._missing);if(null===e)return!1;this._missing-=e.byteLength;const t=this._stream.push(e);return 0===this._missing?(this._stream.push(null),t&&this._stream._detach(),t&&!1===this._locked):t}_createStream(){return new d(this,this._header,this._offset)}_update(){for(;this._buffer.buffered>0&&!this.destroying;){if(this._missing>0){if(null!==this._stream){if(!1===this._consumeStream())return;continue}if(!0===this._longHeader){if(this._missing>this._buffer.buffered)break;if(!1===this._consumeLongHeader())return!1;continue}const e=this._buffer.shiftFirst(this._missing);null!==e&&(this._missing-=e.byteLength);continue}if(this._buffer.buffered<512)break;if(null!==this._stream||!1===this._consumeHeader())return}this._continueWrite(null)}_continueWrite(e){const t=this._callback;this._callback=p,t(e)}_write(e,t){this._callback=t,this._buffer.push(e),this._update()}_final(e){this._finished=0===this._missing&&0===this._buffer.buffered,e(this._finished?null:new Error("Unexpected end of data"))}_predestroy(){this._continueWrite(null)}_destroy(e){this._stream&&this._stream.destroy(a(this)),e(null)}[Symbol.asyncIterator](){let e=null,t=null,n=null,s=null,i=null;const a=this;return this.on("entry",function(e,a,r){i=r,a.on("error",p),t?(t({value:a,done:!1}),t=n=null):s=a}),this.on("error",t=>{e=t}),this.on("close",function(){if(r(e),!t)return;e?n(e):t({value:undefined,done:!0});t=n=null}),{[Symbol.asyncIterator](){return this},next:()=>new Promise(o),return:()=>c(null),throw:e=>c(e)};function r(e){if(!i)return;const t=i;i=null,t(e)}function o(i,o){return e?o(e):s?(i({value:s,done:!1}),void(s=null)):(t=i,n=o,r(null),void(a._finished&&t&&(t({value:undefined,done:!0}),t=n=null)))}function c(e){return a.destroy(e),r(e),new Promise((t,n)=>{if(a.destroyed)return t({value:undefined,done:!0});a.once("close",function(){e?n(e):t({value:undefined,done:!0})})})}}}function p(){}function m(e){return(e&=511)&&512-e}t.exports=function(e){return new h(e)}}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/tar-stream/extract.js"}],[2047,{b4a:3199},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){const s=e("b4a"),i="0".charCodeAt(0),a=s.from([117,115,116,97,114,0]),r=s.from([i,i]),o=s.from([117,115,116,97,114,32]),c=s.from([32,0]),l=257,u=263;function d(e,t,n,s){for(;n<s;n++)if(e[n]===t)return n;return s}function h(e){let t=256;for(let n=0;n<148;n++)t+=e[n];for(let n=156;n<512;n++)t+=e[n];return t}function p(e,t){return(e=e.toString(8)).length>t?"7777777777777777777".slice(0,t)+" ":"0000000000000000000".slice(0,t-e.length)+e+" "}function m(e,t,n){if(128&(e=e.subarray(t,t+n))[t=0])return function(e){let t;if(128===e[0])t=!0;else{if(255!==e[0])return null;t=!1}const n=[];let s;for(s=e.length-1;s>0;s--){const i=e[s];t?n.push(i):n.push(255-i)}let i=0;const a=n.length;for(s=0;s<a;s++)i+=n[s]*Math.pow(256,s);return t?i:-1*i}(e);{for(;t<e.length&&32===e[t];)t++;const n=(i=d(e,32,t,e.length),a=e.length,r=e.length,"number"!=typeof i?r:(i=~~i)>=a?a:i>=0||(i+=a)>=0?i:0);for(;t<n&&0===e[t];)t++;return n===t?0:parseInt(s.toString(e.subarray(t,n)),8)}var i,a,r}function f(e,t,n,i){return s.toString(e.subarray(t,d(e,0,t,t+n)),i)}function g(e){const t=s.byteLength(e);let n=Math.floor(Math.log(t)/Math.log(10))+1;return t+n>=Math.pow(10,n)&&n++,t+n+e}n.decodeLongPath=function(e,t){return f(e,0,e.length,t)},n.encodePax=function(e){let t="";e.name&&(t+=g(" path="+e.name+"\n")),e.linkname&&(t+=g(" linkpath="+e.linkname+"\n"));const n=e.pax;if(n)for(const e in n)t+=g(" "+e+"="+n[e]+"\n");return s.from(t)},n.decodePax=function(e){const t={};for(;e.length;){let n=0;for(;n<e.length&&32!==e[n];)n++;const i=parseInt(s.toString(e.subarray(0,n)),10);if(!i)return t;const a=s.toString(e.subarray(n+1,i-1)),r=a.indexOf("=");if(-1===r)return t;t[a.slice(0,r)]=a.slice(r+1),e=e.subarray(i)}return t},n.encode=function(e){const t=s.alloc(512);let n=e.name,o="";if(5===e.typeflag&&"/"!==n[n.length-1]&&(n+="/"),s.byteLength(n)!==n.length)return null;for(;s.byteLength(n)>100;){const e=n.indexOf("/");if(-1===e)return null;o+=o?"/"+n.slice(0,e):n.slice(0,e),n=n.slice(e+1)}return s.byteLength(n)>100||s.byteLength(o)>155||e.linkname&&s.byteLength(e.linkname)>100?null:(s.write(t,n),s.write(t,p(4095&e.mode,6),100),s.write(t,p(e.uid,6),108),s.write(t,p(e.gid,6),116),function(e,t,n){e.toString(8).length>11?function(e,t,n){t[n]=128;for(let s=11;s>0;s--)t[n+s]=255&e,e=Math.floor(e/256)}(e,t,n):s.write(t,p(e,11),n)}(e.size,t,124),s.write(t,p(e.mtime.getTime()/1e3|0,11),136),t[156]=i+function(e){switch(e){case"file":return 0;case"link":return 1;case"symlink":return 2;case"character-device":return 3;case"block-device":return 4;case"directory":return 5;case"fifo":return 6;case"contiguous-file":return 7;case"pax-header":return 72}return 0}(e.type),e.linkname&&s.write(t,e.linkname,157),s.copy(a,t,l),s.copy(r,t,263),e.uname&&s.write(t,e.uname,265),e.gname&&s.write(t,e.gname,297),s.write(t,p(e.devmajor||0,6),329),s.write(t,p(e.devminor||0,6),337),o&&s.write(t,o,345),s.write(t,p(h(t),6),148),t)},n.decode=function(e,t,n){let r=0===e[156]?0:e[156]-i,d=f(e,0,100,t);const p=m(e,100,8),g=m(e,108,8),y=m(e,116,8),w=m(e,124,12),S=m(e,136,12),b=function(e){switch(e){case 0:return"file";case 1:return"link";case 2:return"symlink";case 3:return"character-device";case 4:return"block-device";case 5:return"directory";case 6:return"fifo";case 7:return"contiguous-file";case 72:return"pax-header";case 55:return"pax-global-header";case 27:return"gnu-long-link-path";case 28:case 30:return"gnu-long-path"}return null}(r),v=0===e[157]?null:f(e,157,100,t),T=f(e,265,32),k=f(e,297,32),_=m(e,329,8),E=m(e,337,8),C=h(e);if(256===C)return null;if(C!==m(e,148,8))throw new Error("Invalid tar header. Maybe the tar is corrupted or it needs to be gunzipped?");if(function(e){return s.equals(a,e.subarray(l,263))}(e))e[345]&&(d=f(e,345,155,t)+"/"+d);else if(function(e){return s.equals(o,e.subarray(l,263))&&s.equals(c,e.subarray(u,265))}(e));else if(!n)throw new Error("Invalid tar header: unknown format.");return 0===r&&d&&"/"===d[d.length-1]&&(r=5),{name:d,mode:p,uid:g,gid:y,size:w,mtime:new Date(1e3*S),type:b,linkname:v,uname:T,gname:k,devmajor:_,devminor:E,pax:null}}}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/tar-stream/headers.js"}],[2048,{"./extract":2046,"./pack":2049},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){n.extract=e("./extract"),n.pack=e("./pack")}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/tar-stream/index.js"}],[2049,{"./constants":2045,"./headers":2047,b4a:3199,streamx:4853},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){const{Readable:s,Writable:i,getStreamError:a}=e("streamx"),r=e("b4a"),o=e("./constants"),c=e("./headers"),l=r.alloc(1024);class u extends i{constructor(e,t,n){super({mapWritable:m,eagerOpen:!0}),this.written=0,this.header=t,this._callback=n,this._linkname=null,this._isLinkname="symlink"===t.type&&!t.linkname,this._isVoid="file"!==t.type&&"contiguous-file"!==t.type,this._finished=!1,this._pack=e,this._openCallback=null,null===this._pack._stream?this._pack._stream=this:this._pack._pending.push(this)}_open(e){this._openCallback=e,this._pack._stream===this&&this._continueOpen()}_continuePack(e){if(null===this._callback)return;const t=this._callback;this._callback=null,t(e)}_continueOpen(){null===this._pack._stream&&(this._pack._stream=this);const e=this._openCallback;if(this._openCallback=null,null!==e){if(this._pack.destroying)return e(new Error("pack stream destroyed"));if(this._pack._finalized)return e(new Error("pack stream is already finalized"));this._pack._stream=this,this._isLinkname||this._pack._encode(this.header),this._isVoid&&(this._finish(),this._continuePack(null)),e(null)}}_write(e,t){return this._isLinkname?(this._linkname=this._linkname?r.concat([this._linkname,e]):e,t(null)):this._isVoid?e.byteLength>0?t(new Error("No body allowed for this entry")):t():(this.written+=e.byteLength,this._pack.push(e)?t():void(this._pack._drain=t))}_finish(){this._finished||(this._finished=!0,this._isLinkname&&(this.header.linkname=this._linkname?r.toString(this._linkname,"utf-8"):"",this._pack._encode(this.header)),p(this._pack,this.header.size),this._pack._done(this))}_final(e){if(this.written!==this.header.size)return e(new Error("Size mismatch"));this._finish(),e(null)}_getError(){return a(this)||new Error("tar entry destroyed")}_predestroy(){this._pack.destroy(this._getError())}_destroy(e){this._pack._done(this),this._continuePack(this._finished?null:this._getError()),e()}}class d extends s{constructor(e){super(e),this._drain=h,this._finalized=!1,this._finalizing=!1,this._pending=[],this._stream=null}entry(e,t,n){if(this._finalized||this.destroying)throw new Error("already finalized or destroyed");"function"==typeof t&&(n=t,t=null),n||(n=h),e.size&&"symlink"!==e.type||(e.size=0),e.type||(e.type=function(e){switch(e&o.S_IFMT){case o.S_IFBLK:return"block-device";case o.S_IFCHR:return"character-device";case o.S_IFDIR:return"directory";case o.S_IFIFO:return"fifo";case o.S_IFLNK:return"symlink"}return"file"}(e.mode)),e.mode||(e.mode="directory"===e.type?493:420),e.uid||(e.uid=0),e.gid||(e.gid=0),e.mtime||(e.mtime=new Date),"string"==typeof t&&(t=r.from(t));const s=new u(this,e,n);return r.isBuffer(t)?(e.size=t.byteLength,s.write(t),s.end(),s):(s._isVoid,s)}finalize(){this._stream||this._pending.length>0?this._finalizing=!0:this._finalized||(this._finalized=!0,this.push(l),this.push(null))}_done(e){e===this._stream&&(this._stream=null,this._finalizing&&this.finalize(),this._pending.length&&this._pending.shift()._continueOpen())}_encode(e){if(!e.pax){const t=c.encode(e);if(t)return void this.push(t)}this._encodePax(e)}_encodePax(e){const t=c.encodePax({name:e.name,linkname:e.linkname,pax:e.pax}),n={name:"PaxHeader",mode:e.mode,uid:e.uid,gid:e.gid,size:t.byteLength,mtime:e.mtime,type:"pax-header",linkname:e.linkname&&"PaxHeader",uname:e.uname,gname:e.gname,devmajor:e.devmajor,devminor:e.devminor};this.push(c.encode(n)),this.push(t),p(this,t.byteLength),n.size=e.size,n.type=e.type,this.push(c.encode(n))}_doDrain(){const e=this._drain;this._drain=h,e()}_predestroy(){const e=a(this);for(this._stream&&this._stream.destroy(e);this._pending.length;){const t=this._pending.shift();t.destroy(e),t._continueOpen()}this._doDrain()}_read(e){this._doDrain(),e()}}function h(){}function p(e,t){(t&=511)&&e.push(l.subarray(0,512-t))}function m(e){return r.isBuffer(e)?e:r.from(e)}t.exports=function(e){return new d(e)}}}},{package:"@metamask/snaps-controllers>tar-stream",file:"node_modules/@metamask/snaps-controllers/node_modules/tar-stream/pack.js"}],[205,{"../../../../../shared/constants/network":4992,"./uniswap-commands":204,"@ethersproject/abi":552,"ethereumjs-util":3575},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.UNISWAP_UNIVERSAL_ROUTER_ADDRESSES=void 0,n.decodeUniswapRouterTransactionData=function({transactionData:e,contractAddress:t,chainId:n}){const a=l[n];if(null==a||!a.map(e=>e.toLowerCase()).includes(t.toLowerCase()))return undefined;const d=new s.Interface(u);let h;try{h=d.parseTransaction({data:e})}catch(e){return undefined}const p=h.args.commands,m=h.args.inputs;return p.slice(2).match(/.{1,2}/gu).map((e,t)=>function(e,t){const n=parseInt(e,16),a=31&n,l=r.UNISWAP_ROUTER_COMMANDS[String(a)];if(!l)return undefined;const u=l.params.map(e=>e.type),d=s.Interface.getAbiCoder().decode(u,t),{name:h}=l,p=l.params.map((e,t)=>{const{name:n,type:s,description:a}=e,r=d[t];return{name:n,type:s,value:"path"===n?function(e){const t=[];let n=(0,i.stripHexPrefix)(e),s={},a=!0;for(;n.length;){if(a){const e=(0,i.addHexPrefix)(n.slice(0,o));s.firstAddress?(s.secondAddress=e,t.push(s),s={firstAddress:e}):s.firstAddress=e,n=n.slice(o)}else s.tickSpacing=parseInt(n.slice(0,c),16),n=n.slice(c);a=!a}return t}(r):r,description:a}});return{name:h,params:p}}(e,m[t])).filter(e=>e!==undefined)};var s=e("@ethersproject/abi"),i=e("ethereumjs-util"),a=e("../../../../../shared/constants/network"),r=e("./uniswap-commands");const o=40,c=6,l=n.UNISWAP_UNIVERSAL_ROUTER_ADDRESSES={[a.CHAIN_IDS.ARBITRUM]:["0x4C60051384bd2d3C01bfc845Cf5F4b44bcbE9de5","0xeC8B0F7Ffe3ae75d7FfAb09429e3675bb63503e4","0x5E325eDA8064b456f4781070C0738d849c824258"],[a.CHAIN_IDS.AVALANCHE]:["0x82635AF6146972cD6601161c4472ffe97237D292","0x4Dae2f939ACf50408e13d58534Ff8c2776d45265"],[a.CHAIN_IDS.BASE]:["0xeC8B0F7Ffe3ae75d7FfAb09429e3675bb63503e4","0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD"],[a.CHAIN_IDS.BSC]:["0x5Dc88340E1c5c6366864Ee415d6034cadd1A9897","0xeC8B0F7Ffe3ae75d7FfAb09429e3675bb63503e4","0x4Dae2f939ACf50408e13d58534Ff8c2776d45265"],[a.CHAIN_IDS.MAINNET]:["0xEf1c6E67703c7BD7107eed8303Fbe6EC2554BF6B","0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD"],[a.CHAIN_IDS.OPTIMISM]:["0xb555edF5dcF85f42cEeF1f3630a52A108E55A654","0xeC8B0F7Ffe3ae75d7FfAb09429e3675bb63503e4","0xCb1355ff08Ab38bBCE60111F1bb2B784bE25D7e8"],[a.CHAIN_IDS.POLYGON]:["0x4C60051384bd2d3C01bfc845Cf5F4b44bcbE9de5","0x643770E279d5D0733F21d6DC03A8efbABf3255B4","0xec7BE89e9d109e7e3Fec59c222CF297125FEFda2"],[a.CHAIN_IDS.SEPOLIA]:["0x3fC91A3afd70395Cd496C647d5a6CC9D4B2b7FAD"]},u=[{constant:!0,inputs:[{name:"commands",type:"bytes"},{name:"inputs",type:"bytes[]"},{name:"deadline",type:"uint256"}],name:"execute",type:"function"},{constant:!0,inputs:[{name:"commands",type:"bytes"},{name:"inputs",type:"bytes[]"}],name:"execute",type:"function"}]}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/uniswap.ts"}],[2054,{"./verify":2055,"@metamask/superstruct":2267,"@metamask/utils":2361},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){var s=this&&this.__createBinding||(Object.create?function(e,t,n,s){s===undefined&&(s=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,s,i)}:function(e,t,n,s){s===undefined&&(s=n),e[s]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||s(t,e,n)};Object.defineProperty(n,"__esModule",{value:!0}),n.SnapsRegistryDatabaseStruct=n.BlockedSnapStruct=n.BlockReasonStruct=n.VerifiedSnapStruct=n.ImagePathStruct=n.AdditionalSourceCodeStruct=n.SupportStruct=n.AuditStruct=n.AuthorStruct=void 0;const a=e("@metamask/superstruct"),r=e("@metamask/utils"),o=(0,a.refine)((0,a.string)(),"Npm ID",e=>e.startsWith("npm:")),c=(0,a.object)({checksum:r.ChecksumStruct});n.AuthorStruct=(0,a.object)({name:(0,a.string)(),website:(0,a.string)()}),n.AuditStruct=(0,a.object)({auditor:(0,a.string)(),report:(0,a.string)()}),n.SupportStruct=(0,a.object)({knowledgeBase:(0,a.optional)((0,a.string)()),faq:(0,a.optional)((0,a.string)()),contact:(0,a.optional)((0,a.string)()),keyRecovery:(0,a.optional)((0,a.string)())}),n.AdditionalSourceCodeStruct=(0,a.object)({name:(0,a.string)(),url:(0,a.string)()}),n.ImagePathStruct=(0,a.pattern)((0,a.string)(),/\.\/images\/.*\/\d+\.(?:png|jpe?g)$/u),n.VerifiedSnapStruct=(0,a.object)({id:o,metadata:(0,a.object)({name:(0,a.string)(),type:(0,a.optional)((0,a.enums)(["account"])),author:(0,a.optional)(n.AuthorStruct),website:(0,a.optional)((0,a.string)()),onboard:(0,a.optional)((0,a.boolean)()),summary:(0,a.optional)((0,a.string)()),description:(0,a.optional)((0,a.string)()),audits:(0,a.optional)((0,a.array)(n.AuditStruct)),category:(0,a.optional)((0,a.enums)(["interoperability","notifications","transaction insights","account management","name resolution"])),tags:(0,a.optional)((0,a.array)((0,a.string)())),support:(0,a.optional)(n.SupportStruct),sourceCode:(0,a.optional)((0,a.string)()),hidden:(0,a.optional)((0,a.boolean)()),privateCode:(0,a.optional)((0,a.boolean)()),privacyPolicy:(0,a.optional)((0,a.string)()),termsOfUse:(0,a.optional)((0,a.string)()),additionalSourceCode:(0,a.optional)((0,a.array)(n.AdditionalSourceCodeStruct)),screenshots:(0,a.optional)((0,a.size)((0,a.array)(n.ImagePathStruct),3,3))}),versions:(0,a.record)(r.VersionStruct,c)}),n.BlockReasonStruct=(0,a.object)({explanation:(0,a.optional)((0,a.string)()),url:(0,a.optional)((0,a.string)())}),n.BlockedSnapStruct=(0,a.union)([(0,a.object)({id:o,versionRange:r.VersionRangeStruct,reason:(0,a.optional)(n.BlockReasonStruct)}),(0,a.object)({checksum:r.ChecksumStruct,reason:(0,a.optional)(n.BlockReasonStruct)})]),n.SnapsRegistryDatabaseStruct=(0,a.object)({verifiedSnaps:(0,a.record)(o,n.VerifiedSnapStruct),blockedSnaps:(0,a.array)(n.BlockedSnapStruct)}),i(e("./verify"),n)}}},{package:"@metamask/snaps-utils>@metamask/snaps-registry",file:"node_modules/@metamask/snaps-registry/dist/index.js"}],[2055,{"@metamask/superstruct":2267,"@metamask/utils":2361,"@noble/curves/secp256k1":2402,"@noble/hashes/sha256":2414},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.verify=n.SignatureStruct=void 0;const s=e("@metamask/superstruct"),i=e("@metamask/utils"),a=e("@noble/curves/secp256k1"),r=e("@noble/hashes/sha256");n.SignatureStruct=(0,s.object)({signature:i.StrictHexStruct,curve:(0,s.literal)("secp256k1"),format:(0,s.literal)("DER")}),n.verify=function({registry:e,signature:t,publicKey:s}){(0,i.assertStruct)(t,n.SignatureStruct,"Invalid signature object");const o=(0,i.hexToBytes)(s);return a.secp256k1.verify((0,i.remove0x)(t.signature),(0,r.sha256)((0,i.stringToBytes)(e)),o)}}}},{package:"@metamask/snaps-utils>@metamask/snaps-registry",file:"node_modules/@metamask/snaps-registry/dist/verify.js"}],[206,{"../../../../../shared/types/transaction-decode":5109,"./four-byte":201,"./proxy":202,"./sourcify":203,"./uniswap":205,"@metamask/utils":2361},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.decodeTransactionData=async function({transactionData:e,contractAddress:t,chainId:n,provider:s}){l("Decoding transaction data",{transactionData:e,contractAddress:t,chainId:n});const d=(0,a.decodeUniswapRouterTransactionData)({transactionData:e,contractAddress:t,chainId:n});if(d)return l("Decoded with Uniswap commands",d),{data:u(d),source:i.DecodedTransactionDataSource.Uniswap};const h=await(0,o.getContractProxyAddress)(t,s);h&&l("Retrieved proxy implementation address",h);const p=h??t,m=(0,r.decodeTransactionDataWithSourcify)(e,p,n),f=(0,c.decodeTransactionDataWithFourByte)(e),[g,y]=await Promise.allSettled([m,f]);if("fulfilled"===g.status&&g.value)return l("Decoded data with Sourcify",g.value),{data:u([g.value]),source:i.DecodedTransactionDataSource.Sourcify};if(l("Failed to decode data with Sourcify",g),"fulfilled"===y.status&&y.value)return l("Decoded data with 4Byte",y.value),{data:u([y.value]),source:i.DecodedTransactionDataSource.FourByte};return l("Failed to decode data with 4Byte",y),undefined};var s=e("@metamask/utils"),i=e("../../../../../shared/types/transaction-decode"),a=e("./uniswap"),r=e("./sourcify"),o=e("./proxy"),c=e("./four-byte");const l=(0,s.createProjectLogger)("transaction-decode");function u(e){return e.map(e=>function(e){return{...e,params:e.params.map(e=>d(e))}}(e))}function d(e){var t;return{...e,value:h(e.value),children:null===(t=e.children)||void 0===t?void 0:t.map(e=>d(e))}}function h(e){const t=e._hex;return t?BigInt(t).toString():e}}}},{package:"$root$",file:"app/scripts/lib/transaction/decode/util.ts"}],[207,{"@ethersproject/abi":552,"@metamask/keyring-controller":1566,"@metamask/utils":2361},function(){with(this.scopeTerminator)with(this.globalThis)return function(){"use strict";return function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ROOT_AUTHORITY=n.ExecutionMode=n.ANY_BENEFICIARY=void 0,n.encodeRedeemDelegations=function(e,t,n){return new a.Interface(u).encodeFunctionData("redeemDelegations",[h(e),t,(s=n,s.map(p))]);var s},n.signDelegation=async function({chainId:e,delegation:t,from:n,messenger:a}){const c={types:d,primaryType:r,domain:{chainId:String((0,s.hexToNumber)(e)),name:o,version:"1",verifyingContract:"0xdb9B1e94B5b69Df7e401DDbedE43491141047dB3"},message:{...t,chainId:(0,s.hexToNumber)(e)}};return await a.call("KeyringController:signTypedMessage",{from:n,data:c},i.SignTypedDataVersion.V4)};var s=e("@metamask/utils"),i=e("@metamask/keyring-controller"),a=e("@ethersproject/abi");n.ExecutionMode=function(e){return e.BATCH_DEFAULT_MODE="0x0100000000000000000000000000000000000000000000000000000000000000",e}({});n.ROOT_AUTHORITY="0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff",n.ANY_BENEFICIARY="0x0000000000000000000000000000000000000a11";const r="Delegation",o="DelegationManager",c=[{type:"address",name:"delegate"},{type:"address",name:"delegator"},{type:"bytes32",name:"authority"},{type:"tuple[]",name:"caveats",components:[{type:"address",name:"enforcer"},{type:"bytes",name:"terms"},{type:"bytes",name:"args"}]},{type:"uint256",name:"salt"},{type:"bytes",name:"signature"}],l=[{type:"address",name:"target"},{type:"uint256",name:"value"},{type:"bytes",name:"callData"}],u=[{type:"function",name:"redeemDelegations",inputs:[{name:"_permissionContexts",type:"bytes[]",internalType:"bytes[]"},{name:"_modes",type:"bytes32[]",internalType:"ModeCode[]"},{name:"_executionCallDatas",type:"bytes[]",internalType:"bytes[]"}],outputs:[],stateMutability:"nonpayable"}],d={EIP712Domain:[{name:"name",type:"string"},{name:"version",type:"string"},{name:"chainId",type:"uint256"},{name:"verifyingContract",type:"address"}],Caveat:[{name:"enforcer",type:"address"},{name:"terms",type:"bytes"}],Delegation:[{name:"delegate",type:"address"},{name:"delegator",type:"address"},{name:"authority",type:"bytes32"},{name:"caveats",type:"Caveat[]"},{name:"salt",type:"uint256"}]};function h(e){return e.map(e=>{return t=e,a.defaultAbiCoder.encode([a.ParamType.from({components:c,name:"delegations",type:"tuple[]"})],[t]);var t})}function p(e){return a.defaultAbiCoder.encode([a.ParamType.from({components:l,name:"executions",type:"tuple[]"})],[e])}}}},{package:"$root$",file:"app/scripts/lib/transaction/delegation.ts"}]],[],{});